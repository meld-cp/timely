import{a as P,t as U}from"../chunks/D1Xbq9Mo.js";import{p as pe,c as s,r as n,s as o,t as K,a as me,V as ue,o as r,W as ne,f as ve,N as W}from"../chunks/CRiTDDG9.js";import{s as E}from"../chunks/D_tVMzu6.js";import{i as be}from"../chunks/CcJ9c5Jw.js";import{r as C,e as fe,i as he}from"../chunks/CMmp8lOf.js";import{d as ge,r as oe}from"../chunks/Bt7N_XmN.js";import{b as _,c as ye}from"../chunks/CJ053N4G.js";import{p as D}from"../chunks/dGNHEYVr.js";import{o as Te}from"../chunks/DTmORs4h.js";import{p as ke}from"../chunks/BOWfCFyX.js";import{F as se}from"../chunks/C1UJn8Ae.js";import{I as Ae,f as Re}from"../chunks/DBf8PzCP.js";import{I as de,T as De,a as Se,b as Ne}from"../chunks/DLcMlBkv.js";import{i as ie,s as re,t as xe,F as Fe}from"../chunks/HPzWTsYV.js";function Pe(y,l){y.preventDefault(),l.onRemoveLine()}var Ue=U('<tr class="c-line svelte-fbae20"><td class="svelte-fbae20"><input name="line-num" type="number" min="1" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-desc" type="text" spellcheck="true" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-qty" type="number" step="0.25" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-units" type="text" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-unit-cost" type="number" class="svelte-fbae20"></td><td style="text-align: right;" class="svelte-fbae20"> </td><td class="svelte-fbae20"><a href="##"><!></a></td></tr>');function Ve(y,l){pe(l,!0);let a=ke(l,"vm",7);var d=Ue(),h=s(d),p=s(h);C(p),p.__change=function(...v){var u;(u=l.onChange)==null||u.apply(this,v)},n(h);var m=o(h),T=s(m);C(T),T.__change=function(...v){var u;(u=l.onChange)==null||u.apply(this,v)},n(m);var x=o(m),k=s(x);C(k),k.__change=function(...v){var u;(u=l.onChange)==null||u.apply(this,v)},n(x);var A=o(x),I=s(A);C(I),I.__change=function(...v){var u;(u=l.onChange)==null||u.apply(this,v)},n(A);var w=o(A),S=s(w);C(S),S.__change=function(...v){var u;(u=l.onChange)==null||u.apply(this,v)},n(w);var g=o(w),V=s(g,!0);n(g);var L=o(g),N=s(L);N.__click=[Pe,l];var H=s(N);Ae(H,{icon:Re}),n(N),n(L),n(d),K(v=>E(V,v),[()=>se.currency(a().total,l.currencyCode)]),_(p,()=>a().number,v=>a().number=v),_(T,()=>a().description,v=>a().description=v),_(k,()=>a().quantity,v=>a().quantity=v),_(I,()=>a().units,v=>a().units=v),_(S,()=>a().unitCost,v=>a().unitCost=v),P(y,d),me()}ge(["change","click"]);var He=U('<article id="working-invoice-container" class="svelte-1afk9pg"><header>Working Invoice</header> <fieldset class="row svelte-1afk9pg"><input name="inv-num" type="text" title="Invoice Number" placeholder="Invoice Number" class="svelte-1afk9pg"> <input name="inv-date" type="date" title="Invoice Date" class="svelte-1afk9pg"> <input name="inv-order" type="text" title="Order #" placeholder="Order #" class="svelte-1afk9pg"> <div style="flex: 99 1 auto"></div></fieldset> <label>Header Lines <textarea name="inv-header" title="Header lines for the invoice" spellcheck="true" placeholder="Header lines for the invoice"></textarea></label> <label>Issue to <textarea name="inv-issue-to" title="Address of the company or person being issued to" spellcheck="true" placeholder="Who will receive the invoice?"></textarea></label> <section><button class="svelte-1afk9pg">Add Line</button> <button class="secondary svelte-1afk9pg">Sort Lines</button></section> <table id="working-inv-lines" class="striped svelte-1afk9pg"><thead><tr><th class="svelte-1afk9pg">Line No.</th><th style="width: 100%;" class="svelte-1afk9pg">Description</th><th class="svelte-1afk9pg">Quantity</th><th class="svelte-1afk9pg">Units</th><th class="svelte-1afk9pg">Unit Cost</th><th class="svelte-1afk9pg">Total</th><th class="svelte-1afk9pg"></th></tr></thead><tbody></tbody><tfoot><tr><th colspan="3" rowspan="3" style="vertical-align: top;" class="svelte-1afk9pg"></th><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">Subtotal:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">GST:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">Grand Total:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr></tfoot></table> <label>Footnote <textarea name="inv-footnote" spellcheck="true" placeholder="Optional Footnote"></textarea></label> <footer><button class="secondary svelte-1afk9pg">Preview</button> <button class="svelte-1afk9pg">Build</button></footer></article>');function Me(y,l){pe(l,!0);let a=ke(l,"vm",7);var d=He(),h=o(s(d),2),p=s(h);C(p),p.__change=function(...t){var i;(i=l.onChange)==null||i.apply(this,t)};var m=o(p,2);C(m),m.__change=function(...t){var i;(i=l.onChange)==null||i.apply(this,t)};var T=o(m,2);C(T),T.__change=function(...t){var i;(i=l.onChange)==null||i.apply(this,t)},ue(2),n(h);var x=o(h,2),k=o(s(x));oe(k),k.__change=function(...t){var i;(i=l.onChange)==null||i.apply(this,t)},n(x);var A=o(x,2),I=o(s(A));oe(I),I.__change=function(...t){var i;(i=l.onChange)==null||i.apply(this,t)},n(A);var w=o(A,2),S=s(w);S.__click=function(...t){var i;(i=l.onAddLine)==null||i.apply(this,t)};var g=o(S,2);g.__click=function(...t){var i;(i=l.onSortLines)==null||i.apply(this,t)},n(w);var V=o(w,2),L=o(s(V));fe(L,21,()=>a().lines,he,(t,i)=>{Ve(t,{get currencyCode(){return a().currencyCode},get vm(){return r(i)},onRemoveLine:()=>l.onRemoveLine(r(i)),get onChange(){return l.onChange}})}),n(L);var N=o(L),H=s(N),v=o(s(H),2),u=s(v,!0);n(v),n(H);var G=o(H),Q=o(s(G)),X=s(Q,!0);n(Q),n(G);var B=o(G),Z=o(s(B)),Y=s(Z,!0);n(Z),n(B),n(N),n(V);var M=o(V,2),j=o(s(M));oe(j),j.__change=function(...t){var i;(i=l.onChange)==null||i.apply(this,t)},n(M);var $=o(M,2),ee=s($);ee.__click=function(...t){var i;(i=l.onPreviewInvoice)==null||i.apply(this,t)};var te=o(ee,2);te.__click=function(...t){var i;(i=l.onBuildInvoice)==null||i.apply(this,t)},n($),n(d),K((t,i,ae)=>{E(u,t),E(X,i),E(Y,ae)},[()=>se.currency(a().subtotal,a().currencyCode),()=>se.currency(a().taxTotal,a().currencyCode),()=>se.currency(a().grandTotal,a().currencyCode)]),_(p,()=>a().number,t=>a().number=t),_(m,()=>a().date,t=>a().date=t),_(T,()=>a().orderRef,t=>a().orderRef=t),_(k,()=>a().headerLinesAsText,t=>a().headerLinesAsText=t),_(I,()=>a().issueToAsText,t=>a().issueToAsText=t),_(j,()=>a().footnoteAsText,t=>a().footnoteAsText=t),P(y,d),me()}ge(["change","click"]);var We=U('<label><input id="untagged-select-all" type="checkbox"> Select All</label> <hr>',1),Ee=U('<div class="c-task-line svelte-1fy7v30"><label><input name="task-line" type="checkbox"> </label></div>'),Be=U("<!> <!>",1),Oe=U("<p><i>All time has been accounted for.</i></p>"),qe=(y,l)=>l(),Ge=(y,l,a)=>{y.preventDefault(),l(r(a).id)},Qe=U('<article> <a href="##">View</a></article>'),Ze=U('<h2>Invoice Builder</h2> <div id="container"><section id="row1" class="svelte-1fy7v30"><!> <div class="c-col-2 svelte-1fy7v30"><article class="time-list svelte-1fy7v30"><header>Uninvoiced Time</header> <!></article> <article class="scratch-pad svelte-1fy7v30"><header>Scratch Pad</header> <textarea name="scratch-pad" class="svelte-1fy7v30"></textarea></article></div></section> <section id="row2"><article><details><summary> </summary> <!></details></article></section></div>',1);function st(y,l){pe(l,!0);const a="draft";let d=ne(D(T())),h=ne(D([])),p=ne(""),m=ne(D([]));Te(()=>{W(p,D(re.getScratchPad("page-invoice-builder"))),W(h,D(I())),W(m,D(x()))});function T(){var e=ie.get(a);return e?new de(e):k()}function x(){return ie.getAll().filter(e=>e.id!=a).map(e=>new de(e)).sort((e,c)=>{const b=new Date(e.date).valueOf(),f=new Date(c.date).valueOf();if(b>f)return-1;if(b<f)return 1;const O=c.number,F=e.number;return F>O?-1:F<O||e.id>c.id?1:e.id<c.id?-1:0})}function k(){const e=re.read(),c=new de;return c.id=a,c.headerLinesAsText=e.defaultInvoiceHeader??"",c.currencyCode=e.defaultInvoiceCurrencyCode,c.number=`${e.nextInvoiceNumber}`,c.footnoteAsText=e.defaultInvoiceFooter??"",c}function A(){re.setScratchPad("page-invoice-builder",r(p))}function I(){return xe.getAll().filter(e=>e.invoiceRefId.length==0&&e.state==De.Stopped).map(e=>new Se(e))}function w(e){const c=new Ne;return c.extRefId=e.id,c.description=`${e.date} - ${e.name}`,c.units="hr",c.quantity=e.affectiveDurationHours,c.unitCost=200,c}function S(){g(),L(r(d).id)}function g(){ie.set(r(d).id,r(d).getModel())}function V(){const e=r(d).getModel();e.id=crypto.randomUUID(),ie.set(e.id,e);const c=r(d).lines.map(f=>f.extRefId).filter(f=>f&&f.length>0),b=r(h).filter(f=>c.includes(f.id));for(const f of b)f.invoiceRefId=r(d).id,xe.set(f.id,f.getModel());re.incrementNextInvoiceNumber(),W(m,D(x())),W(h,D(I())),W(d,D(k())),g(),L(e.id)}function L(e){window.open(`/view-invoice/${e}`,`inv-${e}`)}function N(){if(r(h).length==0)return!1;for(const e of r(h))if(!r(d).containsExtRefId(e.id))return!1;return!0}function H(e){for(const c of r(h))e?r(d).addLine(w(c)):r(d).removeLineWithExtRefId(c.id)}function v(){r(d).addLine(),g()}function u(e){r(d).removeLineWithId(e.id),g()}function G(){r(d).sortAndRenumberLines(),g()}var Q=Ze(),X=o(ve(Q),2),B=s(X),Z=s(B);Me(Z,{get vm(){return r(d)},onChange:g,onAddLine:v,onRemoveLine:u,onSortLines:G,onBuildInvoice:V,onPreviewInvoice:S});var Y=o(Z,2),M=s(Y),j=o(s(M),2);{var $=e=>{var c=Be(),b=ve(c);{var f=F=>{var R=We(),q=ve(R),z=s(q);C(z),ue(),n(q),ue(2),ye(z,()=>N(),J=>H(J)),P(F,R)};be(b,F=>{r(h).length>1&&F(f)})}var O=o(b,2);fe(O,17,()=>r(h),he,(F,R)=>{var q=Ee(),z=s(q),J=s(z);C(J);var Le=o(J);n(z),n(q),K((ce,Ce)=>E(Le,` ${ce??""} (${Ce??""} hrs) - ${r(R).name??""}`),[()=>Fe.toLocalDatefromString(r(R).date,"en-NZ"),()=>r(R).affectiveDurationHours.toFixed(2)]),ye(J,()=>r(d).containsExtRefId(r(R).id),ce=>{ce?r(d).addLine(w(r(R))):r(d).removeLineWithExtRefId(r(R).id)}),P(F,q)}),P(e,c)},ee=e=>{var c=Oe();P(e,c)};be(j,e=>{r(h).length!=0?e($):e(ee,!1)})}n(M);var te=o(M,2),t=o(s(te),2);oe(t),t.__input=[qe,A],n(te),n(Y),n(B);var i=o(B,2),ae=s(i),_e=s(ae),le=s(_e),Ie=s(le);n(le);var we=o(le,2);fe(we,17,()=>r(m),he,(e,c)=>{var b=Qe(),f=s(b),O=o(f);O.__click=[Ge,L,c],n(b),K(()=>E(f,`${r(c).number??""} `)),P(e,b)}),n(_e),n(ae),n(i),n(X),K(()=>E(Ie,`Closed Invoices (${r(m).length??""})`)),_(t,()=>r(p),e=>W(p,e)),P(y,Q),me()}ge(["input","click"]);export{st as component};
