import{a as A,t as L}from"../chunks/disclose-version.090F9Z5W.js";import{p as de,c as n,r as a,s as i,t as D,a as ue,n as le,q as r,ad as z,f as re,R as S,aJ as we,w as ie}from"../chunks/runtime.Zs8r3Oqx.js";import{s as F}from"../chunks/render.CTDoikuL.js";import{i as fe}from"../chunks/if.Dc9nQdRi.js";import{e as oe,i as ce,I as se,T as Te,a as Se,b as Ae,F as Le}from"../chunks/ViewModels.svelte.CFd1dAF6.js";import{r as g,s as Y,i as he,t as me}from"../chunks/Singletons.BCH7qXIm.js";import{d as _e,b as ve}from"../chunks/events.DJoDsz3Y.js";import{b as p,a as pe}from"../chunks/input.DTKRrwQR.js";import{p as x}from"../chunks/proxy.RlL82DbB.js";import{o as Re}from"../chunks/index-client.DuqHwBsT.js";import{p as be}from"../chunks/props.BAByPRWC.js";import{F as ee}from"../chunks/FormatNumber.CF8cNsMY.js";var Ce=L('<tr class="c-line svelte-fbae20"><td class="svelte-fbae20"><input name="line-num" type="number" min="1" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-desc" type="text" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-qty" type="number" step="0.25" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-units" type="text" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-unit-cost" type="number" class="svelte-fbae20"></td><td style="text-align: right;" class="svelte-fbae20"> </td></tr>');function Ne(h,o){de(o,!0);let e=be(o,"vm",7);var s=Ce(),c=n(s),m=n(c);g(m),a(c);var f=i(c),k=n(f);g(k),a(f);var _=i(f),R=n(_);g(R),a(_);var b=i(_),w=n(b);g(w),a(b);var y=i(b),C=n(y);g(C),a(y);var N=i(y),H=n(N,!0);D(()=>F(H,ee.currency(e().total,o.currencyCode))),a(N),a(s),p(m,()=>e().number,d=>e().number=d),p(k,()=>e().description,d=>e().description=d),p(R,()=>e().quantity,d=>e().quantity=d),p(w,()=>e().units,d=>e().units=d),p(C,()=>e().unitCost,d=>e().unitCost=d),A(h,s),ue()}var De=(h,o)=>o().addLine(),Fe=(h,o)=>o().sortLines(),Ee=(h,o,e)=>o.onSaveInvoice(e()),Me=L('<article id="working-invoice-container" class="svelte-16dn89h"><header>Working Invoice</header> <fieldset class="row svelte-16dn89h"><input name="inv-num" type="text" title="Invoice Number" placeholder="Invoice Number" class="svelte-16dn89h"> <input name="inv-date" type="date" title="Invoice Date" class="svelte-16dn89h"> <input name="inv-order" type="text" title="Order #" class="svelte-16dn89h"> <div style="flex: 99 1 auto"></div></fieldset> <label>Issue to <textarea name="inv-issue-to" title="Address of the company or person being issued to"></textarea></label> <nav class="svelte-16dn89h"><ul><li class="svelte-16dn89h"><button class="svelte-16dn89h">Add Line</button></li> <li class="svelte-16dn89h"><button class="secondary svelte-16dn89h">Sort Lines</button></li></ul></nav> <table id="working-inv-lines" class="striped svelte-16dn89h"><thead><tr><th class="svelte-16dn89h">Line No.</th><th style="width: 100%;" class="svelte-16dn89h">Description</th><th class="svelte-16dn89h">Quantity</th><th class="svelte-16dn89h">Units</th><th class="svelte-16dn89h">Unit Cost</th><th class="svelte-16dn89h">Total</th></tr></thead><tbody></tbody><tfoot><tr><th colspan="3" rowspan="3" style="vertical-align: top;" class="svelte-16dn89h"></th><th colspan="2" style="text-align: right;" class="svelte-16dn89h">Subtotal:</th><th style="text-align: right;" class="svelte-16dn89h"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-16dn89h">GST:</th><th style="text-align: right;" class="svelte-16dn89h"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-16dn89h">Grand Total:</th><th style="text-align: right;" class="svelte-16dn89h"> </th></tr></tfoot></table> <label>Footnote <textarea name="inv-footnote"></textarea></label> <footer><button class="svelte-16dn89h">Save</button></footer></article>');function Ue(h,o){de(o,!0);let e=be(o,"vm",15);var s=Me(),c=i(n(s),2),m=n(c);g(m);var f=i(m,2);g(f);var k=i(f,2);g(k),le(2),a(c);var _=i(c,2),R=i(n(_));ve(R),a(_);var b=i(_,2),w=n(b),y=n(w),C=n(y);C.__click=[De,e],a(y);var N=i(y,2),H=n(N);H.__click=[Fe,e],a(N),a(w),a(b);var d=i(b,2),E=i(n(d));oe(E,21,()=>e().lines,ce,(u,t)=>{Ne(u,{get vm(){return r(t)},get currencyCode(){return e().currencyCode}})}),a(E);var M=i(E),U=n(M),$=i(n(U),2),B=n($,!0);D(()=>F(B,ee.currency(e().subtotal,e().currencyCode))),a($),a(U);var G=i(U),K=i(n(G)),te=n(K,!0);D(()=>F(te,ee.currency(e().taxTotal,e().currencyCode))),a(K),a(G);var J=i(G),V=i(n(J)),X=n(V,!0);D(()=>F(X,ee.currency(e().grandTotal,e().currencyCode))),a(V),a(J),a(M),a(d);var W=i(d,2),O=i(n(W));ve(O),a(W);var q=i(W,2),ae=n(q);ae.__click=[Ee,o,e],a(q),a(s),p(m,()=>e().number,u=>e(e().number=u,!0)),p(f,()=>e().date,u=>e(e().date=u,!0)),p(k,()=>e().orderRef,u=>e(e().orderRef=u,!0)),p(R,()=>e().issueToAsText,u=>e(e().issueToAsText=u,!0)),p(O,()=>e().footnoteAsText,u=>e(e().footnoteAsText=u,!0)),A(h,s),ue()}_e(["click"]);var Ve=L('<label><input id="untagged-select-all" type="checkbox"> Select All</label> <hr>',1),We=L('<div class="c-task-line svelte-1fy7v30"><label><input name="task-line" type="checkbox"> </label></div>'),qe=L("<!> <!>",1),Pe=L("<p><i>All time has been account for.</i></p>"),He=(h,o)=>o(),$e=(h,o,e)=>{h.preventDefault(),o(r(e).id)},Be=L('<article> <a href="##">View</a></article>'),Ge=L('<h1>Invoice Builder</h1> <div id="container"><section id="row1" class="svelte-1fy7v30"><!> <div class="c-col-2 svelte-1fy7v30"><article class="time-list svelte-1fy7v30"><header>Uninvoiced Time</header> <!></article> <article class="scratch-pad svelte-1fy7v30"><header>Scratch Pad</header> <textarea name="scratch-pad" class="svelte-1fy7v30"></textarea></article></div></section> <section id="row2"><article><details><summary> </summary> <!></details></article></section></div>',1);function nt(h,o){de(o,!0);let e=z(1),s=z(x(new se)),c=z(x([])),m=z(""),f=z(x([]));Re(()=>{_(),S(m,x(Y.getScratchPad("page-invoice-builder"))),S(c,x(b())),S(f,x(k()))});function k(){return he.getAll().map(t=>new se(t))}function _(){const t=Y.read();S(s,x(new se)),r(s).number=`${t.nextInvoiceNumber}`,r(s).footnoteAsText=t.defaultInvoiceFooter??""}function R(){Y.setScratchPad("page-invoice-builder",r(m))}function b(){return me.getAll().filter(t=>t.invoiceRefId.length==0&&t.state==Te.Stopped).map(t=>new Se(t))}function w(t){const l=new Ae;return l.number=we(e),l.extRefId=t.id,l.description=`${t.date} - ${t.name}`,l.units="hr",l.quantity=t.affectiveDurationHours,l.unitCost=200,l}function y(t){he.set(t.id,t.getModel());const l=r(s).lines.map(v=>v.extRefId).filter(v=>v&&v.length>0),T=r(c).filter(v=>l.includes(v.id));for(const v of T)v.invoiceRefId=r(s).id,me.set(v.id,v.getModel());Y.modify(v=>{v.nextInvoiceNumber++}),S(f,x(k())),S(c,x(b())),_(),C(t.id)}function C(t){window.open(`/view-invoice/${t}`,`inv-${t}`)}function N(){if(r(c).length==0)return!1;for(const t of r(c))if(!r(s).containsExtRefId(t.id))return!1;return!0}function H(t){for(const l of r(c))t?r(s).addLine(w(l)):r(s).removeLineWithExtRefId(l.id)}var d=Ge(),E=i(re(d),2),M=n(E),U=n(M);Ue(U,{onSaveInvoice:y,get vm(){return r(s)},set vm(t){S(s,x(t))}});var $=i(U,2),B=n($),G=i(n(B),2);{var K=t=>{var l=qe(),T=re(l);{var v=Q=>{var I=Ve(),P=re(I),Z=n(P);g(Z),le(),a(P),le(2),pe(Z,()=>N(),j=>H(j)),A(Q,I)};fe(T,Q=>{r(c).length>1&&Q(v)})}var ne=i(T,2);oe(ne,17,()=>r(c),ce,(Q,I)=>{var P=We(),Z=n(P),j=n(Z);g(j);const xe=ie(()=>Le.toLocalDatefromString(r(I).date,"en-NZ")??""),ge=ie(()=>r(I).affectiveDurationHours.toFixed(2)??""),ye=ie(()=>r(I).name??"");var Ie=i(j);D(()=>F(Ie,` ${r(xe)} (${r(ge)} hrs) - ${r(ye)}`)),a(Z),a(P),pe(j,()=>r(s).containsExtRefId(r(I).id),ke=>{ke?r(s).addLine(w(r(I))):r(s).removeLineWithExtRefId(r(I).id)}),A(Q,P)}),A(t,l)},te=t=>{var l=Pe();A(t,l)};fe(G,t=>{r(c).length!=0?t(K):t(te,!1)})}a(B);var J=i(B,2),V=i(n(J),2);ve(V),V.__input=[He,R],a(J),a($),a(M);var X=i(M,2),W=n(X),O=n(W),q=n(O),ae=n(q);a(q);var u=i(q,2);oe(u,17,()=>r(f),ce,(t,l)=>{var T=Be(),v=n(T),ne=i(v);ne.__click=[$e,C,l],a(T),D(()=>F(v,`${r(l).number??""} `)),A(t,T)}),a(O),a(W),a(X),a(E),D(()=>F(ae,`Closed Invoices (${r(f).length??""})`)),p(V,()=>r(m),t=>S(m,t)),A(h,d),ue()}_e(["input","click"]);export{nt as component};
