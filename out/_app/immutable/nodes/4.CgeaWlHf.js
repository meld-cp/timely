import{a as H,t as V}from"../chunks/BpGhemep.js";import{p as W,j as m,s as l,f as $,t as q,a as z,l as o,k as r,c as _,r as b,y as E}from"../chunks/Cxm-zCzI.js";import{d as G,b as O}from"../chunks/BT678Ywi.js";import{s as j}from"../chunks/BqScZFTr.js";import{s as J}from"../chunks/PwPRnE0L.js";import{b as K,a as M}from"../chunks/Bs_tJQfo.js";import{p}from"../chunks/B1dRQCFu.js";import{b as Q}from"../chunks/DsHWS3H0.js";import{a as T,K as X}from"../chunks/AjwCxZEX.js";import{a as Y}from"../chunks/BFa6LZKI.js";import{U as Z}from"../chunks/C_a7cqMs.js";class tt{async backup(t){const a=this.encodeDataToBackup(t);this.downloadAsFile(a)}downloadAsFile(t){const a=`${new Date().valueOf()}.timely-backup`;Z.downloadAsFile(t,a)}encodeDataToBackup(t){return btoa(JSON.stringify(t))}decodeFromBase64(t){const a=atob(t);return console.debug(a),JSON.parse(a)}}function at(c,t,a){t.downloadAsFile(o(a))}async function et(c,t,a){var i;const s=(i=o(t))==null?void 0:i.item(0);s&&r(a,p(await s.text()))}async function ot(c,t,a,s){r(t,!0);try{if(!a)return;await a.backup(s)}finally{r(t,!1)}}async function rt(c,t,a,s,i){r(t,!0);try{if(!a)return;const d=await a.getData();if(!d)throw Error("Invalid data to restore");r(s,p(i.encodeDataToBackup(d)))}finally{r(t,!1)}}var st=V('<h2>Backup</h2> <section><article><textarea name="backup-text" class="svelte-1iwmjr1"></textarea> <button>Local Backup</button> <button>Cloud Backup</button></article></section> <h2>Restore</h2> <section><article><div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem;"><input name="restore-file" type="file" accept=".timely-backup"> or <button style="flex-shrink: 0;">Read From Cloud</button></div> <textarea name="restore-text" class="svelte-1iwmjr1"></textarea> <button>Restore</button></article></section>',1);function vt(c,t){W(t,!0);let a=p(T.getAppData());const s=T.settingsController.read();let i=p(Y.build(s.cloudSyncHost,s.cloudSyncUserId,X)),d=m(!1),L=E(()=>i&&!o(d)),y=m(!1),N=E(()=>i&&!o(y));const f=new tt;let v=m(p(f.encodeDataToBackup(a))),h=m(void 0),n=m(void 0),k;async function U(){try{if(!o(n))throw Error("No data to restore, select a file first");const e=f.decodeFromBase64(o(n));if(!e)throw Error("Invalid data to restore");await T.restoreAppData(e),r(n,void 0),k&&(k.value=""),r(v,p(f.encodeDataToBackup(e))),alert("Restored successfully!")}catch(e){alert(e)}}var F=st(),D=l($(F),2),S=_(D),g=_(S);O(g);var A=l(g,2);A.__click=[at,f,v];var B=l(A,2);B.__click=[ot,d,i,a],b(S),b(D);var C=l(D,4),I=_(C),x=_(I),u=_(x);u.__change=[et,h,n],J(u,"flex-shrink","1"),J(u,"margin-bottom","0"),Q(u,e=>k=e,()=>k);var w=l(u,2);w.__click=[rt,y,i,n,f],b(x);var R=l(x,2);O(R);var P=l(R,2);P.__click=U,b(I),b(C),q(()=>{B.disabled=!o(L),j(B,"aria-busy",o(d)),w.disabled=!o(N),j(w,"aria-busy",o(y))}),K(g,()=>o(v),e=>r(v,e)),M(u,()=>o(h),e=>r(h,e)),K(R,()=>o(n),e=>r(n,e)),H(c,F),z()}G(["click","change"]);export{vt as component};
