var Tt=Object.defineProperty;var lt=a=>{throw TypeError(a)};var pt=(a,t,e)=>t in a?Tt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var E=(a,t,e)=>pt(a,typeof t!="symbol"?t+"":t,e),yt=(a,t,e)=>t.has(a)||lt("Cannot "+e);var w=(a,t,e)=>(yt(a,t,"read from private field"),e?e.call(a):t.get(a)),N=(a,t,e)=>t.has(a)?lt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,e);import{a as k,t as T,c as ct}from"../chunks/JxQl07LI.js";import{p as tt,c as i,s as v,r as n,t as O,l as d,a as et,y as H,f as J,i as dt,k as F,j as W}from"../chunks/DfIxbQgk.js";import{d as kt,s as B,e as xt}from"../chunks/gBOFVro4.js";import{p as z}from"../chunks/EhVYkYad.js";import{o as ft,a as ht}from"../chunks/-ALy92Mv.js";import{e as mt,i as bt}from"../chunks/DeDL2Fnw.js";import{t as St,s as Dt}from"../chunks/sCSfzU7Q.js";import{i as j}from"../chunks/DnjCBcqO.js";import{s as ut,r as nt,T as c,a as rt,e as ot,F as Rt}from"../chunks/dcS8n3kW.js";import{b as it}from"../chunks/CRbFqH2L.js";import{p as At}from"../chunks/D2G8EsGX.js";import{I as K,a as Ct,b as Pt,c as wt,d as zt,e as It,g as Mt}from"../chunks/keHazJcN.js";function jt(a,t,e){if(e){if(a.classList.contains(t))return;a.classList.add(t)}else{if(!a.classList.contains(t))return;a.classList.remove(t)}}var Lt=(a,t)=>t.onIncreaseDuration(!0,a.ctrlKey),Ht=(a,t)=>t.onIncreaseDuration(!1,a.ctrlKey),Ut=T('<button class="outline svelte-1ifz5q4" title="Add Time"><!></button> <button class="outline svelte-1ifz5q4" title="Remove Time"><!></button>',1),qt=T('<div class="c-buttons svelte-1ifz5q4"><!></div>'),Vt=(a,t)=>t.onAction1Click(),Ft=T('<button class="outline svelte-1ifz5q4"><!></button>'),Bt=T('<div class="icon"><!></div>'),Ot=(a,t)=>t.onAction2Click(),Et=T('<button class="outline secondary svelte-1ifz5q4"><!></button>'),Nt=T('<div class="icon secondary"><!></div>'),Kt=T('<div class="c-buttons svelte-1ifz5q4"><!> <!></div>'),Wt=T('<div class="c-main svelte-1ifz5q4"><!> <div class="affective svelte-1ifz5q4"> </div> <div class="counter svelte-1ifz5q4"> </div> <!></div>');function Gt(a,t){tt(t,!0);let e=H(()=>{const r=Math.floor(Math.abs(t.durationSeconds)/60/60),h=Math.floor(Math.abs(t.durationSeconds/60)),D=Math.abs(h%60),A=Math.abs(t.durationSeconds%60),g=[r.toFixed(0)+"h",D.toFixed(0)+"m",A.toFixed(0)+"s"];return(t.durationSeconds<0?"-":"")+g.join(" ")});var l=Wt(),f=i(l);{var x=r=>{var h=qt(),D=i(h);{var A=g=>{var C=Ut(),M=J(C);M.__click=[Lt,t];var U=i(M);K(U,{icon:Ct}),n(M);var u=v(M,2);u.__click=[Ht,t];var o=i(u);K(o,{icon:Pt}),n(u),k(g,C)};j(D,g=>{t.onIncreaseDuration&&g(A)})}n(h),k(r,h)};j(f,r=>{t.onIncreaseDuration&&r(x)})}var m=v(f,2),p=i(m,!0);n(m);var b=v(m,2),_=i(b,!0);n(b);var S=v(b,2);{var I=r=>{var h=Kt(),D=i(h);{var A=u=>{var o=Ft();o.__click=[Vt,t];var R=i(o);K(R,{get icon(){return t.icon1}}),n(o),O(()=>ut(o,"title",t.action1Hint)),k(u,o)},g=u=>{var o=ct(),R=J(o);{var V=P=>{var y=Bt(),G=i(y);K(G,{get icon(){return t.icon1}}),n(y),k(P,y)};j(R,P=>{t.icon1&&P(V)},!0)}k(u,o)};j(D,u=>{t.onAction1Click&&t.icon1?u(A):u(g,!1)})}var C=v(D,2);{var M=u=>{var o=Et();o.__click=[Ot,t];var R=i(o);K(R,{get icon(){return t.icon2}}),n(o),O(()=>ut(o,"title",t.action2Hint)),k(u,o)},U=u=>{var o=ct(),R=J(o);{var V=P=>{var y=Nt(),G=i(y);K(G,{get icon(){return t.icon2}}),n(y),k(P,y)};j(R,P=>{t.icon2&&P(V)},!0)}k(u,o)};j(C,u=>{t.onAction2Click&&t.icon2?u(M):u(U,!1)})}n(h),k(r,h)};j(S,r=>{(t.icon1||t.onAction1Click||t.icon2||t.onAction2Click)&&r(I)})}n(l),O(r=>{B(p,r),B(_,d(e))},[()=>{var r;return(r=t.affectiveDurationHours)==null?void 0:r.toFixed(2)}]),k(a,l),et()}kt(["click"]);class L{}E(L,"TaskPause",wt),E(L,"TaskResume",zt),E(L,"TaskStop",It),E(L,"TaskDuplicateAndStart",Mt);function vt(a,t,e){t.taskController.saveTask(e())}var Jt=T('<span style="flex: content;" class="inv" title="Invoice"> </span>'),Qt=(a,t,e)=>{var l;return(l=t.taskController)==null?void 0:l.saveTask(e())},Xt=(a,t,e)=>t.taskController.deleteTask(e()),Yt=T('<button style="flex: content;" class="svelte-1jzxame">Delete</button>'),Zt=T('<article class="c-task svelte-1jzxame"><div class="c-task-fields svelte-1jzxame"><input class="date svelte-1jzxame" name="task-date" type="date" title="Date"> <input class="name svelte-1jzxame" name="task-name" type="text" title="Description" placeholder="Description"> <div class="c-task-fields-row-2 svelte-1jzxame"><details class="svelte-1jzxame"><summary class="svelte-1jzxame">Other</summary> <!> <div style="display: flex; flex-direction: row; gap:1rem; flex-wrap: wrap;"><input style="flex: 10;" class="tags svelte-1jzxame" name="task-tags" type="text" placeholder="Tags" title="Tags"> <!></div></details> <div style="flex: 2;"></div></div></div> <div class="c-task-duration svelte-1jzxame"><!></div></article>');function $t(a,t){tt(t,!0);let e=At(t,"vm",7);const l=e().state=="Archived",f={icon:s=>{switch(s.state){case c.Running:return L.TaskPause;case c.Paused:return L.TaskResume;case c.Stopped:return L.TaskDuplicateAndStart}},hint:s=>{switch(s.state){case c.Running:return"Pause";case c.Paused:return"Resume";case c.Stopped:return"Start a new copy"}},execute:s=>{switch(s.state){case c.Running:t.taskController.pauseTask(s);break;case c.Paused:t.taskController.startTask(s);break;case c.Stopped:t.taskController.duplicateAndStartTask(s);break}}},x={icon:s=>{switch(s.state){case c.Running:return L.TaskStop;case c.Paused:return L.TaskStop;case c.Stopped:return L.TaskResume}},hint:s=>{switch(s.state){case c.Running:return"Stop";case c.Paused:return"Stop";case c.Stopped:return"Start"}},execute:s=>{switch(s.state){case c.Running:t.taskController.stopTask(s);break;case c.Paused:t.taskController.stopTask(s);break;case c.Stopped:t.taskController.startTask(s);break}}};function m(s,q){let at=q?1:15;t.taskController.increaseDuration(e(),s?at:-at)}var p=Zt(),b=i(p),_=i(b);nt(_),_.__input=[vt,t,e],_.readOnly=l;var S=v(_,2);nt(S),S.__input=[vt,t,e],S.readOnly=l;var I=v(S,2),r=i(I),h=v(i(r),2);{var D=s=>{var q=Jt(),at=i(q);n(q),O(()=>B(at,`Attached to Invoice Id: ${e().invoiceRefId??""}`)),k(s,q)};j(h,s=>{e().invoiceRefId.length>0&&s(D)})}var A=v(h,2),g=i(A);nt(g),g.__input=[Qt,t,e],g.readOnly=l;var C=v(g,2);{var M=s=>{var q=Yt();q.__click=[Xt,t,e],k(s,q)};j(C,s=>{l||s(M)})}n(A),n(r),dt(2),n(I),n(b);var U=v(b,2),u=i(U);const o=H(()=>f.icon(e()));var R=H(()=>d(o));const V=H(()=>f.hint(e()));var P=H(()=>d(V));const y=H(()=>x.icon(e()));var G=H(()=>d(y));const _t=H(()=>x.hint(e()));var gt=H(()=>d(_t));Gt(u,{get durationSeconds(){return e().duration},get affectiveDurationHours(){return e().affectiveDurationHours},onIncreaseDuration:l?void 0:m,get icon1(){return d(R)},onAction1Click:()=>f.execute(e()),get action1Hint(){return d(P)},get icon2(){return d(G)},onAction2Click:()=>x.execute(e()),get action2Hint(){return d(gt)}}),n(U),n(p),O(()=>jt(p,"s-running",e().state==c.Running)),it(_,()=>e().date,s=>e().date=s),it(S,()=>e().name,s=>e().name=s),it(g,()=>e().tagsAsText,s=>e().tagsAsText=s),k(a,p),et()}kt(["input","click"]);var te=T("<div><!></div>");function st(a,t){var e=ct(),l=J(e);mt(l,19,()=>t.tasks,f=>f.id,(f,x)=>{var m=te(),p=i(m);$t(p,{get vm(){return d(x)},get taskController(){return t.taskController}}),n(m),St(3,m,()=>Dt,()=>({duration:200})),k(f,m)}),k(a,e)}var ee=T("<option></option>"),ae=T('<datalist id="list-task-names"></datalist>'),se=T('<form><fieldset role="group" class="svelte-1ps283u"><input name="task-name" type="text" placeholder="Whatcha doin?" spellcheck="true" list="list-task-names"> <!> <input type="submit" value="Start" class="svelte-1ps283u"></fieldset></form>');function ne(a,t){tt(t,!0);let e=W("");function l(_){_.preventDefault(),t.onStartTask(d(e)),F(e,"")}var f=se(),x=i(f),m=i(x);nt(m);var p=v(m,2);{var b=_=>{var S=ae();mt(S,21,()=>t.previousTasksList,bt,(I,r)=>{var h=ee(),D={};O(()=>{D!==(D=d(r).name)&&(h.value=(h.__value=d(r).name)==null?"":d(r).name)}),k(I,h)}),n(S),k(_,S)};j(p,_=>{t.previousTasksList&&_(b)})}dt(2),n(x),n(f),xt("submit",f,l),it(m,()=>d(e),_=>F(e,_)),k(a,f),et()}var Q,X,Y,Z,$;class ie{constructor(){N(this,Q,W(z([])));N(this,X,W(z([])));N(this,Y,W(z([])));N(this,Z,W(z([])));N(this,$,W(z([])));E(this,"intervalId")}get previouslyUsedTasks(){return d(w(this,Q))}set previouslyUsedTasks(t){F(w(this,Q),z(t))}get tasksRunning(){return d(w(this,X))}set tasksRunning(t){F(w(this,X),z(t))}get tasksPaused(){return d(w(this,Y))}set tasksPaused(t){F(w(this,Y),z(t))}get tasksStopped(){return d(w(this,Z))}set tasksStopped(t){F(w(this,Z),z(t))}get tasksArchived(){return d(w(this,$))}set tasksArchived(t){F(w(this,$),z(t))}start(){this.stop(),this.refreshAndCatchUpRunningTaskDurations(),this.intervalId=setInterval(()=>this.incrementRunningTaskDuration(),1e3)}stop(){this.intervalId&&clearInterval(this.intervalId)}refreshAndCatchUpRunningTaskDurations(){console.debug("refreshAndCatchUpRunningTaskDurations"),this.refresh();for(const t of this.tasksRunning)t.recalculateDurationFromRunningSession()}refresh(){const t=rt.taskRepo.getAll().map(e=>new ot(e));this.previouslyUsedTasks=t.sort((e,l)=>e.date>l.date?-1:1).slice(0,20),this.tasksRunning=this.fetchTasksByState(t,[c.Running]),this.tasksPaused=this.fetchTasksByState(t,[c.Paused]),this.tasksStopped=this.fetchTasksByState(t,[c.Stopped]),this.tasksArchived=this.fetchTasksByState(t,[c.Archived])}fetchTasksByState(t,e){return t.filter(l=>e.includes(l.state))}startNewTask(t){const e=new ot;e.name=t,this.startTask(e)}saveTask(t){rt.taskRepo.set(t.id,t.getModel())}pauseAll(){this.refresh();for(const t of this.tasksRunning)t.pause(),this.saveTask(t);this.refresh()}incrementRunningTaskDuration(){for(const t of this.tasksRunning)t.setDuration(t.duration+1),this.saveTask(t)}pauseTask(t){t.pause(),this.saveTask(t),this.refresh()}startTask(t){this.pauseAll(),t.start(),this.saveTask(t),this.refresh()}stopTask(t){t.stop(),this.saveTask(t),this.refresh()}duplicateAndStartTask(t){const e=new ot(t.getModel(crypto.randomUUID()));e.setDuration(0),e.date=Rt.toInputDateValue(new Date),e.invoiceRefId="",this.startTask(e)}increaseDuration(t,e){t.incrementDuration(e),this.saveTask(t)}deleteTask(t){rt.taskRepo.remove(t.id),this.refresh()}}Q=new WeakMap,X=new WeakMap,Y=new WeakMap,Z=new WeakMap,$=new WeakMap;function re(a,t){tt(t,!0),ft(()=>{document.addEventListener("visibilitychange",e)}),ht(()=>{document.removeEventListener("visibilitychange",e)});function e(){t.onPageVisibilityChanged(document.visibilityState==="visible")}et()}var oe=T("<!> <h2>Time Log</h2> <!> <section><summary> </summary> <!></section> <section><summary> </summary> <!></section> <section><details><summary> </summary> <!></details></section> <section><details><summary> </summary> <!></details></section>",1);function ye(a,t){tt(t,!0);let e=z(new ie);ft(()=>{e.start()}),ht(()=>{e.stop()});function l(y){console.debug("onPageVisibilityChanged",y),y&&e.refreshAndCatchUpRunningTaskDurations()}var f=oe(),x=J(f);re(x,{onPageVisibilityChanged:l});var m=v(x,4);ne(m,{onStartTask:y=>e.startNewTask(y),get previousTasksList(){return e.previouslyUsedTasks}});var p=v(m,2),b=i(p),_=i(b);n(b);var S=v(b,2);st(S,{get taskController(){return e},get tasks(){return e.tasksRunning}}),n(p);var I=v(p,2),r=i(I),h=i(r);n(r);var D=v(r,2);st(D,{get taskController(){return e},get tasks(){return e.tasksPaused}}),n(I);var A=v(I,2),g=i(A),C=i(g),M=i(C);n(C);var U=v(C,2);st(U,{get taskController(){return e},get tasks(){return e.tasksStopped}}),n(g),n(A);var u=v(A,2),o=i(u),R=i(o),V=i(R);n(R);var P=v(R,2);st(P,{get taskController(){return e},get tasks(){return e.tasksArchived}}),n(o),n(u),O(()=>{B(_,`In Progress (${e.tasksRunning.length??""})`),B(h,`Paused (${e.tasksPaused.length??""})`),B(M,`Stopped (${e.tasksStopped.length??""})`),B(V,`Archived (${e.tasksArchived.length??""})`)}),k(a,f),et()}export{ye as component};
