import{a as A,t as L}from"../chunks/disclose-version.wL0fmYXF.js";import{p as de,c as r,r as a,s as i,t as D,a as ue,n as le,x as n,a7 as J,f as ne,a2 as S,ao as we,z as ie}from"../chunks/runtime.lwdHLtGF.js";import{s as F}from"../chunks/render.b5GiqjI_.js";import{i as fe}from"../chunks/if.DxBn1DTk.js";import{e as oe,i as ce,I as se,T as Te,a as Se,b as Ae,F as Le}from"../chunks/ViewModels.svelte.DWitS8JO.js";import{r as g}from"../chunks/attributes.B2nDsigi.js";import{d as _e,b as ve}from"../chunks/events.BkSEa6sA.js";import{b as p,c as he}from"../chunks/input.CzHuGUdJ.js";import{p as x}from"../chunks/proxy.E1uy1Vwt.js";import{o as Ce}from"../chunks/index-client.CgE72aKC.js";import{p as be}from"../chunks/props.Cowejr5R.js";import{F as ee}from"../chunks/FormatNumber.CF8cNsMY.js";import{s as Y,i as me,t as pe}from"../chunks/Singletons.BXFbSXWe.js";var Re=L('<tr class="c-line svelte-fbae20"><td class="svelte-fbae20"><input name="line-num" type="number" min="1" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-desc" type="text" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-qty" type="number" step="0.25" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-units" type="text" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-unit-cost" type="number" class="svelte-fbae20"></td><td style="text-align: right;" class="svelte-fbae20"> </td></tr>');function Ne(h,o){de(o,!0);let e=be(o,"vm",7);var s=Re(),c=r(s),m=r(c);g(m),a(c);var f=i(c),k=r(f);g(k),a(f);var _=i(f),C=r(_);g(C),a(_);var b=i(_),w=r(b);g(w),a(b);var y=i(b),R=r(y);g(R),a(y);var N=i(y),H=r(N,!0);D(()=>F(H,ee.currency(e().total,o.currencyCode))),a(N),a(s),p(m,()=>e().number,d=>e().number=d),p(k,()=>e().description,d=>e().description=d),p(C,()=>e().quantity,d=>e().quantity=d),p(w,()=>e().units,d=>e().units=d),p(R,()=>e().unitCost,d=>e().unitCost=d),A(h,s),ue()}var De=(h,o)=>o().addLine(),Fe=(h,o)=>o().sortLines(),Ee=(h,o,e)=>o.onSaveInvoice(e()),Me=L('<article id="working-invoice-container" class="svelte-16dn89h"><header>Working Invoice</header> <fieldset class="row svelte-16dn89h"><input name="inv-num" type="text" title="Invoice Number" placeholder="Invoice Number" class="svelte-16dn89h"> <input name="inv-date" type="date" title="Invoice Date" class="svelte-16dn89h"> <input name="inv-order" type="text" title="Order #" class="svelte-16dn89h"> <div style="flex: 99 1 auto"></div></fieldset> <label>Issue to <textarea name="inv-issue-to" title="Address of the company or person being issued to"></textarea></label> <nav class="svelte-16dn89h"><ul><li class="svelte-16dn89h"><button class="svelte-16dn89h">Add Line</button></li> <li class="svelte-16dn89h"><button class="secondary svelte-16dn89h">Sort Lines</button></li></ul></nav> <table id="working-inv-lines" class="striped svelte-16dn89h"><thead><tr><th class="svelte-16dn89h">Line No.</th><th style="width: 100%;" class="svelte-16dn89h">Description</th><th class="svelte-16dn89h">Quantity</th><th class="svelte-16dn89h">Units</th><th class="svelte-16dn89h">Unit Cost</th><th class="svelte-16dn89h">Total</th></tr></thead><tbody></tbody><tfoot><tr><th colspan="3" rowspan="3" style="vertical-align: top;" class="svelte-16dn89h"></th><th colspan="2" style="text-align: right;" class="svelte-16dn89h">Subtotal:</th><th style="text-align: right;" class="svelte-16dn89h"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-16dn89h">GST:</th><th style="text-align: right;" class="svelte-16dn89h"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-16dn89h">Grand Total:</th><th style="text-align: right;" class="svelte-16dn89h"> </th></tr></tfoot></table> <label>Footnote <textarea name="inv-footnote"></textarea></label> <footer><button class="svelte-16dn89h">Save</button></footer></article>');function Ue(h,o){de(o,!0);let e=be(o,"vm",15);var s=Me(),c=i(r(s),2),m=r(c);g(m);var f=i(m,2);g(f);var k=i(f,2);g(k),le(2),a(c);var _=i(c,2),C=i(r(_));ve(C),a(_);var b=i(_,2),w=r(b),y=r(w),R=r(y);R.__click=[De,e],a(y);var N=i(y,2),H=r(N);H.__click=[Fe,e],a(N),a(w),a(b);var d=i(b,2),E=i(r(d));oe(E,21,()=>e().lines,ce,(u,t)=>{Ne(u,{get vm(){return n(t)},get currencyCode(){return e().currencyCode}})}),a(E);var M=i(E),U=r(M),$=i(r(U),2),B=r($,!0);D(()=>F(B,ee.currency(e().subtotal,e().currencyCode))),a($),a(U);var G=i(U),K=i(r(G)),te=r(K,!0);D(()=>F(te,ee.currency(e().taxTotal,e().currencyCode))),a(K),a(G);var z=i(G),V=i(r(z)),X=r(V,!0);D(()=>F(X,ee.currency(e().grandTotal,e().currencyCode))),a(V),a(z),a(M),a(d);var W=i(d,2),O=i(r(W));ve(O),a(W);var P=i(W,2),ae=r(P);ae.__click=[Ee,o,e],a(P),a(s),p(m,()=>e().number,u=>e(e().number=u,!0)),p(f,()=>e().date,u=>e(e().date=u,!0)),p(k,()=>e().orderRef,u=>e(e().orderRef=u,!0)),p(C,()=>e().issueToAsText,u=>e(e().issueToAsText=u,!0)),p(O,()=>e().footnoteAsText,u=>e(e().footnoteAsText=u,!0)),A(h,s),ue()}_e(["click"]);var Ve=L('<label><input id="untagged-select-all" type="checkbox"> Select All</label> <hr>',1),We=L('<div class="c-task-line svelte-1fy7v30"><label><input name="task-line" type="checkbox"> </label></div>'),Pe=L("<!> <!>",1),qe=L("<p><i>All time has been accounted for.</i></p>"),He=(h,o)=>o(),$e=(h,o,e)=>{h.preventDefault(),o(n(e).id)},Be=L('<article> <a href="##">View</a></article>'),Ge=L('<h2>Invoice Builder</h2> <div id="container"><section id="row1" class="svelte-1fy7v30"><!> <div class="c-col-2 svelte-1fy7v30"><article class="time-list svelte-1fy7v30"><header>Uninvoiced Time</header> <!></article> <article class="scratch-pad svelte-1fy7v30"><header>Scratch Pad</header> <textarea name="scratch-pad" class="svelte-1fy7v30"></textarea></article></div></section> <section id="row2"><article><details><summary> </summary> <!></details></article></section></div>',1);function nt(h,o){de(o,!0);let e=J(1),s=J(x(new se)),c=J(x([])),m=J(""),f=J(x([]));Ce(()=>{_(),S(m,x(Y.getScratchPad("page-invoice-builder"))),S(c,x(b())),S(f,x(k()))});function k(){return me.getAll().map(t=>new se(t))}function _(){const t=Y.read();S(s,x(new se)),n(s).number=`${t.nextInvoiceNumber}`,n(s).footnoteAsText=t.defaultInvoiceFooter??""}function C(){Y.setScratchPad("page-invoice-builder",n(m))}function b(){return pe.getAll().filter(t=>t.invoiceRefId.length==0&&t.state==Te.Stopped).map(t=>new Se(t))}function w(t){const l=new Ae;return l.number=we(e),l.extRefId=t.id,l.description=`${t.date} - ${t.name}`,l.units="hr",l.quantity=t.affectiveDurationHours,l.unitCost=200,l}function y(t){me.set(t.id,t.getModel());const l=n(s).lines.map(v=>v.extRefId).filter(v=>v&&v.length>0),T=n(c).filter(v=>l.includes(v.id));for(const v of T)v.invoiceRefId=n(s).id,pe.set(v.id,v.getModel());Y.modify(v=>{v.nextInvoiceNumber++}),S(f,x(k())),S(c,x(b())),_(),R(t.id)}function R(t){window.open(`/view-invoice/${t}`,`inv-${t}`)}function N(){if(n(c).length==0)return!1;for(const t of n(c))if(!n(s).containsExtRefId(t.id))return!1;return!0}function H(t){for(const l of n(c))t?n(s).addLine(w(l)):n(s).removeLineWithExtRefId(l.id)}var d=Ge(),E=i(ne(d),2),M=r(E),U=r(M);Ue(U,{onSaveInvoice:y,get vm(){return n(s)},set vm(t){S(s,x(t))}});var $=i(U,2),B=r($),G=i(r(B),2);{var K=t=>{var l=Pe(),T=ne(l);{var v=Q=>{var I=Ve(),q=ne(I),Z=r(q);g(Z),le(),a(q),le(2),he(Z,()=>N(),j=>H(j)),A(Q,I)};fe(T,Q=>{n(c).length>1&&Q(v)})}var re=i(T,2);oe(re,17,()=>n(c),ce,(Q,I)=>{var q=We(),Z=r(q),j=r(Z);g(j);const xe=ie(()=>Le.toLocalDatefromString(n(I).date,"en-NZ")??""),ge=ie(()=>n(I).affectiveDurationHours.toFixed(2)??""),ye=ie(()=>n(I).name??"");var Ie=i(j);D(()=>F(Ie,` ${n(xe)} (${n(ge)} hrs) - ${n(ye)}`)),a(Z),a(q),he(j,()=>n(s).containsExtRefId(n(I).id),ke=>{ke?n(s).addLine(w(n(I))):n(s).removeLineWithExtRefId(n(I).id)}),A(Q,q)}),A(t,l)},te=t=>{var l=qe();A(t,l)};fe(G,t=>{n(c).length!=0?t(K):t(te,!1)})}a(B);var z=i(B,2),V=i(r(z),2);ve(V),V.__input=[He,C],a(z),a($),a(M);var X=i(M,2),W=r(X),O=r(W),P=r(O),ae=r(P);a(P);var u=i(P,2);oe(u,17,()=>n(f),ce,(t,l)=>{var T=Be(),v=r(T),re=i(v);re.__click=[$e,R,l],a(T),D(()=>F(v,`${n(l).number??""} `)),A(t,T)}),a(O),a(W),a(X),a(E),D(()=>F(ae,`Closed Invoices (${n(f).length??""})`)),p(V,()=>n(m),t=>S(m,t)),A(h,d),ue()}_e(["input","click"]);export{nt as component};
