var ft=Object.defineProperty;var lt=a=>{throw TypeError(a)};var ht=(a,t,e)=>t in a?ft(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var V=(a,t,e)=>ht(a,typeof t!="symbol"?t+"":t,e),_t=(a,t,e)=>t.has(a)||lt("Cannot "+e);var A=(a,t,e)=>(_t(a,t,"read from private field"),e?e.call(a):t.get(a)),K=(a,t,e)=>t.has(a)?lt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,e);import{a as g,t as p,c as ct}from"../chunks/CYLZ2iXy.js";import{p as nt,c as n,s as v,r as s,t as U,l as d,a as it,y as M,f as st,i as dt,k as q,j as O}from"../chunks/DADXHUXo.js";import{s as F}from"../chunks/B6FQDuwJ.js";import{p as C}from"../chunks/Ie9j5a_F.js";import{o as gt,a as Tt}from"../chunks/UnYXnCVM.js";import{e as kt,i as pt}from"../chunks/DqwSvHIX.js";import{t as xt,s as yt}from"../chunks/DQWldmw4.js";import{i as H}from"../chunks/D7YmwrGJ.js";import{s as ut,r as et,T as o,a as rt,e as ot,F as St}from"../chunks/BYbhNCYi.js";import{d as mt,e as bt}from"../chunks/DrIKNhWD.js";import{b as at}from"../chunks/BPWOsLyd.js";import{p as Rt}from"../chunks/Dc-MrZnh.js";import{I as E,a as Dt,b as At,c as Ct,d as wt,e as Pt,g as zt}from"../chunks/0XVxcagg.js";function It(a,t,e){if(e){if(a.classList.contains(t))return;a.classList.add(t)}else{if(!a.classList.contains(t))return;a.classList.remove(t)}}var Mt=(a,t)=>t.onIncreaseDuration(!0,a.ctrlKey),jt=(a,t)=>t.onIncreaseDuration(!1,a.ctrlKey),Ht=p('<div class="c-buttons svelte-1ifz5q4"><button class="outline svelte-1ifz5q4" title="Add Time"><!></button> <button class="outline svelte-1ifz5q4" title="Remove Time"><!></button></div>'),Lt=(a,t)=>t.onAction1Click(),qt=p('<button class="outline svelte-1ifz5q4"><!></button>'),Ft=p('<div class="icon"><!></div>'),Ut=(a,t)=>t.onAction2Click(),Bt=p('<button class="outline secondary svelte-1ifz5q4"><!></button>'),Nt=p('<div class="icon secondary"><!></div>'),Vt=p('<div class="c-buttons svelte-1ifz5q4"><!> <!></div>'),Kt=p('<div class="c-main svelte-1ifz5q4"><!> <div class="affective svelte-1ifz5q4"> </div> <div class="counter svelte-1ifz5q4"> </div> <!></div>');function Et(a,t){nt(t,!0);let e=M(()=>{const r=Math.floor(Math.abs(t.durationSeconds)/60/60),k=Math.floor(Math.abs(t.durationSeconds/60)),_=Math.abs(k%60),T=Math.abs(t.durationSeconds%60),R=[r.toFixed(0)+"h",_.toFixed(0)+"m",T.toFixed(0)+"s"];return(t.durationSeconds<0?"-":"")+R.join(" ")});var c=Kt(),f=n(c);{var x=r=>{var k=Ht(),_=n(k);_.__click=[Mt,t];var T=n(_);E(T,{icon:Dt}),s(_);var R=v(_,2);R.__click=[jt,t];var P=n(R);E(P,{icon:At}),s(R),s(k),g(r,k)};H(f,r=>{t.onIncreaseDuration&&r(x)})}var l=v(f,2),b=n(l,!0);s(l);var y=v(l,2),h=n(y,!0);s(y);var S=v(y,2);{var j=r=>{var k=Vt(),_=n(k);{var T=m=>{var u=qt();u.__click=[Lt,t];var D=n(u);E(D,{get icon(){return t.icon1}}),s(u),U(()=>ut(u,"title",t.action1Hint)),g(m,u)},R=m=>{var u=ct(),D=st(u);{var L=z=>{var I=Ft(),W=n(I);E(W,{get icon(){return t.icon1}}),s(I),g(z,I)};H(D,z=>{t.icon1&&z(L)},!0)}g(m,u)};H(_,m=>{t.onAction1Click?m(T):m(R,!1)})}var P=v(_,2);{var B=m=>{var u=Bt();u.__click=[Ut,t];var D=n(u);E(D,{get icon(){return t.icon2}}),s(u),U(()=>ut(u,"title",t.action2Hint)),g(m,u)},N=m=>{var u=ct(),D=st(u);{var L=z=>{var I=Nt(),W=n(I);E(W,{get icon(){return t.icon2}}),s(I),g(z,I)};H(D,z=>{t.icon2&&z(L)},!0)}g(m,u)};H(P,m=>{t.onAction2Click?m(B):m(N,!1)})}s(k),g(r,k)};H(S,r=>{(t.icon1||t.onAction1Click||t.icon2||t.onAction2Click)&&r(j)})}s(c),U(r=>{F(b,r),F(h,d(e))},[()=>{var r;return(r=t.affectiveDurationHours)==null?void 0:r.toFixed(2)}]),g(a,c),it()}mt(["click"]);class w{}V(w,"TaskPause",Ct),V(w,"TaskResume",wt),V(w,"TaskStop",Pt),V(w,"TaskDuplicateAndStart",zt);function vt(a,t,e){t.taskController.saveTask(e())}var Ot=p('<span style="flex: content;" class="inv" title="Invoice"> </span>'),Wt=(a,t,e)=>{var c;return(c=t.taskController)==null?void 0:c.saveTask(e())},Gt=(a,t,e)=>t.taskController.deleteTask(e()),Jt=p('<article class="c-task svelte-1jzxame"><div class="c-task-fields svelte-1jzxame"><input class="date svelte-1jzxame" name="task-date" type="date" title="Date"> <input class="name svelte-1jzxame" name="task-name" type="text" title="Description" placeholder="Description"> <div class="c-task-fields-row-2 svelte-1jzxame"><details class="svelte-1jzxame"><summary class="svelte-1jzxame">Other</summary> <!> <div style="display: flex; flex-direction: row; gap:1rem; flex-wrap: wrap;"><input style="flex: 10;" class="tags svelte-1jzxame" name="task-tags" type="text" placeholder="Tags" title="Tags"> <button style="flex: content;" class="svelte-1jzxame">Delete</button></div></details> <div style="flex: 2;"></div></div></div> <div class="c-task-duration svelte-1jzxame"><!></div></article>');function Qt(a,t){nt(t,!0);let e=Rt(t,"vm",7);const c={icon:i=>{switch(i.state){case o.Running:return w.TaskPause;case o.Paused:return w.TaskResume;case o.Stopped:return w.TaskDuplicateAndStart}},hint:i=>{switch(i.state){case o.Running:return"Pause";case o.Paused:return"Resume";case o.Stopped:return"Start a new copy"}},execute:i=>{switch(i.state){case o.Running:t.taskController.pauseTask(i);break;case o.Paused:t.taskController.startTask(i);break;case o.Stopped:t.taskController.duplicateAndStartTask(i);break}}},f={icon:i=>{switch(i.state){case o.Running:return w.TaskStop;case o.Paused:return w.TaskStop;case o.Stopped:return w.TaskResume}},hint:i=>{switch(i.state){case o.Running:return"Stop";case o.Paused:return"Stop";case o.Stopped:return"Start"}},execute:i=>{switch(i.state){case o.Running:t.taskController.stopTask(i);break;case o.Paused:t.taskController.stopTask(i);break;case o.Stopped:t.taskController.startTask(i);break}}};function x(i,G){let $=G?1:15;t.taskController.increaseDuration(e(),i?$:-$)}var l=Jt(),b=n(l),y=n(b);et(y),y.__input=[vt,t,e];var h=v(y,2);et(h),h.__input=[vt,t,e];var S=v(h,2),j=n(S),r=v(n(j),2);{var k=i=>{var G=Ot(),$=n(G);s(G),U(()=>F($,`Attached to Invoice Id: ${e().invoiceRefId??""}`)),g(i,G)};H(r,i=>{e().invoiceRefId.length>0&&i(k)})}var _=v(r,2),T=n(_);et(T),T.__input=[Wt,t,e];var R=v(T,2);R.__click=[Gt,t,e],s(_),s(j),dt(2),s(S),s(b);var P=v(b,2),B=n(P);const N=M(()=>c.icon(e()));var m=M(()=>d(N));const u=M(()=>c.hint(e()));var D=M(()=>d(u));const L=M(()=>f.icon(e()));var z=M(()=>d(L));const I=M(()=>f.hint(e()));var W=M(()=>d(I));Et(B,{get durationSeconds(){return e().duration},get affectiveDurationHours(){return e().affectiveDurationHours},onIncreaseDuration:x,get icon1(){return d(m)},onAction1Click:()=>c.execute(e()),get action1Hint(){return d(D)},get icon2(){return d(z)},onAction2Click:()=>f.execute(e()),get action2Hint(){return d(W)}}),s(P),s(l),U(()=>It(l,"s-running",e().state==o.Running)),at(y,()=>e().date,i=>e().date=i),at(h,()=>e().name,i=>e().name=i),at(T,()=>e().tagsAsText,i=>e().tagsAsText=i),g(a,l),it()}mt(["input","click"]);var Xt=p("<div><!></div>");function tt(a,t){var e=ct(),c=st(e);kt(c,19,()=>t.tasks,f=>f.id,(f,x)=>{var l=Xt(),b=n(l);Qt(b,{get vm(){return d(x)},get taskController(){return t.taskController}}),s(l),xt(3,l,()=>yt,()=>({duration:200})),g(f,l)}),g(a,e)}var Yt=p("<option></option>"),Zt=p('<datalist id="list-task-names"></datalist>'),$t=p('<form><fieldset role="group" class="svelte-1ps283u"><input name="task-name" type="text" placeholder="Whatcha doin?" spellcheck="true" list="list-task-names"> <!> <input type="submit" value="Start" class="svelte-1ps283u"></fieldset></form>');function te(a,t){nt(t,!0);let e=O("");function c(h){h.preventDefault(),t.onStartTask(d(e)),q(e,"")}var f=$t(),x=n(f),l=n(x);et(l);var b=v(l,2);{var y=h=>{var S=Zt();kt(S,21,()=>t.previousTasksList,pt,(j,r)=>{var k=Yt(),_={};U(()=>{_!==(_=d(r).name)&&(k.value=(k.__value=d(r).name)==null?"":d(r).name)}),g(j,k)}),s(S),g(h,S)};H(b,h=>{t.previousTasksList&&h(y)})}dt(2),s(x),s(f),bt("submit",f,c),at(l,()=>d(e),h=>q(e,h)),g(a,f),it()}var J,Q,X,Y,Z;class ee{constructor(){K(this,J,O(C([])));K(this,Q,O(C([])));K(this,X,O(C([])));K(this,Y,O(C([])));K(this,Z,O(C([])));V(this,"intervalId")}get previouslyUsedTasks(){return d(A(this,J))}set previouslyUsedTasks(t){q(A(this,J),C(t))}get tasksRunning(){return d(A(this,Q))}set tasksRunning(t){q(A(this,Q),C(t))}get tasksPaused(){return d(A(this,X))}set tasksPaused(t){q(A(this,X),C(t))}get tasksStopped(){return d(A(this,Y))}set tasksStopped(t){q(A(this,Y),C(t))}get tasksArchived(){return d(A(this,Z))}set tasksArchived(t){q(A(this,Z),C(t))}start(){this.stop(),this.refresh();for(const t of this.tasksRunning)t.recalculateDurationFromRunningSession();this.intervalId=setInterval(()=>this.incrementRunningTaskDuration(),1e3)}stop(){this.intervalId&&clearInterval(this.intervalId)}refresh(){const t=rt.taskRepo.getAll().map(e=>new ot(e));this.previouslyUsedTasks=t.sort((e,c)=>e.date>c.date?-1:1).slice(0,20),this.tasksRunning=this.fetchTasksByState(t,[o.Running]),this.tasksPaused=this.fetchTasksByState(t,[o.Paused]),this.tasksStopped=this.fetchTasksByState(t,[o.Stopped]),this.tasksArchived=this.fetchTasksByState(t,[o.Archived])}fetchTasksByState(t,e){return t.filter(c=>e.includes(c.state))}startNewTask(t){const e=new ot;e.name=t,this.startTask(e)}saveTask(t){rt.taskRepo.set(t.id,t.getModel())}pauseAll(){this.refresh();for(const t of this.tasksRunning)t.pause(),this.saveTask(t);this.refresh()}incrementRunningTaskDuration(){for(const t of this.tasksRunning)t.setDuration(t.duration+1),this.saveTask(t)}pauseTask(t){t.pause(),this.saveTask(t),this.refresh()}startTask(t){this.pauseAll(),t.start(),this.saveTask(t),this.refresh()}stopTask(t){t.stop(),this.saveTask(t),this.refresh()}duplicateAndStartTask(t){const e=new ot(t.getModel(crypto.randomUUID()));e.setDuration(0),e.date=St.toInputDateValue(new Date),e.invoiceRefId="",this.startTask(e)}increaseDuration(t,e){t.incrementDuration(e),this.saveTask(t)}deleteTask(t){rt.taskRepo.remove(t.id),this.refresh()}}J=new WeakMap,Q=new WeakMap,X=new WeakMap,Y=new WeakMap,Z=new WeakMap;var ae=p("<h2>Time Log</h2> <!> <section><summary> </summary> <!></section> <section><summary> </summary> <!></section> <section><details><summary> </summary> <!></details></section> <section><details><summary> </summary> <!></details></section>",1);function _e(a,t){nt(t,!0);let e=C(new ee);gt(()=>{e.start()}),Tt(()=>{e.stop()});var c=ae(),f=v(st(c),2);te(f,{onStartTask:L=>e.startNewTask(L),get previousTasksList(){return e.previouslyUsedTasks}});var x=v(f,2),l=n(x),b=n(l);s(l);var y=v(l,2);tt(y,{get taskController(){return e},get tasks(){return e.tasksRunning}}),s(x);var h=v(x,2),S=n(h),j=n(S);s(S);var r=v(S,2);tt(r,{get taskController(){return e},get tasks(){return e.tasksPaused}}),s(h);var k=v(h,2),_=n(k),T=n(_),R=n(T);s(T);var P=v(T,2);tt(P,{get taskController(){return e},get tasks(){return e.tasksStopped}}),s(_),s(k);var B=v(k,2),N=n(B),m=n(N),u=n(m);s(m);var D=v(m,2);tt(D,{get taskController(){return e},get tasks(){return e.tasksArchived}}),s(N),s(B),U(()=>{F(b,`In Progress (${e.tasksRunning.length??""})`),F(j,`Paused (${e.tasksPaused.length??""})`),F(R,`Stopped (${e.tasksStopped.length??""})`),F(u,`Archived (${e.tasksArchived.length??""})`)}),g(a,c),it()}export{_e as component};
