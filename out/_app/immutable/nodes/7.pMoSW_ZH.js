import{a as L,t as R}from"../chunks/CQeaYElY.js";import{p as de,c as i,r as a,s as r,t as z,a as ue,ab as oe,o as n,ac as Z,f as ne,a7 as D,ar as ye}from"../chunks/mCM1Q4f2.js";import{s as F}from"../chunks/BkpIIv3x.js";import{i as fe}from"../chunks/_9f2rokR.js";import{e as le,i as ce}from"../chunks/BwirJsZk.js";import{r as x}from"../chunks/DZlsR1It.js";import{d as _e,r as ve}from"../chunks/MeqorYnI.js";import{b as _,c as pe}from"../chunks/NsD9lZuA.js";import{p as I}from"../chunks/BTF6Oz8w.js";import{o as Ie}from"../chunks/BRateF5a.js";import{p as be}from"../chunks/D_JG7fFS.js";import{F as ee}from"../chunks/CF8cNsMY.js";import{I as se,T as we,a as Te,F as Ae,b as Le}from"../chunks/DkNHlwz-.js";import{s as $,a as me,t as he,i as Re}from"../chunks/Co2-gIP7.js";var Ce=R('<tr class="c-line svelte-fbae20"><td class="svelte-fbae20"><input name="line-num" type="number" min="1" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-desc" type="text" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-qty" type="number" step="0.25" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-units" type="text" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-unit-cost" type="number" class="svelte-fbae20"></td><td style="text-align: right;" class="svelte-fbae20"> </td></tr>');function Se(f,s){de(s,!0);let e=be(s,"vm",7);var l=Ce(),c=i(l),h=i(c);x(h),a(c);var p=r(c),w=i(p);x(w),a(p);var b=r(p),C=i(b);x(C),a(b);var g=r(b),T=i(g);x(T),a(g);var S=r(g),A=i(S);x(A),a(S);var k=r(S),M=i(k,!0);a(k),a(l),z(v=>F(M,v),[()=>ee.currency(e().total,s.currencyCode)]),_(h,()=>e().number,v=>e().number=v),_(w,()=>e().description,v=>e().description=v),_(C,()=>e().quantity,v=>e().quantity=v),_(T,()=>e().units,v=>e().units=v),_(A,()=>e().unitCost,v=>e().unitCost=v),L(f,l),ue()}var Pe=(f,s)=>s().addLine(),Ne=(f,s)=>s().sortLines(),De=(f,s,e)=>s.onPreviewInvoice(e()),Fe=(f,s,e)=>s.onBuildInvoice(e()),Me=R('<article id="working-invoice-container" class="svelte-1afk9pg"><header>Working Invoice</header> <fieldset class="row svelte-1afk9pg"><input name="inv-num" type="text" title="Invoice Number" placeholder="Invoice Number" class="svelte-1afk9pg"> <input name="inv-date" type="date" title="Invoice Date" class="svelte-1afk9pg"> <input name="inv-order" type="text" title="Order #" placeholder="Order #" class="svelte-1afk9pg"> <div style="flex: 99 1 auto"></div></fieldset> <label>Issue to <textarea name="inv-issue-to" title="Address of the company or person being issued to"></textarea></label> <section><button class="svelte-1afk9pg">Add Line</button> <button class="secondary svelte-1afk9pg">Sort Lines</button></section> <table id="working-inv-lines" class="striped svelte-1afk9pg"><thead><tr><th class="svelte-1afk9pg">Line No.</th><th style="width: 100%;" class="svelte-1afk9pg">Description</th><th class="svelte-1afk9pg">Quantity</th><th class="svelte-1afk9pg">Units</th><th class="svelte-1afk9pg">Unit Cost</th><th class="svelte-1afk9pg">Total</th></tr></thead><tbody></tbody><tfoot><tr><th colspan="3" rowspan="3" style="vertical-align: top;" class="svelte-1afk9pg"></th><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">Subtotal:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">GST:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">Grand Total:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr></tfoot></table> <label>Footnote <textarea name="inv-footnote"></textarea></label> <footer><button class="secondary svelte-1afk9pg">Preview</button> <button class="svelte-1afk9pg">Build</button></footer></article>');function Ee(f,s){de(s,!0);let e=be(s,"vm",7);var l=Me(),c=r(i(l),2),h=i(c);x(h);var p=r(h,2);x(p);var w=r(p,2);x(w),oe(2),a(c);var b=r(c,2),C=r(i(b));ve(C),a(b);var g=r(b,2),T=i(g);T.__click=[Pe,e];var S=r(T,2);S.__click=[Ne,e],a(g);var A=r(g,2),k=r(i(A));le(k,21,()=>e().lines,ce,(u,N)=>{Se(u,{get vm(){return n(N)},get currencyCode(){return e().currencyCode}})}),a(k);var M=r(k),v=i(M),B=r(i(v),2),J=i(B,!0);a(B),a(v);var P=r(v),W=r(i(P)),K=i(W,!0);a(W),a(P);var E=r(P),X=r(i(E)),te=i(X,!0);a(X),a(E),a(M),a(A);var q=r(A,2),H=r(i(q));ve(H),a(q);var U=r(q,2),G=i(U);G.__click=[De,s,e];var Y=r(G,2);Y.__click=[Fe,s,e],a(U),a(l),z((u,N,ae)=>{F(J,u),F(K,N),F(te,ae)},[()=>ee.currency(e().subtotal,e().currencyCode),()=>ee.currency(e().taxTotal,e().currencyCode),()=>ee.currency(e().grandTotal,e().currencyCode)]),_(h,()=>e().number,u=>e().number=u),_(p,()=>e().date,u=>e().date=u),_(w,()=>e().orderRef,u=>e().orderRef=u),_(C,()=>e().issueToAsText,u=>e().issueToAsText=u),_(H,()=>e().footnoteAsText,u=>e().footnoteAsText=u),L(f,l),ue()}_e(["click"]);var Ue=R('<label><input id="untagged-select-all" type="checkbox"> Select All</label> <hr>',1),Ve=R('<div class="c-task-line svelte-1fy7v30"><label><input name="task-line" type="checkbox"> </label></div>'),Be=R("<!> <!>",1),We=R("<p><i>All time has been accounted for.</i></p>"),qe=(f,s)=>s(),He=(f,s,e)=>{f.preventDefault(),s(n(e).id,{preview:!1})},Ge=R('<article> <a href="##">View</a></article>'),Oe=R('<h2>Invoice Builder</h2> <div id="container"><section id="row1" class="svelte-1fy7v30"><!> <div class="c-col-2 svelte-1fy7v30"><article class="time-list svelte-1fy7v30"><header>Uninvoiced Time</header> <!></article> <article class="scratch-pad svelte-1fy7v30"><header>Scratch Pad</header> <textarea name="scratch-pad" class="svelte-1fy7v30"></textarea></article></div></section> <section id="row2"><article><details><summary> </summary> <!></details></article></section></div>',1);function nt(f,s){de(s,!0);let e=Z(1),l=Z(I(new se)),c=Z(I([])),h=Z(""),p=Z(I([]));Ie(()=>{b(),D(h,I($.getScratchPad("page-invoice-builder"))),D(c,I(g())),D(p,I(w()))});function w(){return me.getAll().map(t=>new se(t))}function b(){const t=$.read();D(l,I(new se)),n(l).number=`${t.nextInvoiceNumber}`,n(l).footnoteAsText=t.defaultInvoiceFooter??""}function C(){$.setScratchPad("page-invoice-builder",n(h))}function g(){return he.getAll().filter(t=>t.invoiceRefId.length==0&&t.state==we.Stopped).map(t=>new Te(t))}function T(t){const o=new Le;return o.number=ye(e),o.extRefId=t.id,o.description=`${t.date} - ${t.name}`,o.units="hr",o.quantity=t.affectiveDurationHours,o.unitCost=200,o}function S(t){Re.set(t.id,t.getModel()),k(t.id,{preview:!0})}function A(t){me.set(t.id,t.getModel());const o=n(l).lines.map(d=>d.extRefId).filter(d=>d&&d.length>0),m=n(c).filter(d=>o.includes(d.id));for(const d of m)d.invoiceRefId=n(l).id,he.set(d.id,d.getModel());$.modify(d=>{d.nextInvoiceNumber++}),D(p,I(w())),D(c,I(g())),b(),k(t.id,{preview:!1})}function k(t,o){const m=["/view-invoice"];o.preview&&m.push("preview"),m.push(t),window.open(m.join("/"),`inv-${t}`)}function M(){if(n(c).length==0)return!1;for(const t of n(c))if(!n(l).containsExtRefId(t.id))return!1;return!0}function v(t){for(const o of n(c))t?n(l).addLine(T(o)):n(l).removeLineWithExtRefId(o.id)}var B=Oe(),J=r(ne(B),2),P=i(J),W=i(P);Ee(W,{get vm(){return n(l)},onBuildInvoice:A,onPreviewInvoice:S});var K=r(W,2),E=i(K),X=r(i(E),2);{var te=t=>{var o=Be(),m=ne(o);{var d=O=>{var y=Ue(),V=ne(y),j=i(V);x(j),oe(),a(V),oe(2),pe(j,()=>M(),Q=>v(Q)),L(O,y)};fe(m,O=>{n(c).length>1&&O(d)})}var re=r(m,2);le(re,17,()=>n(c),ce,(O,y)=>{var V=Ve(),j=i(V),Q=i(j);x(Q);var ke=r(Q);a(j),a(V),z((ie,xe)=>F(ke,` ${ie??""} (${xe??""} hrs) - ${n(y).name??""}`),[()=>Ae.toLocalDatefromString(n(y).date,"en-NZ"),()=>n(y).affectiveDurationHours.toFixed(2)]),pe(Q,()=>n(l).containsExtRefId(n(y).id),ie=>{ie?n(l).addLine(T(n(y))):n(l).removeLineWithExtRefId(n(y).id)}),L(O,V)}),L(t,o)},q=t=>{var o=We();L(t,o)};fe(X,t=>{n(c).length!=0?t(te):t(q,!1)})}a(E);var H=r(E,2),U=r(i(H),2);ve(U),U.__input=[qe,C],a(H),a(K),a(P);var G=r(P,2),Y=i(G),u=i(Y),N=i(u),ae=i(N);a(N);var ge=r(N,2);le(ge,17,()=>n(p),ce,(t,o)=>{var m=Ge(),d=i(m),re=r(d);re.__click=[He,k,o],a(m),z(()=>F(d,`${n(o).number??""} `)),L(t,m)}),a(u),a(Y),a(G),a(J),z(()=>F(ae,`Closed Invoices (${n(p).length??""})`)),_(U,()=>n(h),t=>D(h,t)),L(f,B),ue()}_e(["input","click"]);export{nt as component};
