import{a as U,t as H}from"../chunks/9FMlr9EW.js";import{p as pe,c as s,r,s as i,t as X,a as ge,i as ue,l as o,j as re,f as ve,k as E}from"../chunks/Dv6h_wod.js";import{s as B}from"../chunks/2E_t980S.js";import{i as be}from"../chunks/XIZln9K_.js";import{e as fe,i as he}from"../chunks/DeHa4jcw.js";import{r as T}from"../chunks/Ber1wtzw.js";import{d as me,b as oe}from"../chunks/DBnRoAt3.js";import{b as _,c as ye}from"../chunks/BLwI1Dal.js";import{p as S}from"../chunks/Dt7jNuNY.js";import{o as Le}from"../chunks/CO77eEDg.js";import{p as ke}from"../chunks/CvF7aV3A.js";import{F as se}from"../chunks/C1UJn8Ae.js";import{I as Te,f as Re}from"../chunks/C1wgc95Z.js";import{a as L,I as de,T as Ae,b as De,F as Se,c as Ne}from"../chunks/Uwi_F8rl.js";function Fe(y,l){y.preventDefault(),l.onRemoveLine()}var Pe=H('<tr class="c-line svelte-fbae20"><td class="svelte-fbae20"><input name="line-num" type="number" min="1" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-desc" type="text" spellcheck="true" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-qty" type="number" step="0.25" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-units" type="text" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-unit-cost" type="number" class="svelte-fbae20"></td><td style="text-align: right;" class="svelte-fbae20"> </td><td class="svelte-fbae20"><a href="##"><!></a></td></tr>');function Ue(y,l){pe(l,!0);let n=ke(l,"vm",7);var d=Pe(),h=s(d),p=s(h);T(p),p.__change=function(...v){var u;(u=l.onChange)==null||u.apply(this,v)},r(h);var g=i(h),R=s(g);T(R),R.__change=function(...v){var u;(u=l.onChange)==null||u.apply(this,v)},r(g);var k=i(g),x=s(k);T(x),x.__change=function(...v){var u;(u=l.onChange)==null||u.apply(this,v)},r(k);var A=i(k),I=s(A);T(I),I.__change=function(...v){var u;(u=l.onChange)==null||u.apply(this,v)},r(A);var w=i(A),N=s(w);T(N),N.__change=function(...v){var u;(u=l.onChange)==null||u.apply(this,v)},r(w);var m=i(w),M=s(m,!0);r(m);var C=i(m),F=s(C);F.__click=[Fe,l];var V=s(F);Te(V,{icon:Re}),r(F),r(C),r(d),X(v=>B(M,v),[()=>se.currency(n().total,l.currencyCode)]),_(p,()=>n().number,v=>n().number=v),_(R,()=>n().description,v=>n().description=v),_(x,()=>n().quantity,v=>n().quantity=v),_(I,()=>n().units,v=>n().units=v),_(N,()=>n().unitCost,v=>n().unitCost=v),U(y,d),ge()}me(["change","click"]);var He=H('<article id="working-invoice-container" class="svelte-1afk9pg"><header>Working Invoice</header> <fieldset class="row svelte-1afk9pg"><input name="inv-num" type="text" title="Invoice Number" placeholder="Invoice Number" class="svelte-1afk9pg"> <input name="inv-date" type="date" title="Invoice Date" class="svelte-1afk9pg"> <input name="inv-order" type="text" title="Order #" placeholder="Order #" class="svelte-1afk9pg"> <div style="flex: 99 1 auto"></div></fieldset> <label>Header Lines <textarea name="inv-header" title="Header lines for the invoice" spellcheck="true" placeholder="Header lines for the invoice"></textarea></label> <label>Issue to <textarea name="inv-issue-to" title="Address of the company or person being issued to" spellcheck="true" placeholder="Who will receive the invoice?"></textarea></label> <section><button class="svelte-1afk9pg">Add Line</button> <button class="secondary svelte-1afk9pg">Sort Lines</button></section> <table id="working-inv-lines" class="striped svelte-1afk9pg"><thead><tr><th class="svelte-1afk9pg">Line No.</th><th style="width: 100%;" class="svelte-1afk9pg">Description</th><th class="svelte-1afk9pg">Quantity</th><th class="svelte-1afk9pg">Units</th><th class="svelte-1afk9pg">Unit Cost</th><th class="svelte-1afk9pg">Total</th><th class="svelte-1afk9pg"></th></tr></thead><tbody></tbody><tfoot><tr><th colspan="3" rowspan="3" style="vertical-align: top;" class="svelte-1afk9pg"></th><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">Subtotal:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">GST:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">Grand Total:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr></tfoot></table> <label>Footnote <textarea name="inv-footnote" spellcheck="true" placeholder="Optional Footnote"></textarea></label> <footer style="display: flex; justify-content: space-between;"><button class="secondary svelte-1afk9pg">Preview</button> <button class="svelte-1afk9pg">Build</button> <button class="secondary svelte-1afk9pg">Reset</button></footer></article>');function Me(y,l){pe(l,!0);let n=ke(l,"vm",7);var d=He(),h=i(s(d),2),p=s(h);T(p),p.__change=function(...t){var a;(a=l.onChange)==null||a.apply(this,t)};var g=i(p,2);T(g),g.__change=function(...t){var a;(a=l.onChange)==null||a.apply(this,t)};var R=i(g,2);T(R),R.__change=function(...t){var a;(a=l.onChange)==null||a.apply(this,t)},ue(2),r(h);var k=i(h,2),x=i(s(k));oe(x),x.__change=function(...t){var a;(a=l.onChange)==null||a.apply(this,t)},r(k);var A=i(k,2),I=i(s(A));oe(I),I.__change=function(...t){var a;(a=l.onChange)==null||a.apply(this,t)},r(A);var w=i(A,2),N=s(w);N.__click=function(...t){var a;(a=l.onAddLine)==null||a.apply(this,t)};var m=i(N,2);m.__click=function(...t){var a;(a=l.onSortLines)==null||a.apply(this,t)},r(w);var M=i(w,2),C=i(s(M));fe(C,21,()=>n().lines,he,(t,a)=>{Ue(t,{get currencyCode(){return n().currencyCode},get vm(){return o(a)},onRemoveLine:()=>l.onRemoveLine(o(a)),get onChange(){return l.onChange}})}),r(C);var F=i(C),V=s(F),v=i(s(V),2),u=s(v,!0);r(v),r(V);var Q=i(V),Z=i(s(Q)),Y=s(Z,!0);r(Z),r(Q);var z=i(Q),O=i(s(z)),$=s(O,!0);r(O),r(z),r(F),r(M);var q=i(M,2),W=i(s(q));oe(W),W.__change=function(...t){var a;(a=l.onChange)==null||a.apply(this,t)},r(q);var ee=i(q,2),te=s(ee);te.__click=function(...t){var a;(a=l.onPreviewInvoice)==null||a.apply(this,t)};var ae=i(te,2);ae.__click=function(...t){var a;(a=l.onBuildInvoice)==null||a.apply(this,t)};var ne=i(ae,2);ne.__click=function(...t){var a;(a=l.onResetInvoice)==null||a.apply(this,t)},r(ee),r(d),X((t,a,ie)=>{B(u,t),B(Y,a),B($,ie)},[()=>se.currency(n().subtotal,n().currencyCode),()=>se.currency(n().taxTotal,n().currencyCode),()=>se.currency(n().grandTotal,n().currencyCode)]),_(p,()=>n().number,t=>n().number=t),_(g,()=>n().date,t=>n().date=t),_(R,()=>n().orderRef,t=>n().orderRef=t),_(x,()=>n().headerLinesAsText,t=>n().headerLinesAsText=t),_(I,()=>n().issueToAsText,t=>n().issueToAsText=t),_(W,()=>n().footnoteAsText,t=>n().footnoteAsText=t),U(y,d),ge()}me(["change","click"]);var Ve=H('<label><input id="untagged-select-all" type="checkbox"> Select All</label> <hr>',1),We=H('<div class="c-task-line svelte-1fy7v30"><label><input name="task-line" type="checkbox"> </label></div>'),Ee=H("<!> <!>",1),Be=H("<p><i>All time has been accounted for.</i></p>"),Oe=(y,l)=>l(),qe=(y,l,n)=>{y.preventDefault(),l(o(n).id)},je=H('<article> <a href="##">View</a></article>'),Ge=H('<h2>Invoice Builder</h2> <div id="container"><section id="row1" class="svelte-1fy7v30"><!> <div class="c-col-2 svelte-1fy7v30"><article class="time-list svelte-1fy7v30"><header>Uninvoiced Time</header> <!></article> <article class="scratch-pad svelte-1fy7v30"><header>Scratch Pad</header> <textarea name="scratch-pad" class="svelte-1fy7v30"></textarea></article></div></section> <section id="row2"><article><details><summary> </summary> <!></details></article></section></div>',1);function ot(y,l){pe(l,!0);const n="draft";let d=re(S(R())),h=re(S([])),p=re(""),g=re(S([]));Le(()=>{E(p,S(L.settingsController.getScratchPad("page-invoice-builder"))),E(h,S(I())),E(g,S(k()))});function R(){var e=L.invRepo.get(n);return e?new de(e):x()}function k(){return L.invRepo.getAll().filter(e=>e.id!=n).map(e=>new de(e)).sort((e,c)=>{const b=new Date(e.date).valueOf(),f=new Date(c.date).valueOf();if(b>f)return-1;if(b<f)return 1;const j=c.number,P=e.number;return P>j?-1:P<j||e.id>c.id?1:e.id<c.id?-1:0})}function x(){const e=L.settingsController.read(),c=new de;return c.id=n,c.headerLinesAsText=e.defaultInvoiceHeader??"",c.currencyCode=e.defaultInvoiceCurrencyCode,c.number=`${e.nextInvoiceNumber}`,c.footnoteAsText=e.defaultInvoiceFooter??"",c}function A(){L.settingsController.setScratchPad("page-invoice-builder",o(p))}function I(){return L.taskRepo.getAll().filter(e=>e.invoiceRefId.length==0&&e.state==Ae.Stopped).map(e=>new De(e))}function w(e){const c=new Ne;return c.extRefId=e.id,c.description=`${e.date} - ${e.name}`,c.units="hr",c.quantity=e.affectiveDurationHours,c.unitCost=200,c}function N(){m(),C(o(d).id)}function m(){L.invRepo.set(o(d).id,o(d).getModel())}function M(){const e=o(d).getModel();e.id=crypto.randomUUID(),L.invRepo.set(e.id,e);const c=o(d).lines.map(f=>f.extRefId).filter(f=>f&&f.length>0),b=o(h).filter(f=>c.includes(f.id));for(const f of b)f.invoiceRefId=o(d).id,L.taskRepo.set(f.id,f.getModel());L.settingsController.incrementNextInvoiceNumber(),E(g,S(k())),E(h,S(I())),Z(),C(e.id)}function C(e){window.open(`/view-invoice/${e}`,`inv-${e}`)}function F(){if(o(h).length==0)return!1;for(const e of o(h))if(!o(d).containsExtRefId(e.id))return!1;return!0}function V(e){for(const c of o(h))e?o(d).addLine(w(c)):o(d).removeLineWithExtRefId(c.id)}function v(){o(d).addLine(),m()}function u(e){o(d).removeLineWithId(e.id),m()}function Q(){o(d).sortAndRenumberLines(),m()}function Z(){E(d,S(x())),m()}var Y=Ge(),z=i(ve(Y),2),O=s(z),$=s(O);Me($,{get vm(){return o(d)},onChange:m,onAddLine:v,onRemoveLine:u,onSortLines:Q,onBuildInvoice:M,onPreviewInvoice:N,onResetInvoice:Z});var q=i($,2),W=s(q),ee=i(s(W),2);{var te=e=>{var c=Ee(),b=ve(c);{var f=P=>{var D=Ve(),G=ve(D),J=s(G);T(J),ue(),r(G),ue(2),ye(J,()=>F(),K=>V(K)),U(P,D)};be(b,P=>{o(h).length>1&&P(f)})}var j=i(b,2);fe(j,17,()=>o(h),he,(P,D)=>{var G=We(),J=s(G),K=s(J);T(K);var we=i(K);r(J),r(G),X((ce,Ce)=>B(we,` ${ce??""} (${Ce??""} hrs) - ${o(D).name??""}`),[()=>Se.toLocalDatefromString(o(D).date,"en-NZ"),()=>o(D).affectiveDurationHours.toFixed(2)]),ye(K,()=>o(d).containsExtRefId(o(D).id),ce=>{ce?o(d).addLine(w(o(D))):o(d).removeLineWithExtRefId(o(D).id)}),U(P,G)}),U(e,c)},ae=e=>{var c=Be();U(e,c)};be(ee,e=>{o(h).length!=0?e(te):e(ae,!1)})}r(W);var ne=i(W,2),t=i(s(ne),2);oe(t),t.__input=[Oe,A],r(ne),r(q),r(O);var a=i(O,2),ie=s(a),_e=s(ie),le=s(_e),xe=s(le);r(le);var Ie=i(le,2);fe(Ie,17,()=>o(g),he,(e,c)=>{var b=je(),f=s(b),j=i(f);j.__click=[qe,C,c],r(b),X(()=>B(f,`${o(c).number??""} `)),U(e,b)}),r(_e),r(ie),r(a),r(z),X(()=>B(xe,`Closed Invoices (${o(g).length??""})`)),_(t,()=>o(p),e=>E(p,e)),U(y,Y),ge()}me(["input","click"]);export{ot as component};
