import{a as A,t as L}from"../chunks/CBmAC5jC.js";import{p as de,c as i,r as a,s as r,t as z,a as ue,V as oe,o as n,W as Z,f as ne,N as D,aa as xe}from"../chunks/B3quWTxq.js";import{s as F}from"../chunks/D1LvbsoL.js";import{i as fe}from"../chunks/Cl6SPXql.js";import{r as y,e as le,i as ce}from"../chunks/DvSaprfN.js";import{d as _e,r as ve}from"../chunks/B8pIN4OL.js";import{b as _,c as pe}from"../chunks/fyUcucyq.js";import{p as I}from"../chunks/DwbFJCge.js";import{o as Ie}from"../chunks/CgBeF7EA.js";import{p as be}from"../chunks/BsDv9xhu.js";import{F as ee}from"../chunks/C1UJn8Ae.js";import{I as se,T as we,a as Te,b as Ce}from"../chunks/C7YH_Jd7.js";import{s as $,a as me,t as he,i as Ae}from"../chunks/Dk709sgr.js";import{F as Le}from"../chunks/DvTEyFA3.js";var Re=L('<tr class="c-line svelte-fbae20"><td class="svelte-fbae20"><input name="line-num" type="number" min="1" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-desc" type="text" spellcheck="true" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-qty" type="number" step="0.25" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-units" type="text" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-unit-cost" type="number" class="svelte-fbae20"></td><td style="text-align: right;" class="svelte-fbae20"> </td></tr>');function Ne(f,s){de(s,!0);let e=be(s,"vm",7);var l=Re(),c=i(l),h=i(c);y(h),a(c);var p=r(c),w=i(p);y(w),a(p);var b=r(p),R=i(b);y(R),a(b);var g=r(b),T=i(g);y(T),a(g);var N=r(g),C=i(N);y(C),a(N);var k=r(N),M=i(k,!0);a(k),a(l),z(v=>F(M,v),[()=>ee.currency(e().total,s.currencyCode)]),_(h,()=>e().number,v=>e().number=v),_(w,()=>e().description,v=>e().description=v),_(R,()=>e().quantity,v=>e().quantity=v),_(T,()=>e().units,v=>e().units=v),_(C,()=>e().unitCost,v=>e().unitCost=v),A(f,l),ue()}var Se=(f,s)=>s().addLine(),Pe=(f,s)=>s().sortLines(),De=(f,s,e)=>s.onPreviewInvoice(e()),Fe=(f,s,e)=>s.onBuildInvoice(e()),Me=L('<article id="working-invoice-container" class="svelte-1afk9pg"><header>Working Invoice</header> <fieldset class="row svelte-1afk9pg"><input name="inv-num" type="text" title="Invoice Number" placeholder="Invoice Number" class="svelte-1afk9pg"> <input name="inv-date" type="date" title="Invoice Date" class="svelte-1afk9pg"> <input name="inv-order" type="text" title="Order #" placeholder="Order #" class="svelte-1afk9pg"> <div style="flex: 99 1 auto"></div></fieldset> <label>Issue to <textarea name="inv-issue-to" title="Address of the company or person being issued to" spellcheck="true"></textarea></label> <section><button class="svelte-1afk9pg">Add Line</button> <button class="secondary svelte-1afk9pg">Sort Lines</button></section> <table id="working-inv-lines" class="striped svelte-1afk9pg"><thead><tr><th class="svelte-1afk9pg">Line No.</th><th style="width: 100%;" class="svelte-1afk9pg">Description</th><th class="svelte-1afk9pg">Quantity</th><th class="svelte-1afk9pg">Units</th><th class="svelte-1afk9pg">Unit Cost</th><th class="svelte-1afk9pg">Total</th></tr></thead><tbody></tbody><tfoot><tr><th colspan="3" rowspan="3" style="vertical-align: top;" class="svelte-1afk9pg"></th><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">Subtotal:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">GST:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">Grand Total:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr></tfoot></table> <label>Footnote <textarea name="inv-footnote" spellcheck="true"></textarea></label> <footer><button class="secondary svelte-1afk9pg">Preview</button> <button class="svelte-1afk9pg">Build</button></footer></article>');function Ve(f,s){de(s,!0);let e=be(s,"vm",7);var l=Me(),c=r(i(l),2),h=i(c);y(h);var p=r(h,2);y(p);var w=r(p,2);y(w),oe(2),a(c);var b=r(c,2),R=r(i(b));ve(R),a(b);var g=r(b,2),T=i(g);T.__click=[Se,e];var N=r(T,2);N.__click=[Pe,e],a(g);var C=r(g,2),k=r(i(C));le(k,21,()=>e().lines,ce,(d,P)=>{Ne(d,{get vm(){return n(P)},get currencyCode(){return e().currencyCode}})}),a(k);var M=r(k),v=i(M),W=r(i(v),2),J=i(W,!0);a(W),a(v);var S=r(v),B=r(i(S)),K=i(B,!0);a(B),a(S);var V=r(S),X=r(i(V)),te=i(X,!0);a(X),a(V),a(M),a(C);var q=r(C,2),H=r(i(q));ve(H),a(q);var E=r(q,2),G=i(E);G.__click=[De,s,e];var Y=r(G,2);Y.__click=[Fe,s,e],a(E),a(l),z((d,P,ae)=>{F(J,d),F(K,P),F(te,ae)},[()=>ee.currency(e().subtotal,e().currencyCode),()=>ee.currency(e().taxTotal,e().currencyCode),()=>ee.currency(e().grandTotal,e().currencyCode)]),_(h,()=>e().number,d=>e().number=d),_(p,()=>e().date,d=>e().date=d),_(w,()=>e().orderRef,d=>e().orderRef=d),_(R,()=>e().issueToAsText,d=>e().issueToAsText=d),_(H,()=>e().footnoteAsText,d=>e().footnoteAsText=d),A(f,l),ue()}_e(["click"]);var Ee=L('<label><input id="untagged-select-all" type="checkbox"> Select All</label> <hr>',1),Ue=L('<div class="c-task-line svelte-1fy7v30"><label><input name="task-line" type="checkbox"> </label></div>'),We=L("<!> <!>",1),Be=L("<p><i>All time has been accounted for.</i></p>"),qe=(f,s)=>s(),He=(f,s,e)=>{f.preventDefault(),s(n(e).id,{preview:!1})},Ge=L('<article> <a href="##">View</a></article>'),Oe=L('<h2>Invoice Builder</h2> <div id="container"><section id="row1" class="svelte-1fy7v30"><!> <div class="c-col-2 svelte-1fy7v30"><article class="time-list svelte-1fy7v30"><header>Uninvoiced Time</header> <!></article> <article class="scratch-pad svelte-1fy7v30"><header>Scratch Pad</header> <textarea name="scratch-pad" class="svelte-1fy7v30"></textarea></article></div></section> <section id="row2"><article><details><summary> </summary> <!></details></article></section></div>',1);function nt(f,s){de(s,!0);let e=Z(1),l=Z(I(new se)),c=Z(I([])),h=Z(""),p=Z(I([]));Ie(()=>{b(),D(h,I($.getScratchPad("page-invoice-builder"))),D(c,I(g())),D(p,I(w()))});function w(){return me.getAll().map(t=>new se(t))}function b(){const t=$.read();D(l,I(new se)),n(l).currencyCode=t.defaultInvoiceCurrencyCode,n(l).number=`${t.nextInvoiceNumber}`,n(l).footnoteAsText=t.defaultInvoiceFooter??""}function R(){$.setScratchPad("page-invoice-builder",n(h))}function g(){return he.getAll().filter(t=>t.invoiceRefId.length==0&&t.state==we.Stopped).map(t=>new Te(t))}function T(t){const o=new Ce;return o.number=xe(e),o.extRefId=t.id,o.description=`${t.date} - ${t.name}`,o.units="hr",o.quantity=t.affectiveDurationHours,o.unitCost=200,o}function N(t){Ae.set(t.id,t.getModel()),k(t.id,{preview:!0})}function C(t){me.set(t.id,t.getModel());const o=n(l).lines.map(u=>u.extRefId).filter(u=>u&&u.length>0),m=n(c).filter(u=>o.includes(u.id));for(const u of m)u.invoiceRefId=n(l).id,he.set(u.id,u.getModel());$.incrementNextInvoiceNumber(),D(p,I(w())),D(c,I(g())),b(),k(t.id,{preview:!1})}function k(t,o){const m=["/view-invoice"];o.preview&&m.push("preview"),m.push(t),window.open(m.join("/"),`inv-${t}`)}function M(){if(n(c).length==0)return!1;for(const t of n(c))if(!n(l).containsExtRefId(t.id))return!1;return!0}function v(t){for(const o of n(c))t?n(l).addLine(T(o)):n(l).removeLineWithExtRefId(o.id)}var W=Oe(),J=r(ne(W),2),S=i(J),B=i(S);Ve(B,{get vm(){return n(l)},onBuildInvoice:C,onPreviewInvoice:N});var K=r(B,2),V=i(K),X=r(i(V),2);{var te=t=>{var o=We(),m=ne(o);{var u=O=>{var x=Ee(),U=ne(x),j=i(U);y(j),oe(),a(U),oe(2),pe(j,()=>M(),Q=>v(Q)),A(O,x)};fe(m,O=>{n(c).length>1&&O(u)})}var re=r(m,2);le(re,17,()=>n(c),ce,(O,x)=>{var U=Ue(),j=i(U),Q=i(j);y(Q);var ke=r(Q);a(j),a(U),z((ie,ye)=>F(ke,` ${ie??""} (${ye??""} hrs) - ${n(x).name??""}`),[()=>Le.toLocalDatefromString(n(x).date,"en-NZ"),()=>n(x).affectiveDurationHours.toFixed(2)]),pe(Q,()=>n(l).containsExtRefId(n(x).id),ie=>{ie?n(l).addLine(T(n(x))):n(l).removeLineWithExtRefId(n(x).id)}),A(O,U)}),A(t,o)},q=t=>{var o=Be();A(t,o)};fe(X,t=>{n(c).length!=0?t(te):t(q,!1)})}a(V);var H=r(V,2),E=r(i(H),2);ve(E),E.__input=[qe,R],a(H),a(K),a(S);var G=r(S,2),Y=i(G),d=i(Y),P=i(d),ae=i(P);a(P);var ge=r(P,2);le(ge,17,()=>n(p),ce,(t,o)=>{var m=Ge(),u=i(m),re=r(u);re.__click=[He,k,o],a(m),z(()=>F(u,`${n(o).number??""} `)),A(t,m)}),a(d),a(Y),a(G),a(J),z(()=>F(ae,`Closed Invoices (${n(p).length??""})`)),_(E,()=>n(h),t=>D(h,t)),A(f,W),ue()}_e(["input","click"]);export{nt as component};
