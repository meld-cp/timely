var St=Object.defineProperty;var ft=a=>{throw TypeError(a)};var wt=(a,t,e)=>t in a?St(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var O=(a,t,e)=>wt(a,typeof t!="symbol"?t+"":t,e),At=(a,t,e)=>t.has(a)||ft("Cannot "+e);var F=(a,t,e)=>(At(a,t,"read from private field"),e?e.call(a):t.get(a)),W=(a,t,e)=>t.has(a)?ft("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,e);import{a as w,t as D,c as lt}from"../chunks/D1Xbq9Mo.js";import{E as Rt,aK as Ct,aL as Dt,z as Pt,k as zt,P as kt,ab as Ft,A as It,n as J,aM as Mt,ap as _t,Z as mt,aq as Lt,p as ot,c as l,s as y,r as u,t as B,o as b,a as ct,v as q,f as nt,V as Tt,N,W as V}from"../chunks/CRiTDDG9.js";import{c as jt,s as U}from"../chunks/D_tVMzu6.js";import{p as I}from"../chunks/dGNHEYVr.js";import{o as qt,a as Et}from"../chunks/DTmORs4h.js";import{s as ht,r as rt,e as yt,i as Ht}from"../chunks/CMmp8lOf.js";import{i as H}from"../chunks/CcJ9c5Jw.js";import{d as xt,g as Nt}from"../chunks/Bt7N_XmN.js";import{b as it}from"../chunks/CJ053N4G.js";import{p as Ut}from"../chunks/BOWfCFyX.js";import{I as K,a as Bt,b as Ot,c as Wt,d as Kt,e as Vt,g as Gt}from"../chunks/DBf8PzCP.js";import{T as g,a as ut}from"../chunks/Ckn_wZO7.js";import{t as vt,F as Zt}from"../chunks/gGzjA1K5.js";function Jt(a,t,e){if(e){if(a.classList.contains(t))return;a.classList.add(t)}else{if(!a.classList.contains(t))return;a.classList.remove(t)}}const Qt=()=>performance.now(),E={tick:a=>requestAnimationFrame(a),now:()=>Qt(),tasks:new Set};function bt(){const a=E.now();E.tasks.forEach(t=>{t.c(a)||(E.tasks.delete(t),t.f())}),E.tasks.size!==0&&E.tick(bt)}function Xt(a){let t;return E.tasks.size===0&&E.tick(bt),{promise:new Promise(e=>{E.tasks.add(t={c:a,f:e})}),abort(){E.tasks.delete(t)}}}function at(a,t){a.dispatchEvent(new CustomEvent(t))}function Yt(a){if(a==="float")return"cssFloat";if(a==="offset")return"cssOffset";if(a.startsWith("--"))return a;const t=a.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(e=>e[0].toUpperCase()+e.slice(1)).join("")}function pt(a){const t={},e=a.split(";");for(const r of e){const[c,d]=r.split(":");if(!c||d===void 0)break;const i=Yt(c.trim());t[i]=d.trim()}return t}const $t=a=>a;function te(a,t,e,r){var c=(a&Mt)!==0,d="both",i,x=t.inert,S=t.style.overflow,s,n;function A(){var h=Lt,m=kt;_t(null),mt(null);try{return i??(i=e()(t,(r==null?void 0:r())??{},{direction:d}))}finally{_t(h),mt(m)}}var v={is_global:c,in(){t.inert=x,at(t,"introstart"),s=dt(t,A(),n,1,()=>{at(t,"introend"),s==null||s.abort(),s=i=void 0,t.style.overflow=S})},out(h){t.inert=!0,at(t,"outrostart"),n=dt(t,A(),s,0,()=>{at(t,"outroend"),h==null||h()})},stop:()=>{s==null||s.abort(),n==null||n.abort()}},f=kt;if((f.transitions??(f.transitions=[])).push(v),jt){var k=c;if(!k){for(var o=f.parent;o&&o.f&Rt;)for(;(o=o.parent)&&!(o.f&Ct););k=!o||(o.f&Dt)!==0}k&&Pt(()=>{zt(()=>v.in())})}}function dt(a,t,e,r,c){var d=r===1;if(Ft(t)){var i,x=!1;return It(()=>{if(!x){var h=t({direction:d?"in":"out"});i=dt(a,h,e,r,c)}}),{abort:()=>{x=!0,i==null||i.abort()},deactivate:()=>i.deactivate(),reset:()=>i.reset(),t:()=>i.t()}}if(e==null||e.deactivate(),!(t!=null&&t.duration))return c(),{abort:J,deactivate:J,reset:J,t:()=>r};const{delay:S=0,css:s,tick:n,easing:A=$t}=t;var v=[];if(d&&e===void 0&&(n&&n(0,1),s)){var f=pt(s(0,1));v.push(f,f)}var k=()=>1-r,o=a.animate(v,{duration:S});return o.onfinish=()=>{var h=(e==null?void 0:e.t())??1-r;e==null||e.abort();var m=r-h,z=t.duration*Math.abs(m),j=[];if(z>0){var T=!1;if(s)for(var p=Math.ceil(z/16.666666666666668),R=0;R<=p;R+=1){var M=h+m*A(R/p),P=pt(s(M,1-M));j.push(P),T||(T=P.overflow==="hidden")}T&&(a.style.overflow="hidden"),k=()=>{var C=o.currentTime;return h+m*A(C/z)},n&&Xt(()=>{if(o.playState!=="running")return!1;var C=k();return n(C,1-C),!0})}o=a.animate(j,{duration:z,fill:"forwards"}),o.onfinish=()=>{k=()=>r,n==null||n(r,1-r),c()}},{abort:()=>{o&&(o.cancel(),o.effect=null,o.onfinish=J)},deactivate:()=>{c=J},reset:()=>{r===0&&(n==null||n(1,0))},t:()=>k()}}var ee=(a,t)=>t.onIncreaseDuration(!0,a.ctrlKey),ae=(a,t)=>t.onIncreaseDuration(!1,a.ctrlKey),se=D('<div class="c-buttons svelte-1ifz5q4"><button class="outline svelte-1ifz5q4" title="Add Time"><!></button> <button class="outline svelte-1ifz5q4" title="Remove Time"><!></button></div>'),re=(a,t)=>t.onAction1Click(),ie=D('<button class="outline svelte-1ifz5q4"><!></button>'),ne=D('<div class="icon"><!></div>'),oe=(a,t)=>t.onAction2Click(),ce=D('<button class="outline secondary svelte-1ifz5q4"><!></button>'),ue=D('<div class="icon secondary"><!></div>'),ve=D('<div class="c-buttons svelte-1ifz5q4"><!> <!></div>'),le=D('<div class="c-main svelte-1ifz5q4"><!> <div class="affective svelte-1ifz5q4"> </div> <div class="counter svelte-1ifz5q4"> </div> <!></div>');function de(a,t){ot(t,!0);let e=q(()=>{const v=Math.floor(Math.abs(t.durationSeconds)/60/60),f=Math.floor(Math.abs(t.durationSeconds/60)),k=Math.abs(f%60),o=Math.abs(t.durationSeconds%60),h=[v.toFixed(0)+"h",k.toFixed(0)+"m",o.toFixed(0)+"s"];return(t.durationSeconds<0?"-":"")+h.join(" ")});var r=le(),c=l(r);{var d=v=>{var f=se(),k=l(f);k.__click=[ee,t];var o=l(k);K(o,{icon:Bt}),u(k);var h=y(k,2);h.__click=[ae,t];var m=l(h);K(m,{icon:Ot}),u(h),u(f),w(v,f)};H(c,v=>{t.onIncreaseDuration&&v(d)})}var i=y(c,2),x=l(i,!0);u(i);var S=y(i,2),s=l(S,!0);u(S);var n=y(S,2);{var A=v=>{var f=ve(),k=l(f);{var o=T=>{var p=ie();p.__click=[re,t];var R=l(p);K(R,{get icon(){return t.icon1}}),u(p),B(()=>ht(p,"title",t.action1Hint)),w(T,p)},h=T=>{var p=lt(),R=nt(p);{var M=P=>{var C=ne(),G=l(C);K(G,{get icon(){return t.icon1}}),u(C),w(P,C)};H(R,P=>{t.icon1&&P(M)},!0)}w(T,p)};H(k,T=>{t.onAction1Click?T(o):T(h,!1)})}var m=y(k,2);{var z=T=>{var p=ce();p.__click=[oe,t];var R=l(p);K(R,{get icon(){return t.icon2}}),u(p),B(()=>ht(p,"title",t.action2Hint)),w(T,p)},j=T=>{var p=lt(),R=nt(p);{var M=P=>{var C=ue(),G=l(C);K(G,{get icon(){return t.icon2}}),u(C),w(P,C)};H(R,P=>{t.icon2&&P(M)},!0)}w(T,p)};H(m,T=>{t.onAction2Click?T(z):T(j,!1)})}u(f),w(v,f)};H(n,v=>{(t.icon1||t.onAction1Click||t.icon2||t.onAction2Click)&&v(A)})}u(r),B(v=>{U(x,v),U(s,b(e))},[()=>{var v;return(v=t.affectiveDurationHours)==null?void 0:v.toFixed(2)}]),w(a,r),ct()}xt(["click"]);class L{}O(L,"TaskPause",Wt),O(L,"TaskResume",Kt),O(L,"TaskStop",Vt),O(L,"TaskDuplicateAndStart",Gt);function gt(a,t,e){t.taskController.saveTask(e())}var fe=D('<span style="flex: content;" class="inv" title="Invoice"> </span>'),ke=(a,t,e)=>{var r;return(r=t.taskController)==null?void 0:r.saveTask(e())},_e=(a,t,e)=>t.taskController.deleteTask(e()),me=D('<article class="c-task svelte-1jzxame"><div class="c-task-fields svelte-1jzxame"><input class="date svelte-1jzxame" name="task-date" type="date" title="Date"> <input class="name svelte-1jzxame" name="task-name" type="text" title="Description" placeholder="Description"> <div class="c-task-fields-row-2 svelte-1jzxame"><details class="svelte-1jzxame"><summary class="svelte-1jzxame">Other</summary> <!> <div style="display: flex; flex-direction: row; gap:1rem; flex-wrap: wrap;"><input style="flex: 10;" class="tags svelte-1jzxame" name="task-tags" type="text" placeholder="Tags" title="Tags"> <button style="flex: content;" class="svelte-1jzxame">Delete</button></div></details> <div style="flex: 2;"></div></div></div> <div class="c-task-duration svelte-1jzxame"><!></div></article>');function he(a,t){ot(t,!0);let e=Ut(t,"vm",7);const r={icon:_=>{switch(_.state){case g.Running:return L.TaskPause;case g.Paused:return L.TaskResume;case g.Stopped:return L.TaskDuplicateAndStart}},hint:_=>{switch(_.state){case g.Running:return"Pause";case g.Paused:return"Resume";case g.Stopped:return"Start a new copy"}},execute:_=>{switch(_.state){case g.Running:t.taskController.pauseTask(_);break;case g.Paused:t.taskController.startTask(_);break;case g.Stopped:t.taskController.duplicateAndStartTask(_);break}}},c={icon:_=>{switch(_.state){case g.Running:return L.TaskStop;case g.Paused:return L.TaskStop;case g.Stopped:return L.TaskResume}},hint:_=>{switch(_.state){case g.Running:return"Stop";case g.Paused:return"Stop";case g.Stopped:return"Start"}},execute:_=>{switch(_.state){case g.Running:t.taskController.stopTask(_);break;case g.Paused:t.taskController.stopTask(_);break;case g.Stopped:t.taskController.startTask(_);break}}};function d(_,Z){let et=Z?1:15;t.taskController.increaseDuration(e(),_?et:-et)}var i=me(),x=l(i),S=l(x);rt(S),S.__input=[gt,t,e];var s=y(S,2);rt(s),s.__input=[gt,t,e];var n=y(s,2),A=l(n),v=y(l(A),2);{var f=_=>{var Z=fe(),et=l(Z);u(Z),B(()=>U(et,`Attached to Invoice Id: ${e().invoiceRefId??""}`)),w(_,Z)};H(v,_=>{e().invoiceRefId.length>0&&_(f)})}var k=y(v,2),o=l(k);rt(o),o.__input=[ke,t,e];var h=y(o,2);h.__click=[_e,t,e],u(k),u(A),Tt(2),u(n),u(x);var m=y(x,2),z=l(m);const j=q(()=>r.icon(e()));var T=q(()=>b(j));const p=q(()=>r.hint(e()));var R=q(()=>b(p));const M=q(()=>c.icon(e()));var P=q(()=>b(M));const C=q(()=>c.hint(e()));var G=q(()=>b(C));de(z,{get durationSeconds(){return e().duration},get affectiveDurationHours(){return e().affectiveDurationHours},onIncreaseDuration:d,get icon1(){return b(T)},onAction1Click:()=>r.execute(e()),get action1Hint(){return b(R)},get icon2(){return b(P)},onAction2Click:()=>c.execute(e()),get action2Hint(){return b(G)}}),u(m),u(i),B(()=>Jt(i,"s-running",e().state==g.Running)),it(S,()=>e().date,_=>e().date=_),it(s,()=>e().name,_=>e().name=_),it(o,()=>e().tagsAsText,_=>e().tagsAsText=_),w(a,i),ct()}xt(["input","click"]);function pe(a){const t=a-1;return t*t*t+1}function ge(a,{delay:t=0,duration:e=400,easing:r=pe,axis:c="y"}={}){const d=getComputedStyle(a),i=+d.opacity,x=c==="y"?"height":"width",S=parseFloat(d[x]),s=c==="y"?["top","bottom"]:["left","right"],n=s.map(m=>`${m[0].toUpperCase()}${m.slice(1)}`),A=parseFloat(d[`padding${n[0]}`]),v=parseFloat(d[`padding${n[1]}`]),f=parseFloat(d[`margin${n[0]}`]),k=parseFloat(d[`margin${n[1]}`]),o=parseFloat(d[`border${n[0]}Width`]),h=parseFloat(d[`border${n[1]}Width`]);return{delay:t,duration:e,easing:r,css:m=>`overflow: hidden;opacity: ${Math.min(m*20,1)*i};${x}: ${m*S}px;padding-${s[0]}: ${m*A}px;padding-${s[1]}: ${m*v}px;margin-${s[0]}: ${m*f}px;margin-${s[1]}: ${m*k}px;border-${s[0]}-width: ${m*o}px;border-${s[1]}-width: ${m*h}px;min-${x}: 0`}}var Te=D("<div><!></div>");function st(a,t){var e=lt(),r=nt(e);yt(r,19,()=>t.tasks,c=>c.id,(c,d)=>{var i=Te(),x=l(i);he(x,{get vm(){return b(d)},get taskController(){return t.taskController}}),u(i),te(3,i,()=>ge,()=>({duration:200})),w(c,i)}),w(a,e)}var ye=D("<option></option>"),xe=D('<datalist id="list-task-names"></datalist>'),be=D('<form><fieldset role="group" class="svelte-1ps283u"><input name="task-name" type="text" placeholder="Whatcha doin?" spellcheck="true" list="list-task-names"> <!> <input type="submit" value="Start" class="svelte-1ps283u"></fieldset></form>');function Se(a,t){ot(t,!0);let e=V("");function r(s){s.preventDefault(),t.onStartTask(b(e)),N(e,"")}var c=be(),d=l(c),i=l(d);rt(i);var x=y(i,2);{var S=s=>{var n=xe();yt(n,21,()=>t.previousTasksList,Ht,(A,v)=>{var f=ye(),k={};B(()=>{k!==(k=b(v).name)&&(f.value=(f.__value=b(v).name)==null?"":b(v).name)}),w(A,f)}),u(n),w(s,n)};H(x,s=>{t.previousTasksList&&s(S)})}Tt(2),u(d),u(c),Nt("submit",c,r),it(i,()=>b(e),s=>N(e,s)),w(a,c),ct()}var Q,X,Y,$,tt;class we{constructor(){W(this,Q,V(I([])));W(this,X,V(I([])));W(this,Y,V(I([])));W(this,$,V(I([])));W(this,tt,V(I([])));O(this,"intervalId")}get previouslyUsedTasks(){return b(F(this,Q))}set previouslyUsedTasks(t){N(F(this,Q),I(t))}get tasksRunning(){return b(F(this,X))}set tasksRunning(t){N(F(this,X),I(t))}get tasksPaused(){return b(F(this,Y))}set tasksPaused(t){N(F(this,Y),I(t))}get tasksStopped(){return b(F(this,$))}set tasksStopped(t){N(F(this,$),I(t))}get tasksArchived(){return b(F(this,tt))}set tasksArchived(t){N(F(this,tt),I(t))}start(){this.stop(),this.refresh();for(const t of this.tasksRunning)t.recalculateDurationFromRunningSession();this.intervalId=setInterval(()=>this.incrementRunningTaskDuration(),1e3)}stop(){this.intervalId&&clearInterval(this.intervalId)}refresh(){const t=vt.getAll().map(e=>new ut(e));this.previouslyUsedTasks=t.sort((e,r)=>e.date>r.date?-1:1).slice(0,20),this.tasksRunning=this.fetchTasksByState(t,[g.Running]),this.tasksPaused=this.fetchTasksByState(t,[g.Paused]),this.tasksStopped=this.fetchTasksByState(t,[g.Stopped]),this.tasksArchived=this.fetchTasksByState(t,[g.Archived])}fetchTasksByState(t,e){return t.filter(r=>e.includes(r.state))}startNewTask(t){const e=new ut;e.name=t,this.startTask(e)}saveTask(t){vt.set(t.id,t.getModel())}pauseAll(){this.refresh();for(const t of this.tasksRunning)t.pause(),this.saveTask(t);this.refresh()}incrementRunningTaskDuration(){for(const t of this.tasksRunning)t.setDuration(t.duration+1),this.saveTask(t)}pauseTask(t){t.pause(),this.saveTask(t),this.refresh()}startTask(t){this.pauseAll(),t.start(),this.saveTask(t),this.refresh()}stopTask(t){t.stop(),this.saveTask(t),this.refresh()}duplicateAndStartTask(t){const e=new ut(t.getModel(crypto.randomUUID()));e.setDuration(0),e.date=Zt.toInputDateValue(new Date),e.invoiceRefId="",this.startTask(e)}increaseDuration(t,e){t.incrementDuration(e),this.saveTask(t)}deleteTask(t){vt.remove(t.id),this.refresh()}}Q=new WeakMap,X=new WeakMap,Y=new WeakMap,$=new WeakMap,tt=new WeakMap;var Ae=D("<h2>Time Log</h2> <!> <section><summary> </summary> <!></section> <section><summary> </summary> <!></section> <section><details><summary> </summary> <!></details></section> <section><details><summary> </summary> <!></details></section>",1);function Ue(a,t){ot(t,!0);let e=I(new we);qt(()=>{e.start()}),Et(()=>{e.stop()});var r=Ae(),c=y(nt(r),2);Se(c,{onStartTask:M=>e.startNewTask(M),get previousTasksList(){return e.previouslyUsedTasks}});var d=y(c,2),i=l(d),x=l(i);u(i);var S=y(i,2);st(S,{get taskController(){return e},get tasks(){return e.tasksRunning}}),u(d);var s=y(d,2),n=l(s),A=l(n);u(n);var v=y(n,2);st(v,{get taskController(){return e},get tasks(){return e.tasksPaused}}),u(s);var f=y(s,2),k=l(f),o=l(k),h=l(o);u(o);var m=y(o,2);st(m,{get taskController(){return e},get tasks(){return e.tasksStopped}}),u(k),u(f);var z=y(f,2),j=l(z),T=l(j),p=l(T);u(T);var R=y(T,2);st(R,{get taskController(){return e},get tasks(){return e.tasksArchived}}),u(j),u(z),B(()=>{U(x,`In Progress (${e.tasksRunning.length??""})`),U(A,`Paused (${e.tasksPaused.length??""})`),U(h,`Stopped (${e.tasksStopped.length??""})`),U(p,`Archived (${e.tasksArchived.length??""})`)}),w(a,r),ct()}export{Ue as component};
