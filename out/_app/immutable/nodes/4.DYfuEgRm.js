import{a as H,t as V}from"../chunks/BpGhemep.js";import{p as W,j as m,s as l,f as $,t as q,a as z,l as r,k as o,c as _,r as b,y as E}from"../chunks/Cxm-zCzI.js";import{d as G,b as J}from"../chunks/BT678Ywi.js";import{s as O}from"../chunks/BqScZFTr.js";import{s as j}from"../chunks/PwPRnE0L.js";import{b as K,a as M}from"../chunks/Bs_tJQfo.js";import{p}from"../chunks/B1dRQCFu.js";import{b as Q}from"../chunks/DsHWS3H0.js";import{a as B,K as X}from"../chunks/AjwCxZEX.js";import{a as Y}from"../chunks/BFa6LZKI.js";import{U as Z}from"../chunks/C_a7cqMs.js";class tt{async backup(t){const e=this.encode(t);this.downloadAsFile(e)}downloadAsFile(t){const e=`${new Date().valueOf()}.timely-backup`;Z.downloadAsFile(t,e)}encode(t){return JSON.stringify(t,null,2)}decodeFromJson(t){return JSON.parse(t)}}function et(c,t,e){t.downloadAsFile(r(e))}async function at(c,t,e){var i;const s=(i=r(t))==null?void 0:i.item(0);s&&o(e,p(await s.text()))}async function rt(c,t,e,s){o(t,!0);try{if(!e)return;await e.backup(s)}finally{o(t,!1)}}async function ot(c,t,e,s,i){o(t,!0);try{if(!e)return;const d=await e.getData();if(!d)throw Error("Invalid data to restore");o(s,p(i.encode(d)))}finally{o(t,!1)}}var st=V('<h2>Backup</h2> <section><article><textarea name="backup-text" class="svelte-1iwmjr1"></textarea> <button>Local Backup</button> <button>Cloud Backup</button></article></section> <h2>Restore</h2> <section><article><div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem;"><input name="restore-file" type="file" accept=".timely-backup"> or <button style="flex-shrink: 0;">Read From Cloud</button></div> <textarea name="restore-text" class="svelte-1iwmjr1"></textarea> <button>Restore</button></article></section>',1);function vt(c,t){W(t,!0);let e=p(B.getAppData());const s=B.settingsController.read();let i=p(Y.build(s.cloudSyncHost,s.cloudSyncUserId,X)),d=m(!1),L=E(()=>i&&!r(d)),k=m(!1),N=E(()=>i&&!r(k));const f=new tt;let v=m(p(f.encode(e))),h=m(void 0),n=m(void 0),y;async function U(){try{if(!r(n))throw Error("No data to restore, select a file first");const a=f.decodeFromJson(r(n));if(!a)throw Error("Invalid data to restore");await B.restoreAppData(a),o(n,void 0),y&&(y.value=""),o(v,p(f.encode(a))),alert("Restored successfully!")}catch(a){alert(a)}}var S=st(),g=l($(S),2),A=_(g),x=_(A);J(x);var C=l(x,2);C.__click=[et,f,v];var w=l(C,2);w.__click=[rt,d,i,e],b(A),b(g);var T=l(g,4),I=_(T),D=_(I),u=_(D);u.__change=[at,h,n],j(u,"flex-shrink","1"),j(u,"margin-bottom","0"),Q(u,a=>y=a,()=>y);var R=l(u,2);R.__click=[ot,k,i,n,f],b(D);var F=l(D,2);J(F);var P=l(F,2);P.__click=U,b(I),b(T),q(()=>{w.disabled=!r(L),O(w,"aria-busy",r(d)),R.disabled=!r(N),O(R,"aria-busy",r(k))}),K(x,()=>r(v),a=>o(v,a)),M(u,()=>r(h),a=>o(h,a)),K(F,()=>r(n),a=>o(n,a)),H(c,S),z()}G(["click","change"]);export{vt as component};
