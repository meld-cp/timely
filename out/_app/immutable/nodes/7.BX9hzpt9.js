import{a as D,t as N}from"../chunks/D1Xbq9Mo.js";import{p as de,c as r,r as a,s as i,t as J,a as ue,V as oe,o as n,W as $,f as ne,N as F}from"../chunks/CRiTDDG9.js";import{s as M}from"../chunks/D_tVMzu6.js";import{i as pe}from"../chunks/CcJ9c5Jw.js";import{r as x,e as le,i as ce}from"../chunks/CMmp8lOf.js";import{d as fe,r as ve}from"../chunks/Bt7N_XmN.js";import{b as g,c as me}from"../chunks/CJ053N4G.js";import{p as T}from"../chunks/dGNHEYVr.js";import{o as xe}from"../chunks/DTmORs4h.js";import{p as be}from"../chunks/BOWfCFyX.js";import{F as te}from"../chunks/C1UJn8Ae.js";import{I as Ie,f as we}from"../chunks/DBf8PzCP.js";import{I as he,T as Te,a as Le,b as Re}from"../chunks/Ckn_wZO7.js";import{s as ee,i as se,t as _e,F as Ce}from"../chunks/gGzjA1K5.js";function Se(p,l){p.preventDefault(),l.onRemoveLine()}var Ae=N('<tr class="c-line svelte-fbae20"><td class="svelte-fbae20"><input name="line-num" type="number" min="1" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-desc" type="text" spellcheck="true" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-qty" type="number" step="0.25" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-units" type="text" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-unit-cost" type="number" class="svelte-fbae20"></td><td style="text-align: right;" class="svelte-fbae20"> </td><td class="svelte-fbae20"><a href="##"><!></a></td></tr>');function De(p,l){de(l,!0);let t=be(l,"vm",7);var o=Ae(),u=r(o),h=r(u);x(h),a(u);var m=i(u),L=r(m);x(L),a(m);var y=i(m),P=r(y);x(P),a(y);var k=i(y),R=r(k);x(R),a(k);var U=i(k),C=r(U);x(C),a(U);var _=i(U),V=r(_,!0);a(_);var S=i(_),I=r(S);I.__click=[Se,l];var E=r(I);Ie(E,{icon:we}),a(I),a(S),a(o),J(v=>M(V,v),[()=>te.currency(t().total,l.currencyCode)]),g(h,()=>t().number,v=>t().number=v),g(L,()=>t().description,v=>t().description=v),g(P,()=>t().quantity,v=>t().quantity=v),g(R,()=>t().units,v=>t().units=v),g(C,()=>t().unitCost,v=>t().unitCost=v),D(p,o),ue()}fe(["click"]);var Ne=(p,l)=>l().addLine(),Pe=(p,l)=>l().sortAndRenumberLines(),Ue=N('<article id="working-invoice-container" class="svelte-1afk9pg"><header>Working Invoice</header> <fieldset class="row svelte-1afk9pg"><input name="inv-num" type="text" title="Invoice Number" placeholder="Invoice Number" class="svelte-1afk9pg"> <input name="inv-date" type="date" title="Invoice Date" class="svelte-1afk9pg"> <input name="inv-order" type="text" title="Order #" placeholder="Order #" class="svelte-1afk9pg"> <div style="flex: 99 1 auto"></div></fieldset> <label>Issue to <textarea name="inv-issue-to" title="Address of the company or person being issued to" spellcheck="true"></textarea></label> <section><button class="svelte-1afk9pg">Add Line</button> <button class="secondary svelte-1afk9pg">Sort Lines</button></section> <table id="working-inv-lines" class="striped svelte-1afk9pg"><thead><tr><th class="svelte-1afk9pg">Line No.</th><th style="width: 100%;" class="svelte-1afk9pg">Description</th><th class="svelte-1afk9pg">Quantity</th><th class="svelte-1afk9pg">Units</th><th class="svelte-1afk9pg">Unit Cost</th><th class="svelte-1afk9pg">Total</th><th class="svelte-1afk9pg"></th></tr></thead><tbody></tbody><tfoot><tr><th colspan="3" rowspan="3" style="vertical-align: top;" class="svelte-1afk9pg"></th><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">Subtotal:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">GST:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">Grand Total:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr></tfoot></table> <label>Footnote <textarea name="inv-footnote" spellcheck="true"></textarea></label> <footer><button class="secondary svelte-1afk9pg">Preview</button> <button class="svelte-1afk9pg">Build</button></footer></article>');function Fe(p,l){de(l,!0);let t=be(l,"vm",7);var o=Ue(),u=i(r(o),2),h=r(u);x(h);var m=i(h,2);x(m);var L=i(m,2);x(L),oe(2),a(u);var y=i(u,2),P=i(r(y));ve(P),a(y);var k=i(y,2),R=r(k);R.__click=[Ne,t];var U=i(R,2);U.__click=[Pe,t],a(k);var C=i(k,2),_=i(r(C));le(_,21,()=>t().lines,ce,(c,f)=>{De(c,{get currencyCode(){return t().currencyCode},get vm(){return n(f)},onRemoveLine:()=>t().removeLineWithId(n(f).id)})}),a(_);var V=i(_),S=r(V),I=i(r(S),2),E=r(I,!0);a(I),a(S);var v=i(S),H=i(r(v)),K=r(H,!0);a(H),a(v);var W=i(v),X=i(r(W)),ae=r(X,!0);a(X),a(W),a(V),a(C);var G=i(C,2),Q=i(r(G));ve(Q),a(G);var B=i(G,2),Z=r(B);Z.__click=function(...c){var f;(f=l.onPreviewInvoice)==null||f.apply(this,c)};var Y=i(Z,2);Y.__click=function(...c){var f;(f=l.onBuildInvoice)==null||f.apply(this,c)},a(B),a(o),J((c,f,re)=>{M(E,c),M(K,f),M(ae,re)},[()=>te.currency(t().subtotal,t().currencyCode),()=>te.currency(t().taxTotal,t().currencyCode),()=>te.currency(t().grandTotal,t().currencyCode)]),g(h,()=>t().number,c=>t().number=c),g(m,()=>t().date,c=>t().date=c),g(L,()=>t().orderRef,c=>t().orderRef=c),g(P,()=>t().issueToAsText,c=>t().issueToAsText=c),g(Q,()=>t().footnoteAsText,c=>t().footnoteAsText=c),D(p,o),ue()}fe(["click"]);var Me=N('<label><input id="untagged-select-all" type="checkbox"> Select All</label> <hr>',1),Ve=N('<div class="c-task-line svelte-1fy7v30"><label><input name="task-line" type="checkbox"> </label></div>'),Ee=N("<!> <!>",1),We=N("<p><i>All time has been accounted for.</i></p>"),Be=(p,l)=>l(),qe=(p,l,t)=>{p.preventDefault(),l(n(t).id)},Oe=N('<article> <a href="##">View</a></article>'),He=N('<h2>Invoice Builder</h2> <div id="container"><section id="row1" class="svelte-1fy7v30"><!> <div class="c-col-2 svelte-1fy7v30"><article class="time-list svelte-1fy7v30"><header>Uninvoiced Time</header> <!></article> <article class="scratch-pad svelte-1fy7v30"><header>Scratch Pad</header> <textarea name="scratch-pad" class="svelte-1fy7v30"></textarea></article></div></section> <section id="row2"><article><details><summary> </summary> <!></details></article></section></div>',1);function it(p,l){de(l,!0);const t="draft";let o=$(T(y())),u=$(T([])),h=$(""),m=$(T([]));xe(()=>{F(h,T(ee.getScratchPad("page-invoice-builder"))),F(u,T(k())),F(m,T(L()))});function L(){return se.getAll().filter(e=>e.id!=t).map(e=>new he(e)).sort((e,s)=>{const b=new Date(e.date).valueOf(),d=new Date(s.date).valueOf();if(b>d)return-1;if(b<d)return 1;const q=s.number,A=e.number;return A>q?-1:A<q||e.id>s.id?1:e.id<s.id?-1:0})}function y(){const e=ee.read(),s=new he;return s.id=t,s.currencyCode=e.defaultInvoiceCurrencyCode,s.number=`${e.nextInvoiceNumber}`,s.footnoteAsText=e.defaultInvoiceFooter??"",s}function P(){ee.setScratchPad("page-invoice-builder",n(h))}function k(){return _e.getAll().filter(e=>e.invoiceRefId.length==0&&e.state==Te.Stopped).map(e=>new Le(e))}function R(e){const s=new Re;return s.extRefId=e.id,s.description=`${e.date} - ${e.name}`,s.units="hr",s.quantity=e.affectiveDurationHours,s.unitCost=200,s}function U(){se.set(n(o).id,n(o).getModel()),_(n(o).id)}function C(){const e=n(o).getModel();e.id=crypto.randomUUID(),se.set(e.id,e);const s=n(o).lines.map(d=>d.extRefId).filter(d=>d&&d.length>0),b=n(u).filter(d=>s.includes(d.id));for(const d of b)d.invoiceRefId=n(o).id,_e.set(d.id,d.getModel());ee.incrementNextInvoiceNumber(),F(m,T(L())),F(u,T(k())),F(o,T(y())),_(e.id)}function _(e){window.open(`/view-invoice/${e}`,`inv-${e}`)}function V(){if(n(u).length==0)return!1;for(const e of n(u))if(!n(o).containsExtRefId(e.id))return!1;return!0}function S(e){for(const s of n(u))e?n(o).addLine(R(s)):n(o).removeLineWithExtRefId(s.id)}var I=He(),E=i(ne(I),2),v=r(E),H=r(v);Fe(H,{get vm(){return n(o)},onBuildInvoice:C,onPreviewInvoice:U});var K=i(H,2),W=r(K),X=i(r(W),2);{var ae=e=>{var s=Ee(),b=ne(s);{var d=A=>{var w=Me(),O=ne(w),j=r(O);x(j),oe(),a(O),oe(2),me(j,()=>V(),z=>S(z)),D(A,w)};pe(b,A=>{n(u).length>1&&A(d)})}var q=i(b,2);le(q,17,()=>n(u),ce,(A,w)=>{var O=Ve(),j=r(O),z=r(j);x(z);var ye=i(z);a(j),a(O),J((ie,ke)=>M(ye,` ${ie??""} (${ke??""} hrs) - ${n(w).name??""}`),[()=>Ce.toLocalDatefromString(n(w).date,"en-NZ"),()=>n(w).affectiveDurationHours.toFixed(2)]),me(z,()=>n(o).containsExtRefId(n(w).id),ie=>{ie?n(o).addLine(R(n(w))):n(o).removeLineWithExtRefId(n(w).id)}),D(A,O)}),D(e,s)},G=e=>{var s=We();D(e,s)};pe(X,e=>{n(u).length!=0?e(ae):e(G,!1)})}a(W);var Q=i(W,2),B=i(r(Q),2);ve(B),B.__input=[Be,P],a(Q),a(K),a(v);var Z=i(v,2),Y=r(Z),c=r(Y),f=r(c),re=r(f);a(f);var ge=i(f,2);le(ge,17,()=>n(m),ce,(e,s)=>{var b=Oe(),d=r(b),q=i(d);q.__click=[qe,_,s],a(b),J(()=>M(d,`${n(s).number??""} `)),D(e,b)}),a(c),a(Y),a(Z),a(E),J(()=>M(re,`Closed Invoices (${n(m).length??""})`)),g(B,()=>n(h),e=>F(h,e)),D(p,I),ue()}fe(["input","click"]);export{it as component};
