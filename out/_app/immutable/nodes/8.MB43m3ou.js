import{a as U,t as H}from"../chunks/D-9eU7Ls.js";import{p as me,c as s,r as l,s as o,t as Y,a as _e,i as he,l as t,j as re,f as ue,k as P,y as Ie}from"../chunks/D_6JOOz4.js";import{d as be,s as V,r as oe}from"../chunks/BSibExFq.js";import{i as xe}from"../chunks/DC2ULrIC.js";import{e as pe,i as ge}from"../chunks/BkIRmUsw.js";import{r as D}from"../chunks/B47jlKa9.js";import{b,c as we}from"../chunks/C78wupHh.js";import{p as R}from"../chunks/Du6CA1sz.js";import{o as Se}from"../chunks/DkiAmYuj.js";import{p as Te}from"../chunks/CSUKJKgE.js";import{F as le}from"../chunks/C1UJn8Ae.js";import{I as Ne,f as Ee}from"../chunks/DNn_mebg.js";import{a as I,I as fe,T as Ce,d as Fe,F as Me,e as Pe}from"../chunks/CJNU2BVq.js";function Ue(_,c){_.preventDefault(),c.onRemoveLine()}var Ve=H('<tr class="c-line svelte-fbae20"><td class="svelte-fbae20"><input name="line-num" type="number" min="1" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-desc" type="text" spellcheck="true" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-qty" type="number" step="0.25" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-units" type="text" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-unit-cost" type="number" class="svelte-fbae20"></td><td style="text-align: right;" class="svelte-fbae20"> </td><td class="svelte-fbae20"><a href="##"><!></a></td></tr>');function He(_,c){me(c,!0);let a=Te(c,"vm",7);var v=Ve(),y=s(v),B=s(y);D(B),B.__change=function(...d){var u;(u=c.onChange)==null||u.apply(this,d)},l(y);var h=o(y),p=s(h);D(p),p.__change=function(...d){var u;(u=c.onChange)==null||u.apply(this,d)},l(h);var m=o(h),A=s(m);D(A),A.__change=function(...d){var u;(u=c.onChange)==null||u.apply(this,d)},l(m);var x=o(m),w=s(x);D(w),w.__change=function(...d){var u;(u=c.onChange)==null||u.apply(this,d)},l(x);var S=o(x),C=s(S);D(C),C.__change=function(...d){var u;(u=c.onChange)==null||u.apply(this,d)},l(S);var T=o(S),O=s(T,!0);l(T);var k=o(T),N=s(k);N.__click=[Ue,c];var E=s(N);Ne(E,{icon:Ee}),l(N),l(k),l(v),Y(d=>V(O,d),[()=>le.currency(a().total,c.currencyCode)]),b(B,()=>a().number,d=>a().number=d),b(p,()=>a().description,d=>a().description=d),b(A,()=>a().quantity,d=>a().quantity=d),b(w,()=>a().units,d=>a().units=d),b(C,()=>a().unitCost,d=>a().unitCost=d),U(_,v),_e()}be(["change","click"]);var Be=H('<article id="working-invoice-container" class="svelte-1afk9pg"><header> </header> <fieldset class="row svelte-1afk9pg"><input name="inv-num" type="text" title="Invoice Number" placeholder="Invoice Number" class="svelte-1afk9pg"> <input name="inv-date" type="date" title="Invoice Date" class="svelte-1afk9pg"> <input name="inv-order" type="text" title="Order #" placeholder="Order #" class="svelte-1afk9pg"> <div style="flex: 99 1 auto"></div></fieldset> <label>Header Lines <textarea name="inv-header" title="Header lines for the invoice" spellcheck="true" placeholder="Header lines for the invoice"></textarea></label> <label>Issue to <textarea name="inv-issue-to" title="Address of the company or person being issued to" spellcheck="true" placeholder="Who will receive the invoice?"></textarea></label> <section><button class="svelte-1afk9pg">Add Line</button> <button class="secondary svelte-1afk9pg">Sort Lines</button></section> <table id="working-inv-lines" class="striped svelte-1afk9pg"><thead><tr><th class="svelte-1afk9pg">Line No.</th><th style="width: 100%;" class="svelte-1afk9pg">Description</th><th class="svelte-1afk9pg">Quantity</th><th class="svelte-1afk9pg">Units</th><th class="svelte-1afk9pg">Unit Cost</th><th class="svelte-1afk9pg">Total</th><th class="svelte-1afk9pg"></th></tr></thead><tbody></tbody><tfoot><tr><th colspan="3" rowspan="3" style="vertical-align: top;" class="svelte-1afk9pg"></th><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">Subtotal:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">GST:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-1afk9pg">Grand Total:</th><th style="text-align: right;" class="svelte-1afk9pg"> </th></tr></tfoot></table> <label>Footnote <textarea name="inv-footnote" spellcheck="true" placeholder="Optional Footnote"></textarea></label> <footer style="display: flex; justify-content: space-between;"><button class="secondary svelte-1afk9pg">Preview</button> <button class="svelte-1afk9pg">Build</button> <button class="secondary svelte-1afk9pg">Reset</button></footer></article>');function Oe(_,c){me(c,!0);let a=Te(c,"vm",7);var v=Be(),y=s(v),B=s(y,!0);l(y);var h=o(y,2),p=s(h);D(p),p.__change=function(...r){var n;(n=c.onChange)==null||n.apply(this,r)};var m=o(p,2);D(m),m.__change=function(...r){var n;(n=c.onChange)==null||n.apply(this,r)};var A=o(m,2);D(A),A.__change=function(...r){var n;(n=c.onChange)==null||n.apply(this,r)},he(2),l(h);var x=o(h,2),w=o(s(x));oe(w),w.__change=function(...r){var n;(n=c.onChange)==null||n.apply(this,r)},l(x);var S=o(x,2),C=o(s(S));oe(C),C.__change=function(...r){var n;(n=c.onChange)==null||n.apply(this,r)},l(S);var T=o(S,2),O=s(T);O.__click=function(...r){var n;(n=c.onAddLine)==null||n.apply(this,r)};var k=o(O,2);k.__click=function(...r){var n;(n=c.onSortLines)==null||n.apply(this,r)},l(T);var N=o(T,2),E=o(s(N));pe(E,21,()=>a().lines,ge,(r,n)=>{He(r,{get currencyCode(){return a().currencyCode},get vm(){return t(n)},onRemoveLine:()=>c.onRemoveLine(t(n)),get onChange(){return c.onChange}})}),l(E);var d=o(E),u=s(d),$=o(s(u),2),se=s($,!0);l($),l(u);var Q=o(u),ee=o(s(Q)),te=s(ee,!0);l(ee),l(Q);var Z=o(Q),z=o(s(Z)),J=s(z,!0);l(z),l(Z),l(d),l(N);var W=o(N,2),q=o(s(W));oe(q),q.__change=function(...r){var n;(n=c.onChange)==null||n.apply(this,r)},l(W);var j=o(W,2),ae=s(j);ae.__click=function(...r){var n;(n=c.onPreviewInvoice)==null||n.apply(this,r)};var ne=o(ae,2);ne.__click=function(...r){var n;(n=c.onBuildInvoice)==null||n.apply(this,r)};var ce=o(ne,2);ce.__click=function(...r){var n;(n=c.onResetInvoice)==null||n.apply(this,r)},l(j),l(v),Y((r,n,ie)=>{V(B,c.title),p.readOnly=!c.canChangeNumber||null,V(se,r),V(te,n),V(J,ie)},[()=>le.currency(a().subtotal,a().currencyCode),()=>le.currency(a().taxTotal,a().currencyCode),()=>le.currency(a().grandTotal,a().currencyCode)]),b(p,()=>a().number,r=>a().number=r),b(m,()=>a().date,r=>a().date=r),b(A,()=>a().orderRef,r=>a().orderRef=r),b(w,()=>a().headerLinesAsText,r=>a().headerLinesAsText=r),b(C,()=>a().issueToAsText,r=>a().issueToAsText=r),b(q,()=>a().footnoteAsText,r=>a().footnoteAsText=r),U(_,v),_e()}be(["change","click"]);var We=H('<label><input id="untagged-select-all" type="checkbox"> Select All</label> <hr>',1),qe=H('<div class="c-task-line svelte-1fy7v30"><label><input name="task-line" type="checkbox"> </label></div>'),je=H("<!> <!>",1),Ge=H("<p><i>All time has been accounted for.</i></p>"),Qe=(_,c)=>c(),Ze=(_,c,a)=>{_.preventDefault(),c(t(a).id)},ze=(_,c,a)=>{_.preventDefault(),c(t(a).id)},Je=H('<article> <a href="##">View</a> <a href="##">Edit</a></article>'),Ke=H('<h2>Invoice Builder</h2> <div id="container"><section id="row1" class="svelte-1fy7v30"><!> <div class="c-col-2 svelte-1fy7v30"><article class="time-list svelte-1fy7v30"><header>Uninvoiced Time</header> <!></article> <article class="scratch-pad svelte-1fy7v30"><header>Scratch Pad</header> <textarea name="scratch-pad" class="svelte-1fy7v30"></textarea></article></div></section> <section id="row2"><article><details><summary> </summary> <!></details></article></section></div>',1);function vt(_,c){me(c,!0);const a="draft";let v=re(R(A())),y=Ie(()=>t(v).id==a),B=Ie(()=>t(y)?"Draft Invoice":`Editing Invoice ${t(v).number}`),h=re(R([])),p=re(""),m=re(R([]));Se(()=>{P(p,R(I.getScratchPad("page-invoice-builder"))),P(h,R(C())),P(m,R(x()))});function A(){var e=I.invRepo.get(a);return e?new fe(e):w()}function x(){return I.invRepo.getAll().filter(e=>e.id!=a).map(e=>new fe(e)).sort((e,i)=>{const g=new Date(e.date).valueOf(),F=new Date(i.date).valueOf();if(g>F)return-1;if(g<F)return 1;const f=i.number,L=e.number;return L>f?-1:L<f||e.id>i.id?1:e.id<i.id?-1:0})}function w(){const e=I.settings,i=new fe;return i.id=a,i.headerLinesAsText=e.defaultInvoiceHeader??"",i.currencyCode=e.defaultInvoiceCurrencyCode,i.number=`${e.nextInvoiceNumber}`,i.footnoteAsText=e.defaultInvoiceFooter??"",i}function S(){I.setScratchPad("page-invoice-builder",t(p))}function C(){return I.taskRepo.getAll().filter(e=>e.invoiceRefId.length==0&&e.state==Ce.Stopped).map(e=>new Fe(e))}function T(e){const i=new Pe;return i.extRefId=e.id,i.description=`${e.date} - ${e.name}`,i.units="hr",i.quantity=e.affectiveDurationHours,i.unitCost=200,i}function O(){k(),E(t(v).id,{wattermark:"DRAFT"})}function k(){I.invRepo.set(t(v).id,t(v).getModel())}function N(){const e=t(v).getModel(),i=t(y);i&&(e.id=crypto.randomUUID()),I.invRepo.set(e.id,e);const g=e.lines.map(f=>f.extRefId).filter(f=>f&&f.length>0),F=t(h).filter(f=>g.includes(f.id));for(const f of F)f.invoiceRefId=e.id,f.state=Ce.Archived,I.taskRepo.set(f.id,f.getModel());i&&I.incrementNextInvoiceNumber(),P(m,R(x())),P(h,R(C())),te(),E(e.id)}function E(e,i){let g=`/view-invoice/${e}`;i!=null&&i.wattermark&&(g+=`/${i.wattermark}`),window.open(g,`inv-${e}`)}async function d(e){const i=await I.getInvoiceById(e);i&&(P(v,R(i)),window.scrollTo(0,0))}function u(){if(t(h).length==0)return!1;for(const e of t(h))if(!t(v).containsExtRefId(e.id))return!1;return!0}function $(e){for(const i of t(h))e?t(v).addLine(T(i)):t(v).removeLineWithExtRefId(i.id)}function se(){t(v).addLine(),k()}function Q(e){t(v).removeLineWithId(e.id),k()}function ee(){t(v).sortAndRenumberLines(),k()}function te(){P(v,R(w())),k()}var Z=Ke(),z=o(ue(Z),2),J=s(z),W=s(J);Oe(W,{get vm(){return t(v)},get title(){return t(B)},get canChangeNumber(){return t(y)},onChange:k,onAddLine:se,onRemoveLine:Q,onSortLines:ee,onBuildInvoice:N,onPreviewInvoice:O,onResetInvoice:te});var q=o(W,2),j=s(q),ae=o(s(j),2);{var ne=e=>{var i=je(),g=ue(i);{var F=L=>{var M=We(),G=ue(M),K=s(G);D(K),he(),l(G),he(2),we(K,()=>u(),X=>$(X)),U(L,M)};xe(g,L=>{t(h).length>1&&L(F)})}var f=o(g,2);pe(f,17,()=>t(h),ge,(L,M)=>{var G=qe(),K=s(G),X=s(K);D(X);var De=o(X);l(K),l(G),Y((de,Ae)=>V(De,` ${de??""} (${Ae??""} hrs) - ${t(M).name??""}`),[()=>Me.toLocalDatefromString(t(M).date,"en-NZ"),()=>t(M).affectiveDurationHours.toFixed(2)]),we(X,()=>t(v).containsExtRefId(t(M).id),de=>{de?t(v).addLine(T(t(M))):t(v).removeLineWithExtRefId(t(M).id)}),U(L,G)}),U(e,i)},ce=e=>{var i=Ge();U(e,i)};xe(ae,e=>{t(h).length!=0?e(ne):e(ce,!1)})}l(j);var r=o(j,2),n=o(s(r),2);oe(n),n.__input=[Qe,S],l(r),l(q),l(J);var ie=o(J,2),ye=s(ie),ke=s(ye),ve=s(ke),Le=s(ve);l(ve);var Re=o(ve,2);pe(Re,17,()=>t(m),ge,(e,i)=>{var g=Je(),F=s(g),f=o(F);f.__click=[Ze,E,i];var L=o(f,2);L.__click=[ze,d,i],l(g),Y(()=>V(F,`${t(i).number??""} `)),U(e,g)}),l(ke),l(ye),l(ie),l(z),Y(()=>V(Le,`Closed Invoices (${t(m).length??""})`)),b(n,()=>t(p),e=>P(p,e)),U(_,Z),_e()}be(["input","click"]);export{vt as component};
