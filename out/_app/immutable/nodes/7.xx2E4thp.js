import{a as S,t as A}from"../chunks/CRRl4Swk.js";import{p as ue,c as r,r as a,s as i,t as J,a as de,ab as le,w as s,ac as j,f as se,a7 as T,ar as ye}from"../chunks/UCO5opLl.js";import{s as N}from"../chunks/vBULxvE1.js";import{i as fe}from"../chunks/CnmQIJM7.js";import{e as oe,i as ce}from"../chunks/CAfQcJAG.js";import{r as x}from"../chunks/DG_sXqrW.js";import{d as _e,r as ve}from"../chunks/BKxiCNa-.js";import{b as h,c as me}from"../chunks/D5xpou81.js";import{p as b}from"../chunks/CQhzKiTL.js";import{o as Ie}from"../chunks/5U-_lmsG.js";import{p as ge}from"../chunks/Dh_rZ3BX.js";import{F as ee}from"../chunks/CF8cNsMY.js";import{I as ne,T as ke,a as we,F as ze,b as Te}from"../chunks/Bjp3u8Cb.js";import{s as Y,i as pe,t as he}from"../chunks/BXFbSXWe.js";var Se=A('<tr class="c-line svelte-fbae20"><td class="svelte-fbae20"><input name="line-num" type="number" min="1" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-desc" type="text" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-qty" type="number" step="0.25" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-units" type="text" class="svelte-fbae20"></td><td class="svelte-fbae20"><input name="line-unit-cost" type="number" class="svelte-fbae20"></td><td style="text-align: right;" class="svelte-fbae20"> </td></tr>');function Ae(m,o){ue(o,!0);let e=ge(o,"vm",7);var l=Se(),v=r(l),p=r(v);x(p),a(v);var f=i(v),k=r(f);x(k),a(f);var _=i(f),L=r(_);x(L),a(_);var g=i(_),w=r(g);x(w),a(g);var y=i(g),C=r(y);x(C),a(y);var R=i(y),P=r(R,!0);a(R),a(l),J(c=>N(P,c),[()=>ee.currency(e().total,o.currencyCode)]),h(p,()=>e().number,c=>e().number=c),h(k,()=>e().description,c=>e().description=c),h(L,()=>e().quantity,c=>e().quantity=c),h(w,()=>e().units,c=>e().units=c),h(C,()=>e().unitCost,c=>e().unitCost=c),S(m,l),de()}var Le=(m,o)=>o().addLine(),Ce=(m,o)=>o().sortLines(),Re=(m,o,e)=>o.onSaveInvoice(e()),Ne=A('<article id="working-invoice-container" class="svelte-12glu5z"><header>Working Invoice</header> <fieldset class="row svelte-12glu5z"><input name="inv-num" type="text" title="Invoice Number" placeholder="Invoice Number" class="svelte-12glu5z"> <input name="inv-date" type="date" title="Invoice Date" class="svelte-12glu5z"> <input name="inv-order" type="text" title="Order #" class="svelte-12glu5z"> <div style="flex: 99 1 auto"></div></fieldset> <label>Issue to <textarea name="inv-issue-to" title="Address of the company or person being issued to"></textarea></label> <nav class="svelte-12glu5z"><ul><li class="svelte-12glu5z"><button class="svelte-12glu5z">Add Line</button></li> <li class="svelte-12glu5z"><button class="secondary svelte-12glu5z">Sort Lines</button></li></ul></nav> <table id="working-inv-lines" class="striped svelte-12glu5z"><thead><tr><th class="svelte-12glu5z">Line No.</th><th style="width: 100%;" class="svelte-12glu5z">Description</th><th class="svelte-12glu5z">Quantity</th><th class="svelte-12glu5z">Units</th><th class="svelte-12glu5z">Unit Cost</th><th class="svelte-12glu5z">Total</th></tr></thead><tbody></tbody><tfoot><tr><th colspan="3" rowspan="3" style="vertical-align: top;" class="svelte-12glu5z"></th><th colspan="2" style="text-align: right;" class="svelte-12glu5z">Subtotal:</th><th style="text-align: right;" class="svelte-12glu5z"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-12glu5z">GST:</th><th style="text-align: right;" class="svelte-12glu5z"> </th></tr><tr><th colspan="2" style="text-align: right;" class="svelte-12glu5z">Grand Total:</th><th style="text-align: right;" class="svelte-12glu5z"> </th></tr></tfoot></table> <label>Footnote <textarea name="inv-footnote"></textarea></label> <footer><button class="svelte-12glu5z">Save</button></footer></article>');function De(m,o){ue(o,!0);let e=ge(o,"vm",15);var l=Ne(),v=i(r(l),2),p=r(v);x(p);var f=i(p,2);x(f);var k=i(f,2);x(k),le(2),a(v);var _=i(v,2),L=i(r(_));ve(L),a(_);var g=i(_,2),w=r(g),y=r(w),C=r(y);C.__click=[Le,e],a(y);var R=i(y,2),P=r(R);P.__click=[Ce,e],a(R),a(w),a(g);var c=i(g,2),D=i(r(c));oe(D,21,()=>e().lines,ce,(d,t)=>{Ae(d,{get vm(){return s(t)},get currencyCode(){return e().currencyCode}})}),a(D);var F=i(D),E=r(F),q=i(r(E),2),H=r(q,!0);a(q),a(E);var $=i(E),K=i(r($)),te=r(K,!0);a(K),a($);var B=i($),M=i(r(B)),X=r(M,!0);a(M),a(B),a(F),a(c);var U=i(c,2),G=i(r(U));ve(G),a(U);var V=i(U,2),ae=r(V);ae.__click=[Re,o,e],a(V),a(l),J((d,t,n)=>{N(H,d),N(te,t),N(X,n)},[()=>ee.currency(e().subtotal,e().currencyCode),()=>ee.currency(e().taxTotal,e().currencyCode),()=>ee.currency(e().grandTotal,e().currencyCode)]),h(p,()=>e().number,d=>e(e().number=d,!0)),h(f,()=>e().date,d=>e(e().date=d,!0)),h(k,()=>e().orderRef,d=>e(e().orderRef=d,!0)),h(L,()=>e().issueToAsText,d=>e(e().issueToAsText=d,!0)),h(G,()=>e().footnoteAsText,d=>e(e().footnoteAsText=d,!0)),S(m,l),de()}_e(["click"]);var Fe=A('<label><input id="untagged-select-all" type="checkbox"> Select All</label> <hr>',1),Ee=A('<div class="c-task-line svelte-1fy7v30"><label><input name="task-line" type="checkbox"> </label></div>'),Me=A("<!> <!>",1),Ue=A("<p><i>All time has been accounted for.</i></p>"),Ve=(m,o)=>o(),We=(m,o,e)=>{m.preventDefault(),o(s(e).id)},Pe=A('<article> <a href="##">View</a></article>'),qe=A('<h2>Invoice Builder</h2> <div id="container"><section id="row1" class="svelte-1fy7v30"><!> <div class="c-col-2 svelte-1fy7v30"><article class="time-list svelte-1fy7v30"><header>Uninvoiced Time</header> <!></article> <article class="scratch-pad svelte-1fy7v30"><header>Scratch Pad</header> <textarea name="scratch-pad" class="svelte-1fy7v30"></textarea></article></div></section> <section id="row2"><article><details><summary> </summary> <!></details></article></section></div>',1);function at(m,o){ue(o,!0);let e=j(1),l=j(b(new ne)),v=j(b([])),p=j(""),f=j(b([]));Ie(()=>{_(),T(p,b(Y.getScratchPad("page-invoice-builder"))),T(v,b(g())),T(f,b(k()))});function k(){return pe.getAll().map(t=>new ne(t))}function _(){const t=Y.read();T(l,b(new ne)),s(l).number=`${t.nextInvoiceNumber}`,s(l).footnoteAsText=t.defaultInvoiceFooter??""}function L(){Y.setScratchPad("page-invoice-builder",s(p))}function g(){return he.getAll().filter(t=>t.invoiceRefId.length==0&&t.state==ke.Stopped).map(t=>new we(t))}function w(t){const n=new Te;return n.number=ye(e),n.extRefId=t.id,n.description=`${t.date} - ${t.name}`,n.units="hr",n.quantity=t.affectiveDurationHours,n.unitCost=200,n}function y(t){pe.set(t.id,t.getModel());const n=s(l).lines.map(u=>u.extRefId).filter(u=>u&&u.length>0),z=s(v).filter(u=>n.includes(u.id));for(const u of z)u.invoiceRefId=s(l).id,he.set(u.id,u.getModel());Y.modify(u=>{u.nextInvoiceNumber++}),T(f,b(k())),T(v,b(g())),_(),C(t.id)}function C(t){window.open(`/view-invoice/${t}`,`inv-${t}`)}function R(){if(s(v).length==0)return!1;for(const t of s(v))if(!s(l).containsExtRefId(t.id))return!1;return!0}function P(t){for(const n of s(v))t?s(l).addLine(w(n)):s(l).removeLineWithExtRefId(n.id)}var c=qe(),D=i(se(c),2),F=r(D),E=r(F);De(E,{onSaveInvoice:y,get vm(){return s(l)},set vm(t){T(l,b(t))}});var q=i(E,2),H=r(q),$=i(r(H),2);{var K=t=>{var n=Me(),z=se(n);{var u=O=>{var I=Fe(),W=se(I),Q=r(W);x(Q),le(),a(W),le(2),me(Q,()=>R(),Z=>P(Z)),S(O,I)};fe(z,O=>{s(v).length>1&&O(u)})}var re=i(z,2);oe(re,17,()=>s(v),ce,(O,I)=>{var W=Ee(),Q=r(W),Z=r(Q);x(Z);var be=i(Z);a(Q),a(W),J((ie,xe)=>N(be,` ${ie??""} (${xe??""} hrs) - ${s(I).name??""}`),[()=>ze.toLocalDatefromString(s(I).date,"en-NZ"),()=>s(I).affectiveDurationHours.toFixed(2)]),me(Z,()=>s(l).containsExtRefId(s(I).id),ie=>{ie?s(l).addLine(w(s(I))):s(l).removeLineWithExtRefId(s(I).id)}),S(O,W)}),S(t,n)},te=t=>{var n=Ue();S(t,n)};fe($,t=>{s(v).length!=0?t(K):t(te,!1)})}a(H);var B=i(H,2),M=i(r(B),2);ve(M),M.__input=[Ve,L],a(B),a(q),a(F);var X=i(F,2),U=r(X),G=r(U),V=r(G),ae=r(V);a(V);var d=i(V,2);oe(d,17,()=>s(f),ce,(t,n)=>{var z=Pe(),u=r(z),re=i(u);re.__click=[We,C,n],a(z),J(()=>N(u,`${s(n).number??""} `)),S(t,z)}),a(G),a(U),a(X),a(D),J(()=>N(ae,`Closed Invoices (${s(f).length??""})`)),h(M,()=>s(p),t=>T(p,t)),S(m,c),de()}_e(["input","click"]);export{at as component};
