var pt=Object.defineProperty;var lt=a=>{throw TypeError(a)};var yt=(a,t,e)=>t in a?pt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var E=(a,t,e)=>yt(a,typeof t!="symbol"?t+"":t,e),bt=(a,t,e)=>t.has(a)||lt("Cannot "+e);var w=(a,t,e)=>(bt(a,t,"read from private field"),e?e.call(a):t.get(a)),K=(a,t,e)=>t.has(a)?lt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,e);import{a as h,t as T,c as ct}from"../chunks/D-9eU7Ls.js";import{p as et,c as i,s as u,r as n,t as O,l as k,a as at,y as L,f as J,i as dt,k as B,j as G}from"../chunks/D_6JOOz4.js";import{d as kt,s as N,j as xt}from"../chunks/BSibExFq.js";import{p as z}from"../chunks/Du6CA1sz.js";import{o as ft,a as ht}from"../chunks/DkiAmYuj.js";import{e as mt,i as St}from"../chunks/BkIRmUsw.js";import{t as Dt,s as Rt}from"../chunks/CQ3U4dWC.js";import{i as M}from"../chunks/DC2ULrIC.js";import{s as ut,r as nt}from"../chunks/B47jlKa9.js";import{b as it}from"../chunks/C78wupHh.js";import{p as At}from"../chunks/CSUKJKgE.js";import{I as W,a as Ct,b as Pt,c as wt,d as zt,e as It,g as jt}from"../chunks/DNn_mebg.js";import{T as c,a as rt,d as ot,U as Mt,F as Ut}from"../chunks/CJNU2BVq.js";function Lt(a,t,e){if(e){if(a.classList.contains(t))return;a.classList.add(t)}else{if(!a.classList.contains(t))return;a.classList.remove(t)}}var qt=(a,t)=>t.onIncreaseDuration(!0,a.ctrlKey),Ht=(a,t)=>t.onIncreaseDuration(!1,a.ctrlKey),Vt=T('<button class="outline svelte-1ifz5q4" title="Add Time"><!></button> <button class="outline svelte-1ifz5q4" title="Remove Time"><!></button>',1),Ft=T('<div class="c-buttons svelte-1ifz5q4"><!></div>'),Bt=(a,t)=>t.onAction1Click(),Nt=T('<button class="outline svelte-1ifz5q4"><!></button>'),Ot=T('<div class="icon"><!></div>'),Et=(a,t)=>t.onAction2Click(),Kt=T('<button class="outline secondary svelte-1ifz5q4"><!></button>'),Wt=T('<div class="icon secondary"><!></div>'),Gt=T('<div class="c-buttons svelte-1ifz5q4"><!> <!></div>'),Jt=T('<div class="c-main svelte-1ifz5q4"><!> <div class="affective svelte-1ifz5q4"> </div> <div class="counter svelte-1ifz5q4"> </div> <!></div>');function Qt(a,t){et(t,!0);let e=L(()=>{const r=Math.floor(Math.abs(t.durationSeconds)/60/60),m=Math.floor(Math.abs(t.durationSeconds/60)),D=Math.abs(m%60),A=Math.abs(t.durationSeconds%60),g=[r.toFixed(0)+"h",D.toFixed(0)+"m",A.toFixed(0)+"s"];return(t.durationSeconds<0?"-":"")+g.join(" ")});var v=Jt(),d=i(v);{var p=r=>{var m=Ft(),D=i(m);{var A=g=>{var C=Vt(),j=J(C);j.__click=[qt,t];var q=i(j);W(q,{icon:Ct}),n(j);var l=u(j,2);l.__click=[Ht,t];var o=i(l);W(o,{icon:Pt}),n(l),h(g,C)};M(D,g=>{t.onIncreaseDuration&&g(A)})}n(m),h(r,m)};M(d,r=>{t.onIncreaseDuration&&r(p)})}var f=u(d,2),y=i(f,!0);n(f);var x=u(f,2),_=i(x,!0);n(x);var S=u(x,2);{var I=r=>{var m=Gt(),D=i(m);{var A=l=>{var o=Nt();o.__click=[Bt,t];var R=i(o);W(R,{get icon(){return t.icon1}}),n(o),O(()=>ut(o,"title",t.action1Hint)),h(l,o)},g=l=>{var o=ct(),R=J(o);{var V=P=>{var b=Ot(),Q=i(b);W(Q,{get icon(){return t.icon1}}),n(b),h(P,b)};M(R,P=>{t.icon1&&P(V)},!0)}h(l,o)};M(D,l=>{t.onAction1Click&&t.icon1?l(A):l(g,!1)})}var C=u(D,2);{var j=l=>{var o=Kt();o.__click=[Et,t];var R=i(o);W(R,{get icon(){return t.icon2}}),n(o),O(()=>ut(o,"title",t.action2Hint)),h(l,o)},q=l=>{var o=ct(),R=J(o);{var V=P=>{var b=Wt(),Q=i(b);W(Q,{get icon(){return t.icon2}}),n(b),h(P,b)};M(R,P=>{t.icon2&&P(V)},!0)}h(l,o)};M(C,l=>{t.onAction2Click&&t.icon2?l(j):l(q,!1)})}n(m),h(r,m)};M(S,r=>{(t.icon1||t.onAction1Click||t.icon2||t.onAction2Click)&&r(I)})}n(v),O(r=>{N(y,r),N(_,k(e))},[()=>{var r;return(r=t.affectiveDurationHours)==null?void 0:r.toFixed(2)}]),h(a,v),at()}kt(["click"]);class U{}E(U,"TaskPause",wt),E(U,"TaskResume",zt),E(U,"TaskStop",It),E(U,"TaskDuplicateAndStart",jt);function vt(a,t,e){t.taskController.saveTask(e())}var Xt=T('<span style="flex: content;" class="inv" title="Invoice"> </span>'),Yt=(a,t,e)=>{var v;return(v=t.taskController)==null?void 0:v.saveTask(e())},Zt=(a,t,e)=>t.taskController.archiveTask(e()),$t=(a,t,e)=>t.taskController.deleteTask(e()),te=T('<button style="flex: content;" class="svelte-1jzxame">Archive</button> <button style="flex: content;" class="secondary svelte-1jzxame">Delete</button>',1),ee=T('<article class="c-task svelte-1jzxame"><div class="c-task-fields svelte-1jzxame"><input class="date svelte-1jzxame" name="task-date" type="date" title="Date"> <input class="name svelte-1jzxame" name="task-name" type="text" title="Description" placeholder="Description"> <div class="c-task-fields-row-2 svelte-1jzxame"><details class="svelte-1jzxame"><summary class="svelte-1jzxame">Other</summary> <!> <div style="display: flex; flex-direction: row; gap:1rem; flex-wrap: wrap;"><input style="flex: 10;" class="tags svelte-1jzxame" name="task-tags" type="text" placeholder="Tags" title="Tags"> <!></div></details> <div style="flex: 2;"></div></div></div> <div class="c-task-duration svelte-1jzxame"><!></div></article>');function ae(a,t){et(t,!0);let e=At(t,"vm",7);const v=e().state=="Archived",d={icon:s=>{switch(s.state){case c.Running:return U.TaskPause;case c.Paused:return U.TaskResume;case c.Stopped:return U.TaskDuplicateAndStart}},hint:s=>{switch(s.state){case c.Running:return"Pause";case c.Paused:return"Resume";case c.Stopped:return"Start a new copy"}},execute:s=>{switch(s.state){case c.Running:t.taskController.pauseTask(s);break;case c.Paused:t.taskController.startTask(s);break;case c.Stopped:t.taskController.duplicateAndStartTask(s);break}}},p={icon:s=>{switch(s.state){case c.Running:return U.TaskStop;case c.Paused:return U.TaskStop;case c.Stopped:return U.TaskResume}},hint:s=>{switch(s.state){case c.Running:return"Stop";case c.Paused:return"Stop";case c.Stopped:return"Start"}},execute:s=>{switch(s.state){case c.Running:t.taskController.stopTask(s);break;case c.Paused:t.taskController.stopTask(s);break;case c.Stopped:t.taskController.startTask(s);break}}};function f(s,H){let F=H?1:15;t.taskController.increaseDuration(e(),s?F:-F)}var y=ee(),x=i(y),_=i(x);nt(_),_.__input=[vt,t,e],_.readOnly=v;var S=u(_,2);nt(S),S.__input=[vt,t,e],S.readOnly=v;var I=u(S,2),r=i(I),m=u(i(r),2);{var D=s=>{var H=Xt(),F=i(H);n(H),O(()=>N(F,`Attached to Invoice Id: ${e().invoiceRefId??""}`)),h(s,H)};M(m,s=>{e().invoiceRefId.length>0&&s(D)})}var A=u(m,2),g=i(A);nt(g),g.__input=[Yt,t,e],g.readOnly=v;var C=u(g,2);{var j=s=>{var H=te(),F=J(H);F.__click=[Zt,t,e];var Tt=u(F,2);Tt.__click=[$t,t,e],h(s,H)};M(C,s=>{v||s(j)})}n(A),n(r),dt(2),n(I),n(x);var q=u(x,2),l=i(q);const o=L(()=>d.icon(e()));var R=L(()=>k(o));const V=L(()=>d.hint(e()));var P=L(()=>k(V));const b=L(()=>p.icon(e()));var Q=L(()=>k(b));const _t=L(()=>p.hint(e()));var gt=L(()=>k(_t));Qt(l,{get durationSeconds(){return e().duration},get affectiveDurationHours(){return e().affectiveDurationHours},onIncreaseDuration:v?void 0:f,get icon1(){return k(R)},onAction1Click:()=>d.execute(e()),get action1Hint(){return k(P)},get icon2(){return k(Q)},onAction2Click:()=>p.execute(e()),get action2Hint(){return k(gt)}}),n(q),n(y),O(()=>Lt(y,"s-running",e().state==c.Running)),it(_,()=>e().date,s=>e().date=s),it(S,()=>e().name,s=>e().name=s),it(g,()=>e().tagsAsText,s=>e().tagsAsText=s),h(a,y),at()}kt(["input","click"]);var se=T("<div><!></div>");function st(a,t){var e=ct(),v=J(e);mt(v,19,()=>t.tasks,d=>d.id,(d,p)=>{var f=se(),y=i(f);ae(y,{get vm(){return k(p)},get taskController(){return t.taskController}}),n(f),Dt(3,f,()=>Rt,()=>({duration:200})),h(d,f)}),h(a,e)}var ne=T("<option></option>"),ie=T('<datalist id="list-task-names"></datalist>'),re=T('<form><fieldset role="group" class="svelte-1ps283u"><input name="task-name" type="text" placeholder="Whatcha doin?" spellcheck="true" list="list-task-names"> <!> <input type="submit" value="Start" class="svelte-1ps283u"></fieldset></form>');function oe(a,t){et(t,!0);let e=G("");function v(_){_.preventDefault(),t.onStartTask(k(e)),B(e,"")}var d=re(),p=i(d),f=i(p);nt(f);var y=u(f,2);{var x=_=>{var S=ie();mt(S,21,()=>t.previousTasksList,St,(I,r)=>{var m=ne(),D={};O(()=>{D!==(D=k(r))&&(m.value=(m.__value=k(r))==null?"":k(r))}),h(I,m)}),n(S),h(_,S)};M(y,_=>{t.previousTasksList&&_(x)})}dt(2),n(p),n(d),xt("submit",d,v),it(f,()=>k(e),_=>B(e,_)),h(a,d),at()}var X,Y,Z,$,tt;class ce{constructor(){K(this,X,G(z([])));K(this,Y,G(z([])));K(this,Z,G(z([])));K(this,$,G(z([])));K(this,tt,G(z([])));E(this,"intervalId")}get previouslyUsedTasks(){return k(w(this,X))}set previouslyUsedTasks(t){B(w(this,X),z(t))}get tasksRunning(){return k(w(this,Y))}set tasksRunning(t){B(w(this,Y),z(t))}get tasksPaused(){return k(w(this,Z))}set tasksPaused(t){B(w(this,Z),z(t))}get tasksStopped(){return k(w(this,$))}set tasksStopped(t){B(w(this,$),z(t))}get tasksArchived(){return k(w(this,tt))}set tasksArchived(t){B(w(this,tt),z(t))}start(){this.stop(),this.refreshAndCatchUpRunningTaskDurations(),this.intervalId=setInterval(()=>this.incrementRunningTaskDuration(),1e3)}stop(){this.intervalId&&clearInterval(this.intervalId)}refreshAndCatchUpRunningTaskDurations(){console.debug("refreshAndCatchUpRunningTaskDurations"),this.refresh();for(const t of this.tasksRunning)t.recalculateDurationFromRunningSession()}refresh(){const t=rt.taskRepo.getAll().map(e=>new ot(e));this.previouslyUsedTasks=this.buildPreviouslyUsedTasks(t,20),this.tasksRunning=this.fetchTasksByState(t,[c.Running]),this.tasksPaused=this.fetchTasksByState(t,[c.Paused]),this.tasksStopped=this.fetchTasksByState(t,[c.Stopped]),this.tasksArchived=this.fetchTasksByState(t,[c.Archived])}buildPreviouslyUsedTasks(t,e=20){const d=Mt.sortByProperties(t,["date:desc","name:asc"]).slice(0,e).map(f=>f.name);return[...new Set(d)]}fetchTasksByState(t,e){return t.filter(v=>e.includes(v.state))}startNewTask(t){const e=new ot;e.name=t,this.startTask(e)}saveTask(t){rt.taskRepo.set(t.id,t.getModel())}pauseAll(){this.refresh();for(const t of this.tasksRunning)t.pause(),this.saveTask(t);this.refresh()}incrementRunningTaskDuration(){for(const t of this.tasksRunning)t.setDuration(t.duration+1),this.saveTask(t)}pauseTask(t){t.pause(),this.saveTask(t),this.refresh()}startTask(t){this.pauseAll(),t.start(),this.saveTask(t),this.refresh()}stopTask(t){t.stop(),this.saveTask(t),this.refresh()}duplicateAndStartTask(t){const e=new ot(t.getModel(crypto.randomUUID()));e.setDuration(0),e.date=Ut.toInputDateValue(new Date),e.invoiceRefId="",this.startTask(e)}increaseDuration(t,e){t.incrementDuration(e),this.saveTask(t)}deleteTask(t){rt.taskRepo.remove(t.id),this.refresh()}archiveTask(t){t.archive(),this.saveTask(t),this.refresh()}}X=new WeakMap,Y=new WeakMap,Z=new WeakMap,$=new WeakMap,tt=new WeakMap;function le(a,t){et(t,!0),ft(()=>{document.addEventListener("visibilitychange",e)}),ht(()=>{document.removeEventListener("visibilitychange",e)});function e(){t.onPageVisibilityChanged(document.visibilityState==="visible")}at()}var ue=T("<!> <h2>Time Log</h2> <!> <section><summary> </summary> <!></section> <section><summary> </summary> <!></section> <section><details><summary> </summary> <!></details></section> <section><details><summary> </summary> <!></details></section>",1);function De(a,t){et(t,!0);let e=z(new ce);ft(()=>{e.start()}),ht(()=>{e.stop()});function v(b){console.debug("onPageVisibilityChanged",b),b&&e.refreshAndCatchUpRunningTaskDurations()}var d=ue(),p=J(d);le(p,{onPageVisibilityChanged:v});var f=u(p,4);oe(f,{onStartTask:b=>e.startNewTask(b),get previousTasksList(){return e.previouslyUsedTasks}});var y=u(f,2),x=i(y),_=i(x);n(x);var S=u(x,2);st(S,{get taskController(){return e},get tasks(){return e.tasksRunning}}),n(y);var I=u(y,2),r=i(I),m=i(r);n(r);var D=u(r,2);st(D,{get taskController(){return e},get tasks(){return e.tasksPaused}}),n(I);var A=u(I,2),g=i(A),C=i(g),j=i(C);n(C);var q=u(C,2);st(q,{get taskController(){return e},get tasks(){return e.tasksStopped}}),n(g),n(A);var l=u(A,2),o=i(l),R=i(o),V=i(R);n(R);var P=u(R,2);st(P,{get taskController(){return e},get tasks(){return e.tasksArchived}}),n(o),n(l),O(()=>{N(_,`In Progress (${e.tasksRunning.length??""})`),N(m,`Paused (${e.tasksPaused.length??""})`),N(j,`Stopped (${e.tasksStopped.length??""})`),N(V,`Archived (${e.tasksArchived.length??""})`)}),h(a,d),at()}export{De as component};
