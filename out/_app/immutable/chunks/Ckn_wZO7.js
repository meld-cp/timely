var B=a=>{throw TypeError(a)};var K=(a,t,s)=>t.has(a)||B("Cannot "+s);var e=(a,t,s)=>(K(a,t,"read from private field"),s?s.call(a):t.get(a)),n=(a,t,s)=>t.has(a)?B("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,s);import{W as o,o as r,N as u,v as c}from"./CRiTDDG9.js";import{p as i}from"./dGNHEYVr.js";import{F as J,t as Q}from"./gGzjA1K5.js";var h=(a=>(a[a.Running=0]="Running",a[a.Paused=1]="Paused",a[a.Stopped=2]="Stopped",a[a.Archived=3]="Archived",a))(h||{}),f,l,g,m,p,R,b,L,v;class tt{constructor(t){n(this,f,o(i(crypto.randomUUID())));n(this,l,o(i(h.Stopped)));n(this,g,o(i(J.toInputDateValue(new Date))));n(this,m,o(""));n(this,p,o(0));n(this,R,o(0));n(this,b,o());n(this,L,o(""));n(this,v,o(i([])));t&&this.applyModel(t)}get id(){return r(e(this,f))}set id(t){u(e(this,f),i(t))}get state(){return r(e(this,l))}set state(t){u(e(this,l),i(t))}get date(){return r(e(this,g))}set date(t){u(e(this,g),i(t))}get name(){return r(e(this,m))}set name(t){u(e(this,m),i(t))}get duration(){return r(e(this,p))}set duration(t){u(e(this,p),i(t))}get affectiveDurationHours(){return r(e(this,R))}set affectiveDurationHours(t){u(e(this,R),i(t))}get timeRunStarted(){return r(e(this,b))}set timeRunStarted(t){u(e(this,b),i(t))}get invoiceRefId(){return r(e(this,L))}set invoiceRefId(t){u(e(this,L),i(t))}get tags(){return r(e(this,v))}set tags(t){u(e(this,v),i(t))}get tagsAsText(){return this.tags.join(" ")}set tagsAsText(t){this.tags=t.trim().split(" ")}getModel(t){return{id:t??this.id,state:this.state,date:this.date,name:this.name,duration:this.duration,affectiveDurationHours:this.affectiveDurationHours,timeRunStarted:this.timeRunStarted,invoiceRefId:this.invoiceRefId,tags:this.tags}}applyModel(t){this.id=t.id,this.state=t.state,this.date=t.date,this.name=t.name,this.duration=t.duration,this.affectiveDurationHours=t.affectiveDurationHours,this.timeRunStarted=t.timeRunStarted,this.invoiceRefId=t.invoiceRefId,this.tags=t.tags}save(){Q.set(this.id,this.getModel())}pause(){this.state==h.Running&&(this.state=h.Paused,this.timeRunStarted=void 0)}start(){this.state=h.Running,this.timeRunStarted=Date.now()}stop(){this.state=h.Stopped,this.timeRunStarted=void 0}incrementDuration(t){if(this.state==h.Running){const s=this.timeRunStarted??Date.now(),d=t*60*1e3,z=s-d;this.timeRunStarted=z,this.recalculateDurationFromRunningSession()}else this.setDuration(this.duration+t*60)}recalculateDurationFromRunningSession(){if(this.state!=h.Running)return;const t=this.timeRunStarted??Date.now(),s=(Date.now()-t)/1e3;this.setDuration(s)}setDuration(t){this.duration=Math.ceil(t),this.affectiveDurationHours=this.calculateAffectiveHours(this.duration,15)}calculateAffectiveHours(t,s){let d=t/60;return Math.ceil(d/s)*s/60}}f=new WeakMap,l=new WeakMap,g=new WeakMap,m=new WeakMap,p=new WeakMap,R=new WeakMap,b=new WeakMap,L=new WeakMap,v=new WeakMap;var x,D,y,I,T,S,M,C,w,j,P,W;class et{constructor(t){n(this,x,o(i(crypto.randomUUID().toString())));n(this,D,o("USD"));n(this,y,o(""));n(this,I,o(i(J.toInputDateValue(new Date))));n(this,T,o(""));n(this,S,o(i([])));n(this,M,o(i([])));n(this,C,o(10));n(this,w,o(i([])));n(this,j,c(()=>this.lines.reduce((t,s)=>t+s.total,0)));n(this,P,c(()=>this.lines.reduce((t,s)=>t+s.tax,0)));n(this,W,c(()=>this.subtotal+this.taxTotal));t&&this.applyModel(t)}get id(){return r(e(this,x))}set id(t){u(e(this,x),i(t))}get currencyCode(){return r(e(this,D))}set currencyCode(t){u(e(this,D),i(t))}get number(){return r(e(this,y))}set number(t){u(e(this,y),i(t))}get date(){return r(e(this,I))}set date(t){u(e(this,I),i(t))}get orderRef(){return r(e(this,T))}set orderRef(t){u(e(this,T),i(t))}get issueToLines(){return r(e(this,S))}set issueToLines(t){u(e(this,S),i(t))}get footerLines(){return r(e(this,M))}set footerLines(t){u(e(this,M),i(t))}get nextLineNumber(){return r(e(this,C))}set nextLineNumber(t){u(e(this,C),i(t))}get lines(){return r(e(this,w))}set lines(t){u(e(this,w),i(t))}get subtotal(){return r(e(this,j))}get taxTotal(){return r(e(this,P))}get grandTotal(){return r(e(this,W))}getModel(){return{id:this.id,currencyCode:this.currencyCode,number:this.number,date:this.date,orderRef:this.orderRef,issueToLines:this.issueToLines,lines:this.lines.map(t=>t.getModel()),footerLines:this.footerLines}}applyModel(t){this.id=t.id,this.currencyCode=t.currencyCode,this.number=t.number,this.date=t.date,this.orderRef=t.orderRef,this.issueToLines=t.issueToLines,this.lines=t.lines.map(s=>new G(s)),this.footerLines=t.footerLines}get issueToAsText(){return this.issueToLines.join(`
`)}set issueToAsText(t){this.issueToLines=t.split(`
`)}get footnoteAsText(){return this.footerLines.join(`
`)}set footnoteAsText(t){this.footerLines=t.split(`
`)}containsExtRefId(t){return this.lines.some(d=>d.extRefId===t)}removeLineWithId(t){this.lines=this.lines.filter(s=>s.id!=t)}removeLineWithExtRefId(t){this.lines=this.lines.filter(s=>s.extRefId!=t)}addLine(t){const s=t??new G;return s.number=this.nextLineNumber,this.nextLineNumber+=10,this.lines.push(s),s.id}sortAndRenumberLines(){this.lines.sort((t,s)=>t.number-s.number),this.renumberLines()}renumberLines(){let t=10;for(let s=0;s<this.lines.length;s++){const d=this.lines[s];d.number=t,t+=10}this.nextLineNumber=t}}x=new WeakMap,D=new WeakMap,y=new WeakMap,I=new WeakMap,T=new WeakMap,S=new WeakMap,M=new WeakMap,C=new WeakMap,w=new WeakMap,j=new WeakMap,P=new WeakMap,W=new WeakMap;var H,A,q,N,U,V,F,E,O;class G{constructor(t){n(this,H,o(i(crypto.randomUUID().toString())));n(this,A,o());n(this,q,o(0));n(this,N,o(""));n(this,U,o(""));n(this,V,o(0));n(this,F,o(0));n(this,E,c(()=>0));n(this,O,c(()=>this.quantity*this.unitCost));t&&this.applyModel(t)}get id(){return r(e(this,H))}set id(t){u(e(this,H),i(t))}get extRefId(){return r(e(this,A))}set extRefId(t){u(e(this,A),i(t))}get number(){return r(e(this,q))}set number(t){u(e(this,q),i(t))}get description(){return r(e(this,N))}set description(t){u(e(this,N),i(t))}get units(){return r(e(this,U))}set units(t){u(e(this,U),i(t))}get quantity(){return r(e(this,V))}set quantity(t){u(e(this,V),i(t))}get unitCost(){return r(e(this,F))}set unitCost(t){u(e(this,F),i(t))}get tax(){return r(e(this,E))}get total(){return r(e(this,O))}get isDescriptionOnlyLine(){return this.quantity==0}getModel(){return{id:this.id,extRefId:this.extRefId,number:this.number,description:this.description,units:this.units,quantity:this.quantity,unitCost:this.unitCost}}applyModel(t){this.id=t.id,this.extRefId=t.extRefId,this.number=t.number,this.description=t.description,this.units=t.units,this.quantity=t.quantity,this.unitCost=t.unitCost}}H=new WeakMap,A=new WeakMap,q=new WeakMap,N=new WeakMap,U=new WeakMap,V=new WeakMap,F=new WeakMap,E=new WeakMap,O=new WeakMap;export{et as I,h as T,tt as a,G as b};
