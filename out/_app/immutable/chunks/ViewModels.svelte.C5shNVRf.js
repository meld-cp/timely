var St=s=>{throw TypeError(s)};var Yt=(s,t,e)=>t.has(s)||St("Cannot "+e);var i=(s,t,e)=>(Yt(s,t,"read from private field"),e?e.call(s):t.get(s)),o=(s,t,e)=>t.has(s)?St("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e);import{X as $t,b as zt,az as qt,h as w,F as pt,C as Bt,x as u,H as Gt,D as Ct,G as Rt,i as q,aA as ut,I as Nt,d as Ft,J as Xt,V as Vt,q as kt,Y as bt,aB as mt,aC as At,aD as _t,aE as Jt,T as Wt,aF as Zt,g as Kt,L as Qt,ae as jt,P as te,au as ee,aG as ie,ak as se,a0 as Mt,a6 as ne,aH as re,N as ae,ap as l,a2 as c,z as N}from"./runtime.BCBvpcPx.js";import{p as r}from"./proxy.DZNCdgJO.js";import{t as ue}from"./Singletons.DGaFW2wU.js";function ge(s,t){return t}function oe(s,t,e,a){for(var h=[],g=t.length,p=0;p<g;p++)Jt(t[p].e,h,!0);var T=g>0&&h.length===0&&e!==null;if(T){var _=e.parentNode;Wt(_),_.append(e),a.clear(),A(s,t[0].prev,t[g-1].next)}Zt(h,()=>{for(var y=0;y<g;y++){var m=t[y];T||(a.delete(m.k),A(s,m.prev,m.next)),Kt(m.e,!T)}})}function pe(s,t,e,a,h,g=null){var p=s,T={flags:t,items:new Map,first:null},_=(t&qt)!==0;if(_){var y=s;p=w?pt(Qt(y)):y.appendChild($t())}w&&Bt();var m=null,S=!1,M=jt(()=>{var n=e();return ne(n)?n:n==null?[]:Vt(n)});zt(()=>{var n=u(M),f=n.length;if(S&&f===0)return;S=f===0;let R=!1;if(w){var E=p.data===Gt;E!==(f===0)&&(p=Ct(),pt(p),Rt(!1),R=!0)}if(w){for(var D=null,I,x=0;x<f;x++){if(q.nodeType===8&&q.data===te){p=q,R=!0,Rt(!1);break}var L=n[x],d=a(L,x);I=Ut(q,T,D,null,L,d,x,h,t),T.items.set(d,I),D=I}f>0&&pt(Ct())}if(!w){var v=ee;de(n,T,p,h,t,(v.f&ut)!==0,a)}g!==null&&(f===0?m?Nt(m):m=Ft(()=>g(p)):m!==null&&Xt(m,()=>{m=null})),R&&Rt(!0),u(M)}),w&&(p=q)}function de(s,t,e,a,h,g,p,T){var It,xt,Tt,Lt;var _=(h&ie)!==0,y=(h&(mt|_t))!==0,m=s.length,S=t.items,M=t.first,n=M,f,R=null,E,D=[],I=[],x,L,d,v;if(_)for(v=0;v<m;v+=1)x=s[v],L=p(x,v),d=S.get(L),d!==void 0&&((It=d.a)==null||It.measure(),(E??(E=new Set)).add(d));for(v=0;v<m;v+=1){if(x=s[v],L=p(x,v),d=S.get(L),d===void 0){var Ot=n?n.e.nodes_start:e;R=Ut(Ot,t,R,R===null?t.first:R.next,x,L,v,a,h),S.set(L,R),D=[],I=[],n=R.next;continue}if(y&&he(d,x,v,h),d.e.f&ut&&(Nt(d.e),_&&((xt=d.a)==null||xt.unfix(),(E??(E=new Set)).delete(d))),d!==n){if(f!==void 0&&f.has(d)){if(D.length<I.length){var at=I[0],C;R=at.prev;var Dt=D[0],vt=D[D.length-1];for(C=0;C<D.length;C+=1)wt(D[C],at,e);for(C=0;C<I.length;C+=1)f.delete(I[C]);A(t,Dt.prev,vt.next),A(t,R,Dt),A(t,vt,at),n=at,R=vt,v-=1,D=[],I=[]}else f.delete(d),wt(d,n,e),A(t,d.prev,d.next),A(t,d,R===null?t.first:R.next),A(t,R,d),R=d;continue}for(D=[],I=[];n!==null&&n.k!==L;)(g||!(n.e.f&ut))&&(f??(f=new Set)).add(n),I.push(n),n=n.next;if(n===null)continue;d=n}D.push(d),R=d,n=d.next}if(n!==null||f!==void 0){for(var H=f===void 0?[]:Vt(f);n!==null;)(g||!(n.e.f&ut))&&H.push(n),n=n.next;var gt=H.length;if(gt>0){var Pt=h&qt&&m===0?e:null;if(_){for(v=0;v<gt;v+=1)(Tt=H[v].a)==null||Tt.measure();for(v=0;v<gt;v+=1)(Lt=H[v].a)==null||Lt.fix()}oe(t,H,Pt,S)}}_&&kt(()=>{var yt;if(E!==void 0)for(d of E)(yt=d.a)==null||yt.apply()}),bt.first=t.first&&t.first.e,bt.last=R&&R.e}function he(s,t,e,a){a&mt&&At(s.v,t),a&_t?At(s.i,e):s.i=e}function Ut(s,t,e,a,h,g,p,T,_,y){var m=(_&mt)!==0,S=(_&re)===0,M=m?S?se(h):Mt(h):h,n=_&_t?Mt(p):p,f={i:n,v:M,k:g,a:null,e:null,prev:e,next:a};try{return f.e=Ft(()=>T(s,M,n),w),f.e.prev=e&&e.e,f.e.next=a&&a.e,e===null?t.first=f:(e.next=f,e.e.next=f.e),a!==null&&(a.prev=f,a.e.prev=f.e),f}finally{}}function wt(s,t,e){for(var a=s.next?s.next.e.nodes_start:e,h=t?t.e.nodes_start:e,g=s.e.nodes_start;g!==a;){var p=ae(g);h.before(g),g=p}}function A(s,t,e){t===null?s.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}var b=(s=>(s[s.Running=0]="Running",s[s.Paused=1]="Paused",s[s.Stopped=2]="Stopped",s[s.Archived=3]="Archived",s))(b||{});class Et{static padLeft(t,e,a){const h=a-t.length;for(let g=0;g<h;g++)t=e[0]+t;return t}}class ct{static toInputDateValue(t){var e=t.getDate(),a=t.getMonth()+1,h=t.getFullYear();return`${h}-${Et.padLeft(a.toString(),"0",2)}-${Et.padLeft(e.toString(),"0",2)}`}static toLocalDatefromString(t,e){const a=new Date(t);return ct.toLocalDate(a,e)}static toLocalDate(t,e){return new Intl.DateTimeFormat(e,{}).format(t)}}var F,V,U,O,P,Y,$,z,B;class Re{constructor(t){o(this,F,l(r(crypto.randomUUID())));o(this,V,l(r(b.Stopped)));o(this,U,l(r(ct.toInputDateValue(new Date))));o(this,O,l(""));o(this,P,l(0));o(this,Y,l(0));o(this,$,l());o(this,z,l(""));o(this,B,l(r([])));t&&this.applyModel(t)}get id(){return u(i(this,F))}set id(t){c(i(this,F),r(t))}get state(){return u(i(this,V))}set state(t){c(i(this,V),r(t))}get date(){return u(i(this,U))}set date(t){c(i(this,U),r(t))}get name(){return u(i(this,O))}set name(t){c(i(this,O),r(t))}get duration(){return u(i(this,P))}set duration(t){c(i(this,P),r(t))}get affectiveDurationHours(){return u(i(this,Y))}set affectiveDurationHours(t){c(i(this,Y),r(t))}get timeRunStarted(){return u(i(this,$))}set timeRunStarted(t){c(i(this,$),r(t))}get invoiceRefId(){return u(i(this,z))}set invoiceRefId(t){c(i(this,z),r(t))}get tags(){return u(i(this,B))}set tags(t){c(i(this,B),r(t))}get tagsAsText(){return this.tags.join(" ")}set tagsAsText(t){this.tags=t.trim().split(" ")}getModel(t){return{id:t??this.id,state:this.state,date:this.date,name:this.name,duration:this.duration,affectiveDurationHours:this.affectiveDurationHours,timeRunStarted:this.timeRunStarted,invoiceRefId:this.invoiceRefId,tags:this.tags}}applyModel(t){this.id=t.id,this.state=t.state,this.date=t.date,this.name=t.name,this.duration=t.duration,this.affectiveDurationHours=t.affectiveDurationHours,this.timeRunStarted=t.timeRunStarted,this.invoiceRefId=t.invoiceRefId,this.tags=t.tags}save(){ue.set(this.id,this.getModel())}pause(){this.state==b.Running&&(this.state=b.Paused,this.timeRunStarted=void 0)}start(){this.state=b.Running,this.timeRunStarted=Date.now()}stop(){this.state=b.Stopped,this.timeRunStarted=void 0}incrementDuration(t){if(this.state==b.Running){const e=this.timeRunStarted??Date.now(),a=t*60*1e3,h=e-a;this.timeRunStarted=h,this.recalculateDurationFromRunningSession()}else this.setDuration(this.duration+t*60)}recalculateDurationFromRunningSession(){if(this.state!=b.Running)return;const t=this.timeRunStarted??Date.now(),e=(Date.now()-t)/1e3;this.setDuration(e)}setDuration(t){this.duration=Math.ceil(t),this.affectiveDurationHours=this.calculateAffectiveHours(this.duration,15)}calculateAffectiveHours(t,e){let a=t/60;return Math.ceil(a/e)*e/60}}F=new WeakMap,V=new WeakMap,U=new WeakMap,O=new WeakMap,P=new WeakMap,Y=new WeakMap,$=new WeakMap,z=new WeakMap,B=new WeakMap;var G,X,k,J,W,Z,K,Q,ot,dt,ht;class me{constructor(t){o(this,G,l(r(crypto.randomUUID().toString())));o(this,X,l("NZD"));o(this,k,l(""));o(this,J,l(r(ct.toInputDateValue(new Date))));o(this,W,l(""));o(this,Z,l(r([])));o(this,K,l(r([])));o(this,Q,l(r([])));o(this,ot,N(()=>this.lines.reduce((t,e)=>t+e.total,0)));o(this,dt,N(()=>this.lines.reduce((t,e)=>t+e.tax,0)));o(this,ht,N(()=>this.subtotal+this.taxTotal));t&&this.applyModel(t)}get id(){return u(i(this,G))}set id(t){c(i(this,G),r(t))}get currencyCode(){return u(i(this,X))}set currencyCode(t){c(i(this,X),r(t))}get number(){return u(i(this,k))}set number(t){c(i(this,k),r(t))}get date(){return u(i(this,J))}set date(t){c(i(this,J),r(t))}get orderRef(){return u(i(this,W))}set orderRef(t){c(i(this,W),r(t))}get issueToLines(){return u(i(this,Z))}set issueToLines(t){c(i(this,Z),r(t))}get footerLines(){return u(i(this,K))}set footerLines(t){c(i(this,K),r(t))}get lines(){return u(i(this,Q))}set lines(t){c(i(this,Q),r(t))}get subtotal(){return u(i(this,ot))}get taxTotal(){return u(i(this,dt))}get grandTotal(){return u(i(this,ht))}getModel(){return{id:this.id,currencyCode:this.currencyCode,number:this.number,date:this.date,orderRef:this.orderRef,issueToLines:this.issueToLines,lines:this.lines.map(t=>t.getModel()),footerLines:this.footerLines}}applyModel(t){this.id=t.id,this.currencyCode=t.currencyCode,this.number=t.number,this.date=t.date,this.orderRef=t.orderRef,this.issueToLines=t.issueToLines,this.lines=t.lines.map(e=>new Ht(e)),this.footerLines=t.footerLines}get issueToAsText(){return this.issueToLines.join(`
`)}set issueToAsText(t){this.issueToLines=t.split(`
`)}get footnoteAsText(){return this.footerLines.join(`
`)}set footnoteAsText(t){this.footerLines=t.split(`
`)}containsExtRefId(t){return this.lines.some(a=>a.extRefId===t)}removeLineWithExtRefId(t){this.lines=this.lines.filter(e=>e.extRefId!=t)}addLine(t){const e=t??new Ht;return this.lines.push(e),e.id}sortLines(){}}G=new WeakMap,X=new WeakMap,k=new WeakMap,J=new WeakMap,W=new WeakMap,Z=new WeakMap,K=new WeakMap,Q=new WeakMap,ot=new WeakMap,dt=new WeakMap,ht=new WeakMap;var j,tt,et,it,st,nt,rt,ft,lt;class Ht{constructor(t){o(this,j,l(r(crypto.randomUUID().toString())));o(this,tt,l());o(this,et,l(0));o(this,it,l(""));o(this,st,l(""));o(this,nt,l(0));o(this,rt,l(0));o(this,ft,N(()=>0));o(this,lt,N(()=>this.quantity*this.unitCost));t&&this.applyModel(t)}get id(){return u(i(this,j))}set id(t){c(i(this,j),r(t))}get extRefId(){return u(i(this,tt))}set extRefId(t){c(i(this,tt),r(t))}get number(){return u(i(this,et))}set number(t){c(i(this,et),r(t))}get description(){return u(i(this,it))}set description(t){c(i(this,it),r(t))}get units(){return u(i(this,st))}set units(t){c(i(this,st),r(t))}get quantity(){return u(i(this,nt))}set quantity(t){c(i(this,nt),r(t))}get unitCost(){return u(i(this,rt))}set unitCost(t){c(i(this,rt),r(t))}get tax(){return u(i(this,ft))}get total(){return u(i(this,lt))}getModel(){return{id:this.id,extRefId:this.extRefId,number:this.number,description:this.description,units:this.units,quantity:this.quantity,unitCost:this.unitCost}}applyModel(t){this.id=t.id,this.extRefId=t.extRefId,this.number=t.number,this.description=t.description,this.units=t.units,this.quantity=t.quantity,this.unitCost=t.unitCost}}j=new WeakMap,tt=new WeakMap,et=new WeakMap,it=new WeakMap,st=new WeakMap,nt=new WeakMap,rt=new WeakMap,ft=new WeakMap,lt=new WeakMap;export{ct as F,me as I,b as T,Re as a,Ht as b,pe as e,ge as i};
