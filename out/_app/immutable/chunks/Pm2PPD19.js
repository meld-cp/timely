var Ht=Object.defineProperty;var _t=s=>{throw TypeError(s)};var Pt=(s,t,e)=>t in s?Ht(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var S=(s,t,e)=>Pt(s,typeof t!="symbol"?t+"":t,e),Ot=(s,t,e)=>t.has(s)||_t("Cannot "+e);var i=(s,t,e)=>(Ot(s,t,"read from private field"),e?e.call(s):t.get(s)),o=(s,t,e)=>t.has(s)?_t("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e);import{h as yt,aN as Ut,ac as Ft,aO as Kt,aP as Et,j as u,l as a,k as d,y as b}from"./DADXHUXo.js";import{c as Vt,f as $t,g as qt,d as jt,j as Bt,n as Wt,k as Gt}from"./F2U1FVqC.js";import{p as r}from"./Ie9j5a_F.js";function Dt(s){var t,e,n="";if(typeof s=="string"||typeof s=="number")n+=s;else if(typeof s=="object")if(Array.isArray(s)){var c=s.length;for(t=0;t<c;t++)s[t]&&(e=Dt(s[t]))&&(n&&(n+=" "),n+=e)}else for(e in s)s[e]&&(n&&(n+=" "),n+=e);return n}function Jt(){for(var s,t,e=0,n="",c=arguments.length;e<c;e++)(s=arguments[e])&&(t=Dt(s))&&(n&&(n+=" "),n+=t);return n}function Yt(s){return typeof s=="object"?Jt(s):s??""}function ue(s){if(yt){var t=!1,e=()=>{if(!t){if(t=!0,s.hasAttribute("value")){var n=s.value;gt(s,"value",null),s.value=n}if(s.hasAttribute("checked")){var c=s.checked;gt(s,"checked",null),s.checked=c}}};s.__on_r=e,Ut(e),Vt()}}function zt(s,t){t?s.hasAttribute("selected")||s.setAttribute("selected",""):s.removeAttribute("selected")}function gt(s,t,e,n){var c=s.__attributes??(s.__attributes={});yt&&(c[t]=s.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&s.nodeName==="LINK")||c[t]!==(c[t]=e)&&(t==="style"&&"__styles"in s&&(s.__styles={}),t==="loading"&&(s[Kt]=e),e==null?s.removeAttribute(t):typeof e!="string"&&At(s).includes(t)?s[t]=e:s.setAttribute(t,e))}function de(s,t,e,n,c=!1,g=!1,kt=!1){var y=t||{},It=s.tagName==="OPTION";for(var mt in t)mt in e||(e[mt]=null);e.class&&(e.class=Yt(e.class));var xt=At(s),Mt=s.__attributes??(s.__attributes={});for(const h in e){let l=e[h];if(It&&h==="value"&&l==null){s.value=s.__value="",y[h]=l;continue}var St=y[h];if(l!==St){y[h]=l;var bt=h[0]+h[1];if(bt!=="$$"){if(bt==="on"){const v={},m="$$"+h;let p=h.slice(2);var lt=Gt(p);if($t(p)&&(p=p.slice(0,-7),v.capture=!0),!lt&&St){if(l!=null)continue;s.removeEventListener(p,y[m],v),y[m]=null}if(l!=null)if(lt)s[`__${p}`]=l,jt([p]);else{let Nt=function(wt){y[h].call(this,wt)};y[m]=qt(p,s,Nt,v)}else lt&&(s[`__${p}`]=void 0)}else if(h==="style"&&l!=null)s.style.cssText=l+"";else if(h==="autofocus")Bt(s,!!l);else if(h==="__value"||h==="value"&&l!=null)s.value=s[h]=s.__value=l;else if(h==="selected"&&It)zt(s,l);else{var f=h;c||(f=Wt(f));var Rt=f==="defaultValue"||f==="defaultChecked";if(l==null&&!g&&!Rt)if(Mt[h]=null,f==="value"||f==="checked"){let v=s;if(f==="value"){let m=v.defaultValue;v.removeAttribute(f),v.defaultValue=m}else{let m=v.defaultChecked;v.removeAttribute(f),v.defaultChecked=m}}else s.removeAttribute(h);else Rt||xt.includes(f)&&(g||typeof l!="string")?s[f]=l:typeof l!="function"&&(yt&&(f==="src"||f==="href"||f==="srcset")||gt(s,f,l))}h==="style"&&"__styles"in s&&(s.__styles={})}}}return y}var Ct=new Map;function At(s){var t=Ct.get(s.nodeName);if(t)return t;Ct.set(s.nodeName,t=[]);for(var e,n=s,c=Element.prototype;c!==n;){e=Et(n);for(var g in e)e[g].set&&t.push(g);n=Ft(n)}return t}const Qt="tasks",Xt="invoices",Zt="settings",ce="fdfa7987-22fb-4458-896b-d04b30f9ba38";var R,_,C,L,T,D,A,k,x,M;class vt{constructor(t){o(this,R,u(r(navigator.language)));o(this,_,u());o(this,C,u());o(this,L,u(1e3));o(this,T,u(r({})));o(this,D,u());o(this,A,u("USD"));o(this,k,u());o(this,x,u());o(this,M,u());t&&this.applyModel(t)}get localeCode(){return a(i(this,R))}set localeCode(t){d(i(this,R),r(t))}get address(){return a(i(this,_))}set address(t){d(i(this,_),r(t))}get logoData(){return a(i(this,C))}set logoData(t){d(i(this,C),r(t))}get nextInvoiceNumber(){return a(i(this,L))}set nextInvoiceNumber(t){d(i(this,L),r(t))}get scratchPads(){return a(i(this,T))}set scratchPads(t){d(i(this,T),r(t))}get defaultInvoiceHeader(){return a(i(this,D))}set defaultInvoiceHeader(t){d(i(this,D),r(t))}get defaultInvoiceCurrencyCode(){return a(i(this,A))}set defaultInvoiceCurrencyCode(t){d(i(this,A),r(t))}get defaultInvoiceFooter(){return a(i(this,k))}set defaultInvoiceFooter(t){d(i(this,k),r(t))}get cloudSyncHost(){return a(i(this,x))}set cloudSyncHost(t){d(i(this,x),r(t))}get cloudSyncUserId(){return a(i(this,M))}set cloudSyncUserId(t){d(i(this,M),r(t))}applyModel(t){this.localeCode=t.localeCode??navigator.language,this.address=t.address??"",this.logoData=t.logoData,this.nextInvoiceNumber=t.nextInvoiceNumber??1e3,this.defaultInvoiceHeader=t.defaultInvoiceHeader,this.defaultInvoiceCurrencyCode=t.defaultInvoiceCurrencyCode??"USD",this.defaultInvoiceFooter=t.defaultInvoiceFooter,this.scratchPads=t.scratchPads??{},this.cloudSyncHost=t.cloudSyncHost,this.cloudSyncUserId=t.cloudSyncUserId}getModel(){return{localeCode:this.localeCode,address:this.address,logoData:this.logoData,nextInvoiceNumber:this.nextInvoiceNumber,defaultInvoiceHeader:this.defaultInvoiceHeader,defaultInvoiceCurrencyCode:this.defaultInvoiceCurrencyCode,defaultInvoiceFooter:this.defaultInvoiceFooter,scratchPads:this.scratchPads,cloudSyncHost:this.cloudSyncHost,cloudSyncUserId:this.cloudSyncUserId}}}R=new WeakMap,_=new WeakMap,C=new WeakMap,L=new WeakMap,T=new WeakMap,D=new WeakMap,A=new WeakMap,k=new WeakMap,x=new WeakMap,M=new WeakMap;class Lt{static padLeft(t,e,n){const c=n-t.length;for(let g=0;g<c;g++)t=e[0]+t;return t}}class ht{static toInputDateValue(t){var e=t.getDate(),n=t.getMonth()+1,c=t.getFullYear();return`${c}-${Lt.padLeft(n.toString(),"0",2)}-${Lt.padLeft(e.toString(),"0",2)}`}static toLocalDatefromString(t,e){const n=new Date(t);return ht.toLocalDate(n,e)}static toLocalDate(t,e){return new Intl.DateTimeFormat(e,{}).format(t)}}var N,w,H,P,O,U,F,nt,ot;class Tt{constructor(t){o(this,N,u(r(crypto.randomUUID().toString())));o(this,w,u());o(this,H,u(0));o(this,P,u(""));o(this,O,u(""));o(this,U,u(0));o(this,F,u(0));o(this,nt,b(()=>0));o(this,ot,b(()=>this.quantity*this.unitCost));t&&this.applyModel(t)}get id(){return a(i(this,N))}set id(t){d(i(this,N),r(t))}get extRefId(){return a(i(this,w))}set extRefId(t){d(i(this,w),r(t))}get number(){return a(i(this,H))}set number(t){d(i(this,H),r(t))}get description(){return a(i(this,P))}set description(t){d(i(this,P),r(t))}get units(){return a(i(this,O))}set units(t){d(i(this,O),r(t))}get quantity(){return a(i(this,U))}set quantity(t){d(i(this,U),r(t))}get unitCost(){return a(i(this,F))}set unitCost(t){d(i(this,F),r(t))}get tax(){return a(i(this,nt))}get total(){return a(i(this,ot))}get isDescriptionOnlyLine(){return this.quantity==0}getModel(){return{id:this.id,extRefId:this.extRefId,number:this.number,description:this.description,units:this.units,quantity:this.quantity,unitCost:this.unitCost}}applyModel(t){this.id=t.id,this.extRefId=t.extRefId,this.number=t.number,this.description=t.description,this.units=t.units,this.quantity=t.quantity,this.unitCost=t.unitCost}}N=new WeakMap,w=new WeakMap,H=new WeakMap,P=new WeakMap,O=new WeakMap,U=new WeakMap,F=new WeakMap,nt=new WeakMap,ot=new WeakMap;var K,E,V,$,q,j,B,W,G,J,at,ut,dt;class te{constructor(t){o(this,K,u(r(crypto.randomUUID().toString())));o(this,E,u("USD"));o(this,V,u(""));o(this,$,u(r(ht.toInputDateValue(new Date))));o(this,q,u(""));o(this,j,u(r([])));o(this,B,u(r([])));o(this,W,u(r([])));o(this,G,u(10));o(this,J,u(r([])));o(this,at,b(()=>this.lines.reduce((t,e)=>t+e.total,0)));o(this,ut,b(()=>this.lines.reduce((t,e)=>t+e.tax,0)));o(this,dt,b(()=>this.subtotal+this.taxTotal));t&&this.applyModel(t)}get id(){return a(i(this,K))}set id(t){d(i(this,K),r(t))}get currencyCode(){return a(i(this,E))}set currencyCode(t){d(i(this,E),r(t))}get number(){return a(i(this,V))}set number(t){d(i(this,V),r(t))}get date(){return a(i(this,$))}set date(t){d(i(this,$),r(t))}get orderRef(){return a(i(this,q))}set orderRef(t){d(i(this,q),r(t))}get headerLines(){return a(i(this,j))}set headerLines(t){d(i(this,j),r(t))}get issueToLines(){return a(i(this,B))}set issueToLines(t){d(i(this,B),r(t))}get footerLines(){return a(i(this,W))}set footerLines(t){d(i(this,W),r(t))}get nextLineNumber(){return a(i(this,G))}set nextLineNumber(t){d(i(this,G),r(t))}get lines(){return a(i(this,J))}set lines(t){d(i(this,J),r(t))}get subtotal(){return a(i(this,at))}get taxTotal(){return a(i(this,ut))}get grandTotal(){return a(i(this,dt))}getModel(){return{id:this.id,currencyCode:this.currencyCode,number:this.number,date:this.date,orderRef:this.orderRef,headerLines:this.headerLines,issueToLines:this.issueToLines,lines:this.lines.map(t=>t.getModel()),footerLines:this.footerLines}}applyModel(t){this.id=t.id,this.currencyCode=t.currencyCode,this.number=t.number,this.date=t.date,this.orderRef=t.orderRef,this.headerLines=t.headerLines??[],this.issueToLines=t.issueToLines,this.lines=t.lines.map(e=>new Tt(e)),this.footerLines=t.footerLines??[]}get headerLinesAsText(){return this.headerLines.join(`
`)}set headerLinesAsText(t){this.headerLines=t.split(`
`)}get issueToAsText(){return this.issueToLines.join(`
`)}set issueToAsText(t){this.issueToLines=t.split(`
`)}get footnoteAsText(){return this.footerLines.join(`
`)}set footnoteAsText(t){this.footerLines=t.split(`
`)}containsExtRefId(t){return this.lines.some(n=>n.extRefId===t)}removeLineWithId(t){this.lines=this.lines.filter(e=>e.id!=t)}removeLineWithExtRefId(t){this.lines=this.lines.filter(e=>e.extRefId!=t)}addLine(t){const e=t??new Tt;return e.number=this.nextLineNumber,this.nextLineNumber+=10,this.lines.push(e),e.id}sortAndRenumberLines(){this.lines.sort((t,e)=>t.number-e.number),this.renumberLines()}renumberLines(){let t=10;for(let e=0;e<this.lines.length;e++){const n=this.lines[e];n.number=t,t+=10}this.nextLineNumber=t}}K=new WeakMap,E=new WeakMap,V=new WeakMap,$=new WeakMap,q=new WeakMap,j=new WeakMap,B=new WeakMap,W=new WeakMap,G=new WeakMap,J=new WeakMap,at=new WeakMap,ut=new WeakMap,dt=new WeakMap;var I=(s=>(s.Running="Running",s.Paused="Paused",s.Stopped="Stopped",s.Archived="Archived",s))(I||{}),Y,z,Q,X,Z,tt,et,st,it;class ee{constructor(t){o(this,Y,u(r(crypto.randomUUID())));o(this,z,u(r(I.Stopped)));o(this,Q,u(r(ht.toInputDateValue(new Date))));o(this,X,u(""));o(this,Z,u(0));o(this,tt,u(0));o(this,et,u());o(this,st,u(""));o(this,it,u(r([])));t&&this.applyModel(t)}get id(){return a(i(this,Y))}set id(t){d(i(this,Y),r(t))}get state(){return a(i(this,z))}set state(t){d(i(this,z),r(t))}get date(){return a(i(this,Q))}set date(t){d(i(this,Q),r(t))}get name(){return a(i(this,X))}set name(t){d(i(this,X),r(t))}get duration(){return a(i(this,Z))}set duration(t){d(i(this,Z),r(t))}get affectiveDurationHours(){return a(i(this,tt))}set affectiveDurationHours(t){d(i(this,tt),r(t))}get timeRunStarted(){return a(i(this,et))}set timeRunStarted(t){d(i(this,et),r(t))}get invoiceRefId(){return a(i(this,st))}set invoiceRefId(t){d(i(this,st),r(t))}get tags(){return a(i(this,it))}set tags(t){d(i(this,it),r(t))}get tagsAsText(){return this.tags.join(" ")}set tagsAsText(t){this.tags=t.trim().split(" ")}getModel(t){return{id:t??this.id,state:this.state,date:this.date,name:this.name,duration:this.duration,affectiveDurationHours:this.affectiveDurationHours,timeRunStarted:this.timeRunStarted,invoiceRefId:this.invoiceRefId,tags:this.tags}}applyModel(t){this.id=t.id,this.state=t.state,this.date=t.date,this.name=t.name,this.duration=t.duration,this.affectiveDurationHours=t.affectiveDurationHours,this.timeRunStarted=t.timeRunStarted,this.invoiceRefId=t.invoiceRefId,this.tags=t.tags}save(){ie.taskRepo.set(this.id,this.getModel())}pause(){this.state==I.Running&&(this.state=I.Paused,this.timeRunStarted=void 0)}start(){this.state=I.Running,this.timeRunStarted=Date.now()}stop(){this.state=I.Stopped,this.timeRunStarted=void 0}incrementDuration(t){if(this.state==I.Running){const e=this.timeRunStarted??Date.now(),n=t*60*1e3,c=e-n;this.timeRunStarted=c,this.recalculateDurationFromRunningSession()}else this.setDuration(this.duration+t*60)}recalculateDurationFromRunningSession(){if(this.state!=I.Running)return;const t=this.timeRunStarted??Date.now(),e=(Date.now()-t)/1e3;this.setDuration(e)}setDuration(t){this.duration=Math.ceil(t),this.affectiveDurationHours=this.calculateAffectiveHours(this.duration,15)}calculateAffectiveHours(t,e){let n=t/60;return Math.ceil(n/e)*e/60}}Y=new WeakMap,z=new WeakMap,Q=new WeakMap,X=new WeakMap,Z=new WeakMap,tt=new WeakMap,et=new WeakMap,st=new WeakMap,it=new WeakMap;class ft{constructor(t,e){this.bucket=t,this.options=e,this.bucket=t}encode(t){return JSON.stringify(t)}dencode(t){return JSON.parse(t)}buildBucketKey(t){return[this.bucket,t].join("$")}matchesBucketItemKey(t){return t.startsWith(this.bucket+"$")}setChangedTimestamp(){var t;((t=this.options)==null?void 0:t.onModifiedCallback)!=null&&this.options.onModifiedCallback()}set(t,e){const n=this.buildBucketKey(t),c=this.encode(e);localStorage.setItem(n,c),this.setChangedTimestamp()}get(t){const e=this.buildBucketKey(t);return this.getWithKey(e)}getWithKey(t){const e=localStorage.getItem(t);return e===null?null:this.dencode(e)}getAll(){const t=[];for(let e=0;e<localStorage.length;e++){const n=localStorage.key(e);if(n==null)return t;if(!this.matchesBucketItemKey(n))continue;const c=this.getWithKey(n);c&&t.push(c)}return t}remove(t){const e=this.buildBucketKey(t);localStorage.removeItem(e),this.setChangedTimestamp()}removeAll(){const t=[];for(let e=0;e<localStorage.length;e++){const n=localStorage.key(e);if(n==null)break;this.matchesBucketItemKey(n)&&t.push(n)}if(t.length!=0){for(const e of t)localStorage.removeItem(e);this.setChangedTimestamp()}}}const ct=class ct{constructor(t){this.repo=t}modify(t){const e=this.read();t(e),this.write(e)}read(){const t=this.repo.get("");return t?new vt(t):new vt(ct.defaultSettings)}write(t){this.repo.set("",t.getModel())}incrementNextInvoiceNumber(){this.modify(t=>{t.nextInvoiceNumber++})}getScratchPad(t){return this.read().scratchPads[t]??""}setScratchPad(t,e){this.modify(n=>{n.scratchPads[t]=e})}};S(ct,"defaultSettings",{localeCode:"en-US",nextInvoiceNumber:1e3,defaultInvoiceCurrencyCode:"USD",scratchPads:{}});let pt=ct;var rt;class se{constructor(){S(this,"settingsRepo");S(this,"taskRepo");S(this,"invRepo");S(this,"settingsController");o(this,rt,u(0));const t={onModifiedCallback:()=>this.setChangedTimestamp()};this.settingsRepo=new ft(Zt,t),this.taskRepo=new ft(Qt,t),this.invRepo=new ft(Xt,t),this.settingsController=new pt(this.settingsRepo)}get dataModifiedTimestamp(){return a(i(this,rt))}set dataModifiedTimestamp(t){d(i(this,rt),r(t))}async getTasks(){return this.taskRepo.getAll().map(t=>new ee(t))}async getInvoices(){return this.invRepo.getAll().map(t=>new te(t))}getAppData(){return{modified:this.readDataModifiedTimestamp()??0,settings:this.settingsController.read().getModel(),tasks:this.taskRepo.getAll(),invoices:this.invRepo.getAll()}}setChangedTimestamp(t){this.dataModifiedTimestamp=t??new Date().valueOf(),localStorage.setItem("_modified",this.dataModifiedTimestamp.toString())}readDataModifiedTimestamp(){const t=localStorage.getItem("_modified");if(t===null)return null;const e=parseInt(t);return isNaN(e)?null:(this.dataModifiedTimestamp=e,e)}async restoreAppData(t){console.debug("this.restore",t),localStorage.clear(),this.setChangedTimestamp(t.modified),this.settingsController.write(new vt(t.settings));for(const e of t.tasks)this.taskRepo.set(e.id,e);for(const e of t.invoices)this.invRepo.set(e.id,e)}}rt=new WeakMap;const ie=new se;export{ht as F,te as I,ce as K,I as T,ie as a,zt as b,ee as c,Tt as d,de as e,ue as r,gt as s};
